import{r as N,z as le,i as K,o as Q,T as ue,A,a6 as me,H as T,w as B,a as de,b as D,e as c,k as _,l as a,f as r,g as n,t as o,C as j,j as x,h as p,n as S,p as F,B as q,_ as z,b6 as ce,b7 as fe,b8 as be,b9 as ge,q as H,aG as O,s as ve,u as _e,F as pe}from"./index-D24HXhLT.js";import{_ as ye}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-DRN2bHzK.js";const he={key:0,class:"text-lg font-semibold mb-5 text-ink-gray-9"},we={key:0},ke={key:1},xe={class:"text-sm text-ink-gray-7 font-medium mb-2"},Se=["innerHTML"],Ne={class:"flex flex-col"},De={class:"p-5"},Le={class:"flex items-center justify-between mb-4"},Te={class:"font-semibold text-ink-gray-9"},Fe={class:"flex items-center space-x-2"},Ae={key:0,class:"bg-surface-blue-2 text-ink-blue-2 p-3 rounded-md leading-5 text-sm mb-4"},Ce={key:1},Ie={class:"text-xs text-ink-gray-5 mt-1 mb-2"},Re={key:1},Me={class:"flex text-ink-gray-7"},Pe={class:"border self-start rounded-md p-2 mr-2"},Ve=["href"],$e={class:"text-sm leading-5"},Ue={class:"text-sm text-ink-gray-5 mt-1"},Ee={key:2},Ge={class:"text-xs text-ink-gray-5 mb-1"},Be={key:3},je={class:"text-sm mb-2 text-ink-gray-7"},qe={key:4,class:"mt-8 p-3 bg-surface-blue-2 rounded-md"},ze={class:"text-sm text-ink-gray-5 font-medium mb-2"},He=["innerHTML"],Oe={key:5,class:"mt-8 space-y-4"},Ke={class:"font-semibold mb-2 text-ink-gray-9"},Qe={class:"text-sm text-ink-gray-5 mb-1"},We={__name:"Assignment",props:{assignmentID:{type:String,required:!0},submissionName:{type:String,default:"new"},showTitle:{type:Boolean,default:!0}},setup(v){var M;const u=N(null),f=N(null),w=N(null),b=le(),m=K("$user"),g=N(!1),d=v;Q(()=>{window.addEventListener("keydown",k)});const k=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&(I(),e.preventDefault())};ue(()=>{window.removeEventListener("keydown",k)});const y=A({url:"frappe.client.get",params:{doctype:"LMS Assignment",name:d.assignmentID},auto:!0,onSuccess(e){d.submissionName!="new"&&t.reload()}}),W=A({url:"frappe.client.insert",makeParams(e){var i;let s={doctype:"LMS Assignment Submission",assignment:d.assignmentID,member:(i=m.data)==null?void 0:i.name};return L()?s.assignment_attachment=u.value.file_url:s.answer=f.value,{doc:s}}}),X=A({url:"lms.lms.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){u.value=e}}),t=me({doctype:"LMS Assignment Submission",name:d.submissionName,onError(e){var s;T.error(((s=e.messages)==null?void 0:s[0])||e)},auto:!1,cache:[(M=m.data)==null?void 0:M.name,d.assignmentID]});B(t,()=>{t.doc&&(t.doc.assignment_attachment&&X.reload({image:t.doc.assignment_attachment}),t.doc.answer&&(f.value=t.doc.answer),t.doc.comments&&(w.value=t.doc.comments),t.isDirty||L()&&!u.value||!L()&&!f.value?g.value=!0:g.value=!1)}),B(u,()=>{d.submissionName=="new"&&u.value&&(g.value=!0)});const I=()=>{var e,s,i;if(d.submissionName!="new"){let h=t.doc&&t.doc.owner!=((e=m.data)==null?void 0:e.name)?(s=m.data)==null?void 0:s.name:null;t.setValue.submit({...t.doc,assignment_attachment:(i=u.value)==null?void 0:i.file_url,evaluator:h,comments:w.value,answer:f.value},{onSuccess(C){T.success(__("Changes saved successfully"))}})}else Y()},Y=()=>{W.submit({},{onSuccess(e){T.success(__("Assignment submitted successfully")),b.currentRoute.value.name=="AssignmentSubmission"?b.push({name:"AssignmentSubmission",params:{assignmentID:d.assignmentID,submissionName:e.name},query:{fromLesson:b.currentRoute.value.query.fromLesson}}):(Z(),b.go()),t.name=e.name,t.reload()},onError(e){var s;T.error(((s=e.messages)==null?void 0:s[0])||e)}})},J=e=>{g.value=!0,u.value=e},Z=()=>{if(b.currentRoute.value.name=="Lesson"){let e=b.currentRoute.value.params.courseName,s=b.currentRoute.value.params.chapterNumber,i=b.currentRoute.value.params.lessonNumber;de("lms.lms.api.mark_lesson_progress",{course:e,chapter_number:s,lesson_number:i})}},ee=()=>{var s;const e=(s=y.data)==null?void 0:s.type;if(e=="Image")return["image/*"];if(e=="Document")return[".doc",".docx",".xml","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"];if(e=="PDF")return[".pdf"]},se=e=>{var h;let s=(h=y.data)==null?void 0:h.type,i=e.name.split(".").pop().toLowerCase();if(s=="Image"&&!["jpg","jpeg","png"].includes(i))return"Only image file is allowed.";if(s=="Document"&&!["doc","docx","xml"].includes(i))return"Only document file is allowed.";if(s=="PDF"&&!["pdf"].includes(i))return"Only PDF file is allowed."},te=()=>{g.value=!0,u.value=null},ae=D(()=>{var e,s,i;return(((e=m.data)==null?void 0:e.is_moderator)||((s=m.data)==null?void 0:s.is_evaluator)||((i=m.data)==null?void 0:i.is_instructor))&&d.submissionName!="new"&&b.currentRoute.value.name=="AssignmentSubmission"}),R=D(()=>{var e,s,i;return!t.doc||((e=t.doc)==null?void 0:e.owner)==((s=m.data)==null?void 0:s.name)&&((i=t.doc)==null?void 0:i.status)=="Not Graded"}),ne=D(()=>[{label:"Not Graded",value:"Not Graded"},{label:"Pass",value:"Pass"},{label:"Fail",value:"Fail"}]),oe=D(()=>t.doc?t.doc.status=="Pass"?"green":t.doc.status=="Not Graded"?"blue":"red":"orange"),L=()=>{var e;return["PDF","Image","Document"].includes((e=y.data)==null?void 0:e.type)};return(e,s)=>{var i,h,C,P,V,$,U,E,G;return a(y).data?(r(),c("div",{key:0,class:j(["grid grid-cols-2 h-full",{"border rounded-lg overflow-auto":!v.showTitle}])},[n("div",{class:j(["border-r p-5 overflow-y-auto h-[calc(100vh-3.2rem)]",{"h-full":!v.showTitle}])},[v.showTitle?(r(),c("div",he,[v.submissionName==="new"?(r(),c("div",we,o(e.__("Submission by"))+" "+o((i=a(m).data)==null?void 0:i.full_name),1)):(r(),c("div",ke,o(e.__("Submission by"))+" "+o((h=a(t).doc)==null?void 0:h.member_name),1))])):_("",!0),n("div",xe,o(e.__("Question"))+": ",1),n("div",{innerHTML:a(y).data.question,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal"},null,8,Se)],2),n("div",Ne,[n("div",De,[n("div",Le,[n("div",Te,o(e.__("Submission")),1),n("div",Fe,[g.value?(r(),x(a(q),{key:0,theme:"orange"},{default:S(()=>[F(o(e.__("Not Saved")),1)]),_:1})):(C=a(t).doc)!=null&&C.status?(r(),x(a(q),{key:1,theme:oe.value,size:"lg"},{default:S(()=>{var l;return[F(o((l=a(t).doc)==null?void 0:l.status),1)]}),_:1},8,["theme"])):_("",!0),p(a(z),{variant:"solid",onClick:s[0]||(s[0]=l=>I())},{default:S(()=>[F(o(e.__("Save")),1)]),_:1})])]),v.submissionName!="new"&&!["Pass","Fail"].includes((P=a(t).doc)==null?void 0:P.status)&&((V=a(t).doc)==null?void 0:V.owner)==(($=a(m).data)==null?void 0:$.name)?(r(),c("div",Ae,o(e.__("You've successfully submitted the assignment."))+" "+o(e.__("Once the moderator grades your submission, you'll find the details here."))+" "+o(e.__("Feel free to make edits to your submission if needed.")),1)):_("",!0),L()?(r(),c("div",Ce,[n("div",Ie,o(e.__("Add your assignment as {0}").format(a(y).data.type)),1),u.value?(r(),c("div",Re,[n("div",Me,[n("div",Pe,[p(a(fe),{class:"h-5 w-5 stroke-1.5"})]),n("a",{href:u.value.file_url,target:"_blank",class:"flex flex-col cursor-pointer !no-underline"},[n("span",$e,o(u.value.file_name),1),n("span",Ue,o(a(be)(u.value.file_size)),1)],8,Ve),R.value?(r(),x(a(ge),{key:0,onClick:s[2]||(s[2]=l=>te()),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})):_("",!0)])])):(r(),x(a(ce),{key:0,fileTypes:ee(),validateFile:se,onSuccess:s[1]||(s[1]=l=>J(l))},{default:S(({uploading:l,progress:ie,openFileSelector:re})=>[p(a(z),{onClick:re,loading:l},{default:S(()=>[F(o(l?e.__("Uploading {0}%").format(ie):e.__("Upload File")),1)]),_:2},1032,["onClick","loading"])]),_:1},8,["fileTypes"]))])):a(y).data.type=="URL"?(r(),c("div",Ee,[n("div",Ge,o(e.__("Enter a URL")),1),p(a(H),{modelValue:f.value,"onUpdate:modelValue":s[3]||(s[3]=l=>f.value=l),type:"text",readonly:!R.value},null,8,["modelValue","readonly"])])):(r(),c("div",Be,[n("div",je,o(e.__("Write your answer here")),1),p(a(O),{content:f.value,onChange:s[4]||(s[4]=l=>f.value=l),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])),((U=a(m).data)==null?void 0:U.name)==((E=a(t).doc)==null?void 0:E.owner)&&((G=a(t).doc)!=null&&G.comments)?(r(),c("div",qe,[n("div",ze,o(e.__("Comments by Evaluator"))+": ",1),n("div",{class:"leading-5 text-ink-gray-9",innerHTML:a(t).doc.comments},null,8,He)])):_("",!0),ae.value?(r(),c("div",Oe,[n("div",Ke,o(e.__("Grading")),1),a(t).doc?(r(),x(a(H),{key:0,modelValue:a(t).doc.status,"onUpdate:modelValue":s[5]||(s[5]=l=>a(t).doc.status=l),label:e.__("Grade"),type:"select",options:ne.value},null,8,["modelValue","label","options"])):_("",!0),n("div",null,[n("div",Qe,o(e.__("Comments")),1),p(a(O),{content:w.value,onChange:s[6]||(s[6]=l=>{w.value=l,g.value=!0}),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])])):_("",!0)])])],2)):_("",!0)}}},Xe={key:0,class:"flex justify-between sticky top-0 z-10 border-b bg-surface-white px-3 py-2.5 sm:px-5"},Ye={class:"overflow-hidden h-[calc(100vh-3.2rem)]"},es={__name:"AssignmentSubmission",props:{assignmentID:{type:String,required:!0},submissionName:{type:String,default:"new"}},setup(v){const u=K("$user"),f=N(!1),{brand:w}=ve(),b=v,m=A({url:"frappe.client.get_value",params:{doctype:"LMS Assignment",fieldname:"title",filters:{name:b.assignmentID}},auto:!0});Q(()=>{u.data||(window.location.href="/login"),new URLSearchParams(window.location.search).get("fromLesson")&&(f.value=!0)});const g=D(()=>{var k;return[{label:"Submissions",route:{name:"AssignmentSubmissionList"}},{label:(k=m.data)==null?void 0:k.title,route:{name:"AssignmentSubmission",params:{assignmentID:b.assignmentID}}}]});return _e(()=>{var d;return{title:(d=m.data)==null?void 0:d.title,icon:w.favicon}}),(d,k)=>(r(),c(pe,null,[f.value?_("",!0):(r(),c("header",Xe,[p(a(ye),{items:g.value},null,8,["items"])])),n("div",Ye,[p(We,{assignmentID:v.assignmentID,submissionName:v.submissionName,showTitle:!f.value},null,8,["assignmentID","submissionName","showTitle"])])],64))}};export{es as default};
//# sourceMappingURL=AssignmentSubmission-CnWgTCG6.js.map
