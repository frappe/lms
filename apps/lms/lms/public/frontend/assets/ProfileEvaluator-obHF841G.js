import{i as q,o as I,r as h,L,A as p,H as m,b as O,e as v,f as _,g as n,t as d,l,h as s,bj as R,k as E,b3 as W,F as Y,x as G,bk as y,q as c,b9 as H,b4 as X,n as w,p as F,P as J,_ as T,bl as K,aI as Q}from"./index-D24HXhLT.js";const Z={class:"mt-7 mb-20"},ee={class:"mb-4 text-lg font-semibold text-ink-gray-9"},ae={key:0,class:"flex items-center space-x-2 text-sm text-ink-gray-7 bg-surface-gray-1 px-3 py-2 rounded-md w-full text-center"},te={key:1},le={class:"grid grid-cols-3 md:grid-cols-4 gap-4 text-sm text-ink-gray-7 mb-4"},se={class:"grid grid-cols-3 md:grid-cols-4 gap-4 mb-4 group"},oe={class:"grid grid-cols-3 md:grid-cols-4 gap-4 mb-4"},ne={class:"my-10"},de={class:"mb-4 text-lg font-semibold text-ink-gray-9"},ue={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},re={class:"mb-4 text-lg font-semibold text-ink-gray-9"},ie={key:0,class:"flex items-center bg-surface-green-2 text-green-900 text-sm p-1 rounded-md mb-4 w-fit"},ce={__name:"ProfileEvaluator",props:{profile:{type:Object,required:!0}},setup(P){var U;const M=q("$user"),z=window.read_only_mode,g=P;I(()=>{var e,a,i;((e=M.data)==null?void 0:e.name)!==((a=g.profile.data)==null?void 0:a.name)&&(window.location.href=`/user/${(i=g.profile.data)==null?void 0:i.username}`)});const V=h(0),b=h(null),f=h(null),o=L({day:"",start_time:"",end_time:""}),u=p({url:"lms.lms.api.get_evaluator_details",params:{evaluator:(U=g.profile.data)==null?void 0:U.name},auto:!0,onSuccess(e){e.slots.unavailable_from&&(b.value=e.slots.unavailable_from),e.slots.unavailable_to&&(f.value=e.slots.unavailable_to)}}),A=p({url:"frappe.client.insert",makeParams(e){var a;return{doc:{doctype:"Evaluator Schedule",parent:(a=u.data)==null?void 0:a.slots.name,parentfield:"schedule",parenttype:"Course Evaluator",...o}}},onSuccess(){m.success(__("Slot added successfully")),u.reload(),V.value=0,o.day="",o.start_time="",o.end_time=""},onError(e){var a;m.error(((a=e.messages)==null?void 0:a[0])||e)}}),B=p({url:"frappe.client.set_value",makeParams(e){return{doctype:"Evaluator Schedule",name:e.name,fieldname:e.field,value:e.value}},onSuccess(){m.success(__("Availability updated successfully"))},onError(e){var a;m.error(((a=e.messages)==null?void 0:a[0])||e)}}),N=p({url:"frappe.client.delete",makeParams(e){return{doctype:"Evaluator Schedule",name:e.name}},onSuccess(){m.success(__("Slot deleted successfully")),u.reload()},onError(e){var a;m.error(((a=e.messages)==null?void 0:a[0])||e)}}),x=p({url:"frappe.client.set_value",makeParams(e){var a;return{doctype:"Course Evaluator",name:(a=u.data)==null?void 0:a.slots.name,fieldname:e.field,value:e.value}},onSuccess(){m.success(__("Unavailability updated successfully"))},onError(e){var a;m.error(((a=e.messages)==null?void 0:a[0])||e)}}),k=(e,a,i)=>{B.submit({name:e,field:a,value:i},{validate(){if(!i)return`Please enter a value for ${Q(a)}`}})},S=()=>{!o.day||!o.start_time||!o.end_time||A.submit()},j=e=>{N.submit({name:e})},D=p({url:"frappe.integrations.doctype.google_calendar.google_calendar.authorize_access",makeParams(){var e;return{g_calendar:(e=u.data)==null?void 0:e.calendar,reauthorize:1}},onSuccess(e){window.open(e.url)}}),C=O(()=>[{label:"Monday",value:"Monday"},{label:"Tuesday",value:"Tuesday"},{label:"Wednesday",value:"Wednesday"},{label:"Thursday",value:"Thursday"},{label:"Friday",value:"Friday"},{label:"Saturday",value:"Saturday"},{label:"Sunday",value:"Sunday"}]);return(e,a)=>{var i,$;return _(),v("div",Z,[n("h2",ee,d(e.__("My availability")),1),l(z)?(_(),v("div",ae,[s(l(R),{class:"size-4 stroke-1.5"}),n("span",null,d(e.__("You cannot change the availability when the site is being updated.")),1)])):(_(),v("div",te,[n("div",null,[n("div",le,[n("div",null,d(e.__("Day")),1),n("div",null,d(e.__("Start Time")),1),n("div",null,d(e.__("End Time")),1)]),l(u).data?(_(!0),v(Y,{key:0},G(l(u).data.slots.schedule,t=>(_(),v("div",se,[s(l(c),{type:"select",options:C.value,modelValue:t.day,"onUpdate:modelValue":r=>t.day=r,onFocusout:y(r=>k(t.name,"day",t.day),["stop"])},null,8,["options","modelValue","onUpdate:modelValue","onFocusout"]),s(l(c),{type:"time",modelValue:t.start_time,"onUpdate:modelValue":r=>t.start_time=r,onFocusout:y(r=>k(t.name,"start_time",t.start_time),["stop"])},null,8,["modelValue","onUpdate:modelValue","onFocusout"]),s(l(c),{type:"time",modelValue:t.end_time,"onUpdate:modelValue":r=>t.end_time=r,onFocusout:y(r=>k(t.name,"end_time",t.end_time),["stop"])},null,8,["modelValue","onUpdate:modelValue","onFocusout"]),s(l(H),{onClick:r=>j(t.name),class:"w-6 h-auto stroke-1.5 text-red-900 rounded-md cursor-pointer p-1 bg-surface-red-2 hidden group-hover:block"},null,8,["onClick"])]))),256)):E("",!0),W(n("div",oe,[s(l(c),{type:"select",options:C.value,modelValue:o.day,"onUpdate:modelValue":a[0]||(a[0]=t=>o.day=t),onFocusout:a[1]||(a[1]=y(t=>S(),["stop"]))},null,8,["options","modelValue"]),s(l(c),{type:"time",modelValue:o.start_time,"onUpdate:modelValue":a[2]||(a[2]=t=>o.start_time=t),onFocusout:a[3]||(a[3]=y(t=>S(),["stop"]))},null,8,["modelValue"]),s(l(c),{type:"time",modelValue:o.end_time,"onUpdate:modelValue":a[4]||(a[4]=t=>o.end_time=t),onFocusout:a[5]||(a[5]=y(t=>S(),["stop"]))},null,8,["modelValue"])],512),[[X,V.value]]),s(l(T),{onClick:a[6]||(a[6]=t=>V.value=1)},{prefix:w(()=>[s(l(J),{class:"w-4 h-4 stroke-1.5 text-ink-gray-7"})]),default:w(()=>[F(" "+d(e.__("Add Slot")),1)]),_:1})]),n("div",ne,[n("h2",de,d(e.__("I am unavailable")),1),n("div",ue,[s(l(c),{type:"date",label:e.__("From"),modelValue:b.value,"onUpdate:modelValue":a[7]||(a[7]=t=>b.value=t),onBlur:a[8]||(a[8]=()=>{l(x).submit({field:"unavailable_from",value:b.value})})},null,8,["label","modelValue"]),s(l(c),{type:"date",label:e.__("To"),modelValue:f.value,"onUpdate:modelValue":a[9]||(a[9]=t=>f.value=t),onBlur:a[10]||(a[10]=()=>{l(x).submit({field:"unavailable_to",value:f.value})})},null,8,["label","modelValue"])])]),n("div",null,[n("h2",re,d(e.__("My calendar")),1),(i=l(u).data)!=null&&i.calendar&&(($=l(u).data)!=null&&$.is_authorized)?(_(),v("div",ie,[s(l(K),{class:"h-4 w-4 stroke-1.5 mr-2"}),F(" "+d(e.__("Your calendar is set.")),1)])):E("",!0),s(l(T),{onClick:a[11]||(a[11]=()=>l(D).submit())},{default:w(()=>[F(d(e.__("Authorize Google Calendar Access")),1)]),_:1})])]))])}}};export{ce as default};
//# sourceMappingURL=ProfileEvaluator-obHF841G.js.map
