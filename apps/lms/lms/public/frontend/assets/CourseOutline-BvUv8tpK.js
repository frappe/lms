import{aq as K,b as F,o as oe,bt as re,r as E,bf as me,bG as fe,bB as I,bC as Z,bH as B,bu as ne,bY as ge,bZ as U,bK as Y,bF as W,b_ as _e,bE as ee,i as q,J as ve,K as te,aw as ke,L as be,A as M,w as he,j as v,f as u,n as y,g as k,h as x,e as L,k as h,l as o,q as ye,aH as Ce,b6 as xe,_ as H,p as z,t as O,b7 as ie,b8 as De,b9 as Se,M as we,H as S,I as $e,R as Ee,z as Oe,as as Pe,d as Ne,C as T,F as ae,x as Ve,a1 as Me,O as se,b$ as Le,bk as j,ao as le,c0 as Ie,c1 as Be,bl as Te,N as Re}from"./index-D24HXhLT.js";import{D as ze}from"./vuedraggable.umd-D_03Sejs.js";var Fe=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Fe||{});let ue=Symbol("DisclosureContext");function G(e){let f=q(ue,null);if(f===null){let b=new Error(`<${e} /> is missing a parent <Disclosure /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(b,G),b}return f}let ce=Symbol("DisclosurePanelContext");function Ue(){return q(ce,null)}let qe=K({name:"Disclosure",props:{as:{type:[Object,String],default:"template"},defaultOpen:{type:[Boolean],default:!1}},setup(e,{slots:f,attrs:b}){let g=E(e.defaultOpen?0:1),a=E(null),_=E(null),t={buttonId:E(`headlessui-disclosure-button-${W()}`),panelId:E(`headlessui-disclosure-panel-${W()}`),disclosureState:g,panel:a,button:_,toggleDisclosure(){g.value=ee(g.value,{0:1,1:0})},closeDisclosure(){g.value!==1&&(g.value=1)},close(i){t.closeDisclosure();let p=i?i instanceof HTMLElement?i:i.value instanceof HTMLElement?I(i):I(t.button):I(t.button);p==null||p.focus()}};return ne(ue,t),_e(F(()=>ee(g.value,{0:U.Open,1:U.Closed}))),()=>{let{defaultOpen:i,...p}=e,m={open:g.value===0,close:t.close};return Z({theirProps:p,ourProps:{},slot:m,slots:f,attrs:b,name:"Disclosure"})}}}),Ae=K({name:"DisclosureButton",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1},id:{type:String,default:null}},setup(e,{attrs:f,slots:b,expose:g}){let a=G("DisclosureButton"),_=Ue(),t=F(()=>_===null?!1:_.value===a.panelId.value);oe(()=>{t.value||e.id!==null&&(a.buttonId.value=e.id)}),re(()=>{t.value||(a.buttonId.value=null)});let i=E(null);g({el:i,$el:i}),t.value||me(()=>{a.button.value=i.value});let p=fe(F(()=>({as:e.as,type:f.type})),i);function m(){var d;e.disabled||(t.value?(a.toggleDisclosure(),(d=I(a.button))==null||d.focus()):a.toggleDisclosure())}function w(d){var $;if(!e.disabled)if(t.value)switch(d.key){case B.Space:case B.Enter:d.preventDefault(),d.stopPropagation(),a.toggleDisclosure(),($=I(a.button))==null||$.focus();break}else switch(d.key){case B.Space:case B.Enter:d.preventDefault(),d.stopPropagation(),a.toggleDisclosure();break}}function P(d){switch(d.key){case B.Space:d.preventDefault();break}}return()=>{var d;let $={open:a.disclosureState.value===0},{id:l,...r}=e,n=t.value?{ref:i,type:p.value,onClick:m,onKeydown:w}:{id:(d=a.buttonId.value)!=null?d:l,ref:i,type:p.value,"aria-expanded":a.disclosureState.value===0,"aria-controls":a.disclosureState.value===0||I(a.panel)?a.panelId.value:void 0,disabled:e.disabled?!0:void 0,onClick:m,onKeydown:w,onKeyup:P};return Z({ourProps:n,theirProps:r,slot:$,attrs:f,slots:b,name:"DisclosureButton"})}}}),je=K({name:"DisclosurePanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:null}},setup(e,{attrs:f,slots:b,expose:g}){let a=G("DisclosurePanel");oe(()=>{e.id!==null&&(a.panelId.value=e.id)}),re(()=>{a.panelId.value=null}),g({el:a.panel,$el:a.panel}),ne(ce,a.panelId);let _=ge(),t=F(()=>_!==null?(_.value&U.Open)===U.Open:a.disclosureState.value===0);return()=>{var i;let p={open:a.disclosureState.value===0,close:a.close},{id:m,...w}=e,P={id:(i=a.panelId.value)!=null?i:m,ref:a.panel};return Z({ourProps:P,theirProps:w,slot:p,attrs:f,slots:b,features:Y.RenderStrategy|Y.Static,visible:t.value,name:"DisclosurePanel"})}}});const He={class:"space-y-4 text-base"},Ke={key:0},Ze={class:"mb-4"},Ge={key:1,class:""},Je={class:"flex items-center"},Qe={class:"border rounded-md p-2 mr-2"},Xe={class:"flex flex-col"},Ye={class:"text-sm text-ink-gray-4 mt-1"},We={__name:"ChapterModal",props:ve({course:{type:String,required:!0},chapterDetail:{type:Object}},{modelValue:{},modelModifiers:{},outline:{},outlineModifiers:{}}),emits:["update:modelValue","update:outline"],setup(e){const f=te(e,"modelValue"),b=te(e,"outline"),g=q("$user"),{updateOnboardingStep:a}=ke("learning"),_=e,t=be({title:"",is_scorm_package:0,scorm_package:null}),i=M({url:"lms.lms.api.upsert_chapter",makeParams(l){var r;return{title:t.title,course:_.course,is_scorm_package:t.is_scorm_package,scorm_package:t.scorm_package,name:(r=_.chapterDetail)==null?void 0:r.name}}}),p=M({url:"frappe.client.insert",makeParams(l){return{doc:{doctype:"Chapter Reference",chapter:l.name,parent:_.course,parenttype:"LMS Course",parentfield:"chapters"}}}}),m=async l=>{i.submit({},{validate(){return w()},onSuccess:r=>{var n;(n=g.data)!=null&&n.is_system_manager&&a("create_first_chapter"),$e("chapter_created"),p.submit({name:r.name},{onSuccess(N){P(),b.value.reload(),S.success(__("Chapter added successfully"))},onError(N){var V;S.error(((V=N.messages)==null?void 0:V[0])||N)}}),l()},onError(r){var n;S.error(((n=r.messages)==null?void 0:n[0])||r)}})},w=()=>{if(!t.title)return __("Title is required");if(t.is_scorm_package&&!t.scorm_package)return __("Please upload a SCORM package")},P=()=>{t.title="",t.is_scorm_package=0,t.scorm_package=null},d=l=>{i.submit({},{validate(){if(!t.title)return"Title is required"},onSuccess(){b.value.reload(),S.success(__("Chapter updated successfully")),l()},onError(r){var n;S.error(((n=r.messages)==null?void 0:n[0])||r)}})};he(()=>_.chapterDetail,l=>{t.title=l==null?void 0:l.title,t.is_scorm_package=l==null?void 0:l.is_scorm_package,t.scorm_package=l==null?void 0:l.scorm_package});const $=l=>{if(l.name.split(".").pop().toLowerCase()!=="zip")return __("Only zip files are allowed")};return(l,r)=>(u(),v(o(we),{modelValue:f.value,"onUpdate:modelValue":r[4]||(r[4]=n=>f.value=n),options:{title:e.chapterDetail?l.__("Edit Chapter"):l.__("Add Chapter"),size:"lg",actions:[{label:e.chapterDetail?l.__("Edit"):l.__("Create"),variant:"solid",onClick:n=>e.chapterDetail?d(n):m(n)}]}},{"body-content":y(()=>[k("div",He,[x(o(ye),{label:"Title",modelValue:t.title,"onUpdate:modelValue":r[0]||(r[0]=n=>t.title=n),required:!0},null,8,["modelValue"]),x(o(Ce),{size:"sm",label:l.__("SCORM Package"),description:l.__("Enable this only if you want to upload a SCORM package as a chapter."),modelValue:t.is_scorm_package,"onUpdate:modelValue":r[1]||(r[1]=n=>t.is_scorm_package=n)},null,8,["label","description","modelValue"]),t.is_scorm_package?(u(),L("div",Ke,[t.scorm_package?(u(),L("div",Ge,[k("div",Je,[k("div",Qe,[x(o(ie),{class:"h-5 w-5 stroke-1.5 text-ink-gray-7"})]),k("div",Xe,[k("span",null,O(t.scorm_package.file_name),1),k("span",Ye,O(o(De)(t.scorm_package.file_size)),1)]),x(o(Se),{onClick:r[3]||(r[3]=()=>t.scorm_package=null),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})])])):(u(),v(o(xe),{key:0,fileTypes:[".zip"],validateFile:$,onSuccess:r[2]||(r[2]=n=>t.scorm_package=n)},{default:y(({file:n,progress:N,uploading:V,openFileSelector:A})=>[k("div",Ze,[x(o(H),{onClick:A,loading:V},{default:y(()=>[z(O(V?`Uploading ${N}%`:"Upload an ZIP file"),1)]),_:2},1032,["onClick","loading"])])]),_:1}))])):h("",!0)])]),_:1},8,["modelValue","options"]))}},et={class:""},tt=["onClick"],at={class:"flex ml-auto space-x-4"},st={class:"flex items-center text-sm leading-5 group"},lt={key:1,class:"flex mt-2 mb-4 pl-8"},it={__name:"CourseOutline",props:{courseName:{type:String,required:!0},showOutline:{type:Boolean,default:!1},title:{type:String,default:""},allowEdit:{type:Boolean,default:!1},getProgress:{type:Boolean,default:!1}},setup(e){const f=Ee(),b=Oe(),g=q("$user"),a=E(!1),_=E(null),t=Pe(),{$dialog:i}=t.appContext.config.globalProperties,p=e,m=M({url:"lms.lms.utils.get_course_outline",cache:["course_outline",p.courseName],params:{course:p.courseName,progress:p.getProgress},auto:!0}),w=M({url:"lms.lms.api.delete_lesson",makeParams(s){return{lesson:s.lesson,chapter:s.chapter}},onSuccess(){m.reload(),S.success(__("Lesson deleted successfully"))}}),P=M({url:"lms.lms.api.update_lesson_index",makeParams(s){return{lesson:s.lesson,sourceChapter:s.sourceChapter,targetChapter:s.targetChapter,idx:s.idx}},onSuccess(){S.success(__("Lesson moved successfully"))}}),d=(s,D)=>{i({title:__("Delete this lesson?"),message:__("Deleting this lesson will permanently remove it from the course. This action cannot be undone. Are you sure you want to continue?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick(R){w.submit({lesson:s,chapter:D}),R()}}]})},$=s=>s==f.params.chapterNumber||s==1,l=(s=null)=>{_.value=s,a.value=!0},r=()=>_.value,n=s=>{P.submit({lesson:s.item.__draggable_context.element.name,sourceChapter:s.from.dataset.chapter,targetChapter:s.to.dataset.chapter,idx:s.newIndex})},N=M({url:"lms.lms.api.delete_chapter",makeParams(s){return{chapter:s.chapter}},onSuccess(){m.reload(),S.success(__("Chapter deleted successfully"))}}),V=s=>{i({title:__("Delete this chapter?"),message:__("Deleting this chapter will also delete all its lessons and permanently remove it from the course. This action cannot be undone. Are you sure you want to continue?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick(D){N.submit({chapter:s}),D()}}]})},A=s=>{if(s.is_scorm_package&&(event.preventDefault(),!p.allowEdit)){if(!g.data){S.success(__("Please enroll for this course to view this lesson"));return}b.push({name:"SCORMChapter",params:{courseName:p.courseName,chapterName:s.name}})}},de=s=>f.params.chapterNumber==s.split(".")[0]&&f.params.lessonNumber==s.split(".")[1];return(s,D)=>{var J,Q;const R=Ne("router-link");return u(),L(ae,null,[k("div",et,[e.title&&((J=o(m).data)!=null&&J.length||e.allowEdit)?(u(),L("div",{key:0,class:T(["flex items-center justify-between space-x-2 mb-4 px-2",{"sticky top-0 z-10 bg-surface-white border-b px-3 py-2.5 sm:px-5":e.allowEdit}])},[k("div",{class:T(["font-semibold text-lg leading-5 text-ink-gray-9",{"font-medium text-p-base":e.allowEdit}])},O(s.__(e.title)),3),e.allowEdit?(u(),v(o(H),{key:0,size:"sm",onClick:D[0]||(D[0]=c=>l())},{default:y(()=>[z(O(s.__("Add Chapter")),1)]),_:1})):h("",!0)],2)):h("",!0),k("div",{class:T({"border-2 rounded-md py-2 px-2":e.showOutline&&((Q=o(m).data)==null?void 0:Q.length)})},[(u(!0),L(ae,null,Ve(o(m).data,(c,pe)=>(u(),v(o(qe),{key:c.name,defaultOpen:$(c.idx)},{default:y(({open:X})=>[x(o(Ae),{ref_for:!0,ref:"",class:"flex items-center w-full p-2 group"},{default:y(()=>[x(o(Me),{class:T([{"rotate-90 transform duration-200":X,"duration-200":!X,hidden:c.is_scorm_package,open:pe==1},"h-4 w-4 text-ink-gray-9 stroke-1"])},null,8,["class"]),k("div",{class:"text-base text-left text-ink-gray-9 font-medium leading-5 ml-2",onClick:C=>A(c)},O(c.title),9,tt),k("div",at,[x(o(se),{text:s.__("Edit Chapter"),placement:"bottom"},{default:y(()=>[e.allowEdit?(u(),v(o(Le),{key:0,onClick:j(C=>l(c),["prevent"]),class:"h-4 w-4 text-ink-gray-9 invisible group-hover:visible"},null,8,["onClick"])):h("",!0)]),_:2},1032,["text"]),x(o(se),{text:s.__("Delete Chapter"),placement:"bottom"},{default:y(()=>[e.allowEdit?(u(),v(o(le),{key:0,onClick:j(C=>V(c.name),["prevent"]),class:"h-4 w-4 text-ink-red-3 invisible group-hover:visible"},null,8,["onClick"])):h("",!0)]),_:2},1032,["text"])])]),_:2},1536),c.is_scorm_package?h("",!0):(u(),v(o(je),{key:0},{default:y(()=>[c.is_scorm_package?h("",!0):(u(),v(o(ze),{key:0,list:c.lessons,disabled:!e.allowEdit,"item-key":"name",group:"items",onEnd:n,"data-chapter":c.name},{item:y(({element:C})=>[k("div",{class:T(["outline-lesson pl-8 py-2 pr-4 text-ink-gray-9",de(C.number)?"bg-surface-gray-3":""])},[x(R,{to:{name:e.allowEdit?"LessonForm":"Lesson",params:{courseName:e.courseName,chapterNumber:C.number.split(".")[0],lessonNumber:C.number.split(".")[1]}}},{default:y(()=>[k("div",st,[C.icon==="icon-youtube"?(u(),v(o(Ie),{key:0,class:"h-4 w-4 stroke-1 mr-2"})):C.icon==="icon-quiz"?(u(),v(o(Be),{key:1,class:"h-4 w-4 stroke-1 mr-2"})):C.icon==="icon-list"?(u(),v(o(ie),{key:2,class:"h-4 w-4 text-ink-gray-9 stroke-1 mr-2"})):h("",!0),z(" "+O(C.title)+" ",1),e.allowEdit?(u(),v(o(le),{key:3,onClick:j(ot=>d(C.name,c.name),["prevent"]),class:"h-4 w-4 text-ink-red-3 ml-auto invisible group-hover:visible"},null,8,["onClick"])):h("",!0),C.is_complete?(u(),v(o(Te),{key:4,class:"h-4 w-4 text-green-700 ml-2"})):h("",!0)])]),_:2},1032,["to"])],2)]),_:2},1032,["list","disabled","data-chapter"])),e.allowEdit?(u(),L("div",lt,[c.is_scorm_package?h("",!0):(u(),v(R,{key:0,to:{name:"LessonForm",params:{courseName:e.courseName,chapterNumber:c.idx,lessonNumber:c.lessons.length+1}}},{default:y(()=>[x(o(H),null,{default:y(()=>[z(O(s.__("Add Lesson")),1)]),_:1})]),_:2},1032,["to"]))])):h("",!0)]),_:2},1024))]),_:2},1032,["defaultOpen"]))),128))],2)]),o(g).data?(u(),v(We,{key:0,modelValue:a.value,"onUpdate:modelValue":D[1]||(D[1]=c=>a.value=c),outline:o(m),"onUpdate:outline":D[2]||(D[2]=c=>Re(m)?m.value=c:null),course:e.courseName,chapterDetail:r()},null,8,["modelValue","outline","course","chapterDetail"])):h("",!0)],64)}}};export{it as _};
//# sourceMappingURL=CourseOutline-BvUv8tpK.js.map
