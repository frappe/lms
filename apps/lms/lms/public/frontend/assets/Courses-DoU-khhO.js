import{i as k,r as i,s as X,o as Z,c as ee,a as S,w as te,b as L,u as ae,d as le,e as h,f as c,g as v,h as p,j as C,k as w,l as s,m as se,n as b,_ as F,p as N,t as x,P as oe,q as P,v as re,F as U,x as ne,y as ue}from"./index-D24HXhLT.js";import{_ as ie}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-DRN2bHzK.js";import{T as de}from"./TabButtons-C21neZP3.js";import{_ as ce}from"./CourseCard-9Y8ICiAe.js";import{_ as pe}from"./EmptyState.vue_vue_type_script_setup_true_lang-_-SuznPy.js";import"./UserAvatar-CNqvj4u9.js";import"./CourseInstructors-AYbj4319.js";import"./ProgressBar-rBBAZ6HI.js";const ve={class:"sticky flex items-center justify-between top-0 z-10 border-b bg-surface-white px-3 py-2.5 sm:px-5"},me={class:"p-5 pb-10"},fe={class:"flex flex-col lg:flex-row space-y-4 lg:space-y-0 lg:items-center justify-between mb-5"},ge={class:"text-lg text-ink-gray-9 font-semibold"},_e={class:"flex flex-col space-y-2 lg:space-y-0 lg:flex-row lg:items-center lg:space-x-4"},ye={class:"grid grid-cols-2 gap-2"},be={class:"min-w-40 lg:min-w-0 lg:w-32 xl:w-40"},he={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-4"},Ce={key:2,class:"flex justify-center mt-5"},Pe={__name:"Courses",setup(we){var $;const n=k("$user"),j=k("$dayjs"),M=i(0),T=i(30),m=i([]),f=i(null),g=i(""),_=i(!1),a=i({}),u=i("Live"),{brand:E}=X(),V=i(0);Z(()=>{B(),y(),R(),m.value=[{label:"",value:null}]});const B=()=>{let e=new URLSearchParams(location.search);g.value=e.get("title")||"",f.value=e.get("category")||null,_.value=e.get("certification")||!1},d=ee({doctype:"LMS Course",url:"lms.lms.utils.get_courses",cache:["courses",($=n.data)==null?void 0:$.name],pageLength:T.value,start:M.value,onSuccess(e){q(e)}}),q=e=>{let t=e.map(l=>l.category);t=t.filter((l,r)=>t.indexOf(l)===r&&l),m.value.length<=t.length&&H(e)},D=async()=>await S("frappe.client.get_single_value",{doctype:"LMS Settings",field:"persona_captured"}),Y=async()=>{var e,t;if((e=n.data)!=null&&e.is_system_manager&&!((t=n.data)!=null&&t.developer_mode)){if(await D())return;V.value||ue.push({name:"PersonaForm"})}},R=()=>{n.data&&S("frappe.client.get_count",{doctype:"LMS Course"}).then(e=>{V.value=e,Y()})},y=()=>{O(),d.update({filters:a.value}),d.reload()},O=()=>{Q(),z(),A(),I(),K(),G()},Q=()=>{f.value?a.value.category=f.value:delete a.value.category},z=()=>{g.value?a.value.title=["like",`%${g.value}%`]:delete a.value.title},A=()=>{_.value?a.value.certification=1:delete a.value.certification},I=()=>{var e;delete a.value.live,delete a.value.created,delete a.value.published_on,delete a.value.upcoming,u.value=="Enrolled"&&((e=n.data)!=null&&e.is_student)?(a.value.enrolled=1,delete a.value.published):(delete a.value.published,delete a.value.enrolled,u.value=="Live"?(a.value.published=1,a.value.upcoming=0,a.value.live=1):u.value=="Upcoming"?(a.value.upcoming=1,a.value.published=1):u.value=="New"?(a.value.published=1,a.value.published_on=[">=",j().add(-3,"month").format("YYYY-MM-DD")]):u.value=="Created"&&(a.value.created=1))},K=()=>{var e;(!n.data||(e=n.data)!=null&&e.is_student&&u.value!="Enrolled")&&(a.value.published=1)},G=()=>{let e=new URLSearchParams(location.search),t={title:g.value,category:f.value,certification:_.value};Object.keys(t).forEach(r=>{t[r]?e.set(r,t[r]):e.delete(r)});let l="";e.toString()&&(l=`?${e.toString()}`),history.replaceState({},"",`${location.pathname}${l}`)},H=e=>{e.forEach(t=>{t.category&&!m.value.find(l=>l.value===t.category)&&m.value.push({label:t.category,value:t.category})})};te(u,()=>{y()});const J=L(()=>{var t,l,r;let e=[{label:__("Live")},{label:__("New")},{label:__("Upcoming")}];return(t=n.data)!=null&&t.is_moderator||(l=n.data)!=null&&l.is_instructor||(r=n.data)!=null&&r.is_evaluator?e.push({label:__("Created")}):n.data&&e.push({label:__("Enrolled")}),e}),W=L(()=>[{label:__("Courses"),route:{name:"Courses"}}]);return ae(()=>({title:__("Courses"),icon:E.favicon})),(e,t)=>{var r;const l=le("router-link");return c(),h(U,null,[v("header",ve,[p(s(ie),{items:W.value},null,8,["items"]),s(se)()?(c(),C(l,{key:0,to:{name:"CourseForm",params:{courseName:"new"}}},{default:b(()=>[p(s(F),{variant:"solid"},{prefix:b(()=>[p(s(oe),{class:"h-4 w-4 stroke-1.5"})]),default:b(()=>[N(" "+x(e.__("New")),1)]),_:1})]),_:1})):w("",!0)]),v("div",me,[v("div",fe,[v("div",ge,x(e.__("All Courses")),1),v("div",_e,[p(s(de),{buttons:J.value,modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=o=>u.value=o)},null,8,["buttons","modelValue"]),p(s(P),{modelValue:_.value,"onUpdate:modelValue":t[1]||(t[1]=o=>_.value=o),label:e.__("Certification"),type:"checkbox",onChange:t[2]||(t[2]=o=>y())},null,8,["modelValue","label"]),v("div",ye,[p(s(P),{modelValue:g.value,"onUpdate:modelValue":t[3]||(t[3]=o=>g.value=o),placeholder:e.__("Search by Title"),type:"text",class:"min-w-40 lg:min-w-0 lg:w-32 xl:w-40",onInput:t[4]||(t[4]=o=>y())},null,8,["modelValue","placeholder"]),v("div",be,[m.value.length?(c(),C(s(re),{key:0,modelValue:f.value,"onUpdate:modelValue":t[5]||(t[5]=o=>f.value=o),options:m.value,placeholder:e.__("Category"),onChange:t[6]||(t[6]=o=>y())},null,8,["modelValue","options","placeholder"])):w("",!0)])])])]),(r=s(d).data)!=null&&r.length?(c(),h("div",he,[(c(!0),h(U,null,ne(s(d).data,o=>(c(),C(l,{to:{name:"CourseDetail",params:{courseName:o.name}}},{default:b(()=>[p(ce,{course:o},null,8,["course"])]),_:2},1032,["to"]))),256))])):s(d).list.loading?w("",!0):(c(),C(pe,{key:1,type:"Courses"})),!s(d).list.loading&&s(d).hasNextPage?(c(),h("div",Ce,[p(s(F),{onClick:t[7]||(t[7]=o=>s(d).next())},{default:b(()=>[N(x(e.__("Load More")),1)]),_:1})])):w("",!0)])],64)}}};export{Pe as default};
//# sourceMappingURL=Courses-DoU-khhO.js.map
