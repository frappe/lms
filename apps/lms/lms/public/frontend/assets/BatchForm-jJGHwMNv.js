import{z,i as R,s as A,aw as F,L as K,r as G,o as H,A as p,I as C,T as X,H as x,b as J,u as Q,e as g,f as b,g as s,h as o,l as i,n as _,p as f,t as d,_ as h,q as r,ax as y,aG as W,ag as v,j as Y,bX as Z,b6 as ee,k as ae}from"./index-D24HXhLT.js";import{_ as te}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-DRN2bHzK.js";import{_ as le}from"./MultiSelect-BZ6Y_89x.js";const se={class:""},oe={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},ie={class:"py-5"},ne={class:"px-20 pb-5 space-y-5 border-b mb-5"},re={class:"text-lg text-ink-gray-9 font-semibold mb-4"},de={class:"grid grid-cols-2 gap-5"},me={class:"space-y-5"},ue={class:"px-20 pb-5 space-y-5 border-b mb-5"},ce={class:"text-lg text-ink-gray-9 font-semibold mb-4"},pe={class:"grid grid-cols-3 gap-5"},be={class:"px-20 pb-5 space-y-5 border-b mb-5"},_e={class:"text-lg text-ink-gray-9 font-semibold mb-4"},fe={class:"grid grid-cols-3 gap-10"},ge={class:"space-y-5"},he={class:"space-y-5"},ye={class:"space-y-5"},ve={class:"px-20 pb-5 space-y-5 border-b mb-5"},Ve={class:"block text-sm text-ink-gray-5 mb-1"},we={class:"px-20 pb-5 space-y-5 border-b mb-5"},ke={class:"text-lg text-ink-gray-9 font-semibold mb-4"},Be={class:"grid grid-cols-3 gap-10"},Ue={class:"space-y-5"},Se={class:"space-y-5"},Ce={class:"space-y-5"},xe={class:"text-xs text-ink-gray-5"},Ne={class:"flex items-center"},Ee={class:"border rounded-md w-fit py-5 px-20"},De={class:"ml-4"},Te={class:"mt-1 text-ink-gray-5 text-sm leading-5"},Le={key:1,class:"mb-4"},Me={class:"flex items-center"},qe=["src"],Oe={class:"ml-4"},$e={class:"mt-2 text-ink-gray-5 text-sm"},Pe={class:"px-20 pb-5 space-y-5"},Ie={class:"text-lg text-ink-gray-9 font-semibold"},je={key:0,class:"grid grid-cols-3 gap-5"},Fe={__name:"BatchForm",props:{batchName:{type:String,required:!0}},setup(N){const V=z(),w=R("$user"),{brand:E}=A(),{updateOnboardingStep:D}=F("learning"),m=N,l=K({title:"",published:!1,description:"",batch_details:"",start_date:"",end_date:"",start_time:"",end_time:"",timezone:"",evaluation_end_date:"",confirmation_email_template:"",seat_count:"",medium:"",category:"",allow_self_enrollment:!1,certification:!1,image:null,paid_batch:!1,currency:"",amount:0}),u=G([]);H(()=>{w.data||(window.location.href="/login"),m.batchName!="new"?c.reload():C("batch_form_opened"),window.addEventListener("keydown",k)});const k=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&!e.target.classList.contains("ProseMirror")&&(B(),e.preventDefault())};X(()=>{window.removeEventListener("keydown",k)});const T=p({url:"frappe.client.insert",makeParams(e){var a;return{doc:{doctype:"LMS Batch",meta_image:(a=l.image)==null?void 0:a.file_url,instructors:u.value.map(t=>({instructor:t})),...l}}}}),c=p({url:"frappe.client.get",makeParams(e){return{doctype:"LMS Batch",name:m.batchName}},onSuccess(e){Object.keys(e).forEach(t=>{if(t=="instructors")e.instructors.forEach(n=>{u.value.push(n.instructor)});else if(["start_time","end_time"].includes(t)){let[n,U,S]=e[t].split(":");n=n.length==1?"0"+n:n,l[t]=`${n}:${U}`}else Object.hasOwn(l,t)&&(l[t]=e[t])});let a=["published","paid_batch","allow_self_enrollment","certification"];for(let t in a){let n=a[t];l[n]=!!l[n]}e.meta_image&&M.reload({image:e.meta_image})}}),L=p({url:"frappe.client.set_value",makeParams(e){var a;return{doctype:"LMS Batch",name:m.batchName,fieldname:{meta_image:(a=l.image)==null?void 0:a.file_url,instructors:u.value.map(t=>({instructor:t})),...l}}}}),M=p({url:"lms.lms.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){l.image=e}}),B=()=>{c.data?O():q()},q=()=>{T.submit({},{onSuccess(e){var a;(a=w.data)!=null&&a.is_system_manager&&D("create_first_batch",!0,!1,()=>{localStorage.setItem("firstBatch",e.name)}),C("batch_created"),V.push({name:"BatchDetail",params:{batchName:e.name}})},onError(e){var a;x.error(((a=e.messages)==null?void 0:a[0])||e)}})},O=()=>{L.submit({},{onSuccess(e){V.push({name:"BatchDetail",params:{batchName:e.name}})},onError(e){var a;x.error(((a=e.messages)==null?void 0:a[0])||e)}})},$=e=>{l.image=e},P=()=>{l.image=null},I=e=>{let a=e.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png"].includes(a))return"Only image file is allowed."},j=J(()=>{let e=[{label:"Batches",route:{name:"Batches"}}];return c.data&&e.push({label:c.data.title,route:{name:"BatchDetail",params:{batchName:m.batchName}}}),e.push({label:m.batchName=="new"?"New Batch":"Edit Batch",route:{name:"BatchForm",params:{batchName:m.batchName}}}),e});return Q(()=>{var e;return{title:m.batchName=="new"?"New Batch":(e=c.data)==null?void 0:e.title,icon:E.favicon}}),(e,a)=>(b(),g("div",se,[s("header",oe,[o(i(te),{class:"h-7",items:j.value},null,8,["items"]),o(i(h),{variant:"solid",onClick:a[0]||(a[0]=t=>B())},{default:_(()=>[f(d(e.__("Save")),1)]),_:1})]),s("div",ie,[s("div",ne,[s("div",re,d(e.__("Details")),1),s("div",de,[s("div",me,[o(i(r),{modelValue:l.title,"onUpdate:modelValue":a[1]||(a[1]=t=>l.title=t),label:e.__("Title"),required:!0,class:"w-full"},null,8,["modelValue","label"]),o(le,{modelValue:u.value,"onUpdate:modelValue":a[2]||(a[2]=t=>u.value=t),doctype:"User",label:e.__("Instructors"),required:!0,onCreate:t=>i(y)("Members",t),filters:{ignore_user_type:1}},null,8,["modelValue","label","onCreate"])]),o(i(r),{modelValue:l.description,"onUpdate:modelValue":a[3]||(a[3]=t=>l.description=t),label:e.__("Short Description"),type:"textarea",rows:8,placeholder:e.__("Short description of the batch"),required:!0},null,8,["modelValue","label","placeholder"])])]),s("div",ue,[s("div",ce,d(e.__("Settings")),1),s("div",pe,[o(i(r),{modelValue:l.published,"onUpdate:modelValue":a[4]||(a[4]=t=>l.published=t),type:"checkbox",label:e.__("Published")},null,8,["modelValue","label"]),o(i(r),{modelValue:l.allow_self_enrollment,"onUpdate:modelValue":a[5]||(a[5]=t=>l.allow_self_enrollment=t),type:"checkbox",label:e.__("Allow self enrollment")},null,8,["modelValue","label"]),o(i(r),{modelValue:l.certification,"onUpdate:modelValue":a[6]||(a[6]=t=>l.certification=t),type:"checkbox",label:e.__("Certification")},null,8,["modelValue","label"])])]),s("div",be,[s("div",_e,d(e.__("Date and Time")),1),s("div",fe,[s("div",ge,[o(i(r),{modelValue:l.start_date,"onUpdate:modelValue":a[7]||(a[7]=t=>l.start_date=t),label:e.__("Start Date"),type:"date",class:"mb-4",required:!0},null,8,["modelValue","label"]),o(i(r),{modelValue:l.end_date,"onUpdate:modelValue":a[8]||(a[8]=t=>l.end_date=t),label:e.__("End Date"),type:"date",class:"mb-4",required:!0},null,8,["modelValue","label"])]),s("div",he,[o(i(r),{modelValue:l.start_time,"onUpdate:modelValue":a[9]||(a[9]=t=>l.start_time=t),label:e.__("Start Time"),type:"time",class:"mb-4",required:!0},null,8,["modelValue","label"]),o(i(r),{modelValue:l.end_time,"onUpdate:modelValue":a[10]||(a[10]=t=>l.end_time=t),label:e.__("End Time"),type:"time",class:"mb-4",required:!0},null,8,["modelValue","label"])]),s("div",ye,[o(i(r),{modelValue:l.timezone,"onUpdate:modelValue":a[11]||(a[11]=t=>l.timezone=t),label:e.__("Timezone"),type:"text",placeholder:e.__("Example: IST (+5:30)"),class:"mb-4",required:!0},null,8,["modelValue","label","placeholder"]),o(i(r),{modelValue:l.evaluation_end_date,"onUpdate:modelValue":a[12]||(a[12]=t=>l.evaluation_end_date=t),label:e.__("Evaluation End Date"),type:"date",class:"mb-4"},null,8,["modelValue","label"])])])]),s("div",ve,[s("div",null,[s("label",Ve,[f(d(e.__("Batch Details"))+" ",1),a[23]||(a[23]=s("span",{class:"text-ink-red-3"},"*",-1))]),o(i(W),{content:l.batch_details,onChange:a[13]||(a[13]=t=>l.batch_details=t),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem] max-h-[20rem] overflow-y-scroll mb-4"},null,8,["content"])])]),s("div",we,[s("div",ke,d(e.__("Configurations")),1),s("div",Be,[s("div",Ue,[o(i(r),{modelValue:l.seat_count,"onUpdate:modelValue":a[14]||(a[14]=t=>l.seat_count=t),label:e.__("Seat Count"),type:"number",class:"mb-4",placeholder:e.__("Number of seats available")},null,8,["modelValue","label","placeholder"]),o(v,{doctype:"Email Template",label:e.__("Email Template"),modelValue:l.confirmation_email_template,"onUpdate:modelValue":a[15]||(a[15]=t=>l.confirmation_email_template=t),onCreate:(t,n)=>{i(y)("Email Templates",n)}},null,8,["label","modelValue","onCreate"])]),s("div",Se,[o(i(r),{modelValue:l.medium,"onUpdate:modelValue":a[16]||(a[16]=t=>l.medium=t),type:"select",options:[{label:"Online",value:"Online"},{label:"Offline",value:"Offline"}],label:e.__("Medium"),class:"mb-4"},null,8,["modelValue","label"]),o(v,{doctype:"LMS Category",label:e.__("Category"),modelValue:l.category,"onUpdate:modelValue":a[17]||(a[17]=t=>l.category=t),onCreate:(t,n)=>i(y)("Categories",n)},null,8,["label","modelValue","onCreate"])]),s("div",Ce,[s("div",null,[s("div",xe,d(e.__("Meta Image")),1),l.image?(b(),g("div",Le,[s("div",Me,[s("img",{src:l.image.file_url,class:"border rounded-md w-40"},null,8,qe),s("div",Oe,[o(i(h),{onClick:a[19]||(a[19]=t=>P())},{default:_(()=>[f(d(e.__("Remove")),1)]),_:1}),s("div",$e,d(e.__("Appears when the batch URL is shared on any online platform")),1)])])])):(b(),Y(i(ee),{key:0,fileTypes:["image/*"],validateFile:I,onSuccess:a[18]||(a[18]=t=>$(t))},{default:_(({file:t,progress:n,uploading:U,openFileSelector:S})=>[s("div",Ne,[s("div",Ee,[o(i(Z),{class:"size-5 stroke-1 text-ink-gray-7"})]),s("div",De,[o(i(h),{onClick:S},{default:_(()=>[f(d(e.__("Upload")),1)]),_:2},1032,["onClick"]),s("div",Te,d(e.__("Appears when the batch URL is shared on socials")),1)])])]),_:1}))])])])]),s("div",Pe,[s("div",Ie,d(e.__("Pricing")),1),o(i(r),{modelValue:l.paid_batch,"onUpdate:modelValue":a[20]||(a[20]=t=>l.paid_batch=t),type:"checkbox",label:e.__("Paid Batch")},null,8,["modelValue","label"]),l.paid_batch?(b(),g("div",je,[o(i(r),{modelValue:l.amount,"onUpdate:modelValue":a[21]||(a[21]=t=>l.amount=t),label:e.__("Amount"),type:"number"},null,8,["modelValue","label"]),o(v,{doctype:"Currency",modelValue:l.currency,"onUpdate:modelValue":a[22]||(a[22]=t=>l.currency=t),filters:{enabled:1},label:e.__("Currency")},null,8,["modelValue","label"])])):ae("",!0)])])]))}};export{Fe as default};
//# sourceMappingURL=BatchForm-jJGHwMNv.js.map
