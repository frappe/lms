{"version":3,"file":"SCORMChapter-BRBM9h30.js","sources":["../../../../frontend/src/pages/SCORMChapter.vue"],"sourcesContent":["<template>\n\t<header\n\t\tclass=\"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5\"\n\t>\n\t\t<Breadcrumbs class=\"h-7\" :items=\"breadcrumbs\" />\n\t</header>\n\t<div\n\t\tv-if=\"\n\t\t\treadyToRender &&\n\t\t\t(enrollment.data?.length ||\n\t\t\t\tuser.data?.is_moderator ||\n\t\t\t\tuser.data?.is_instructor)\n\t\t\"\n\t>\n\t\t<iframe :src=\"chapter.doc.launch_file\" class=\"w-full h-screen\" />\n\t</div>\n\t<div v-else-if=\"!enrollment.data?.length\">\n\t\t<div class=\"text-center pt-10 px-5 md:px-0 pb-10\">\n\t\t\t<div class=\"text-center\">\n\t\t\t\t<div class=\"mb-4\">\n\t\t\t\t\t{{\n\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t'You are not enrolled in this course. Please enroll to access this lesson.'\n\t\t\t\t\t\t)\n\t\t\t\t\t}}\n\t\t\t\t</div>\n\t\t\t\t<Button variant=\"solid\" @click=\"enrollStudent()\">\n\t\t\t\t\t{{ __('Start Learning') }}\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</template>\n<script setup>\nimport {\n\tBreadcrumbs,\n\tButton,\n\tcall,\n\tcreateDocumentResource,\n\tcreateListResource,\n\tcreateResource,\n\tusePageMeta,\n} from 'frappe-ui'\nimport { computed, inject, onBeforeMount, ref } from 'vue'\nimport { useSidebar } from '@/stores/sidebar'\nimport { sessionStore } from '../stores/session'\n\nconst { brand } = sessionStore()\nconst sidebarStore = useSidebar()\nconst user = inject('$user')\nconst readyToRender = ref(false)\n\nconst props = defineProps({\n\tcourseName: {\n\t\ttype: String,\n\t\trequired: true,\n\t},\n\tchapterName: {\n\t\ttype: String,\n\t\trequired: true,\n\t},\n})\n\nonBeforeMount(() => {\n\tsidebarStore.isSidebarCollapsed = true\n\tsetupSCORMAPI()\n})\n\nconst chapter = createDocumentResource({\n\tdoctype: 'Course Chapter',\n\tname: props.chapterName,\n\tauto: true,\n\tcache: ['chapter', props.chapterName],\n\tonSuccess(data) {\n\t\tprogress.submit()\n\t},\n})\n\nconst enrollment = createListResource({\n\tdoctype: 'LMS Enrollment',\n\tfields: ['member', 'course'],\n\tfilters: {\n\t\tcourse: props.courseName,\n\t\tmember: user.data?.name,\n\t},\n\tauto: true,\n\tcache: ['enrollments', props.courseName, user.data?.name],\n})\n\nconst getDataFromLMS = (key) => {\n\tif (key == 'cmi.core.lesson_status') {\n\t\tif (progress.data?.status == 'Complete') {\n\t\t\treturn 'passed'\n\t\t}\n\t\treturn 'incomplete'\n\t}\n\treturn ''\n}\n\nconst saveDataToLMS = (key, value) => {\n\tif (key == 'cmi.core.lesson_status' && value == 'passed') {\n\t\tsaveProgress()\n\t}\n}\n\nconst saveProgress = () => {\n\tcall('lms.lms.doctype.course_lesson.course_lesson.save_progress', {\n\t\tlesson: chapter.doc.lessons[0].lesson,\n\t\tcourse: props.courseName,\n\t})\n}\n\nconst progress = createResource({\n\turl: 'frappe.client.get_value',\n\tmakeParams(values) {\n\t\treturn {\n\t\t\tdoctype: 'LMS Course Progress',\n\t\t\tfieldname: 'status',\n\t\t\tfilters: {\n\t\t\t\tmember: user.data?.name,\n\t\t\t\tlesson: chapter.doc.lessons[0].lesson,\n\t\t\t\tchapter: chapter.doc.name,\n\t\t\t\tcourse: chapter.doc?.course,\n\t\t\t},\n\t\t}\n\t},\n\tonSuccess(data) {\n\t\treadyToRender.value = true\n\t},\n})\n\nconst enrollStudent = () => {\n\tenrollment.insert.submit(\n\t\t{\n\t\t\tcourse: props.courseName,\n\t\t\tmember: user.data?.name,\n\t\t},\n\t\t{\n\t\t\tonSuccess(data) {\n\t\t\t\twindow.location.reload()\n\t\t\t},\n\t\t}\n\t)\n}\n\nconst setupSCORMAPI = () => {\n\twindow.API_1484_11 = {\n\t\tInitialize: () => 'true',\n\t\tTerminate: () => 'true',\n\t\tGetValue: (key) => {\n\t\t\tconsole.log(`GET: ${key}`)\n\t\t\treturn getDataFromLMS(key)\n\t\t},\n\t\tSetValue: (key, value) => {\n\t\t\tconsole.log(`SET: ${key} to value: ${value}`)\n\n\t\t\tsaveDataToLMS(key, value)\n\t\t\treturn 'true'\n\t\t},\n\t\tCommit: () => 'true',\n\t\tGetLastError: () => '0',\n\t\tGetErrorString: () => '',\n\t\tGetDiagnostic: () => '',\n\t}\n\twindow.API = {\n\t\tLMSInitialize: () => 'true',\n\t\tLMSFinish: () => 'true',\n\t\tLMSGetValue: (key) => {\n\t\t\tconsole.log(`GET: ${key}`)\n\t\t\treturn getDataFromLMS(key)\n\t\t},\n\t\tLMSSetValue: (key, value) => {\n\t\t\tconsole.log(`SET: ${key} to value: ${value}`)\n\t\t\tsaveDataToLMS(key, value)\n\t\t\treturn 'true'\n\t\t},\n\t\tLMSCommit: () => 'true',\n\t\tLMSGetLastError: () => '0',\n\t\tLMSGetErrorString: () => '',\n\t\tLMSGetDiagnostic: () => '',\n\t}\n}\n\nconst breadcrumbs = computed(() => {\n\treturn [\n\t\t{\n\t\t\tlabel: 'Courses',\n\t\t\troute: { name: 'Courses' },\n\t\t},\n\t\t{\n\t\t\tlabel: chapter.doc?.course_title,\n\t\t\troute: { name: 'CourseDetail', params: { courseName: props.courseName } },\n\t\t},\n\t\t{\n\t\t\tlabel: chapter.doc?.title,\n\t\t},\n\t]\n})\n\nusePageMeta(() => {\n\treturn {\n\t\ttitle: chapter.doc?.title,\n\t\ticon: brand.favicon,\n\t}\n})\n</script>\n"],"names":["brand","sessionStore","sidebarStore","useSidebar","user","inject","readyToRender","ref","props","__props","onBeforeMount","setupSCORMAPI","chapter","createDocumentResource","data","progress","enrollment","createListResource","_a","_b","getDataFromLMS","key","saveDataToLMS","value","saveProgress","call","createResource","values","enrollStudent","breadcrumbs","computed","usePageMeta"],"mappings":"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"}