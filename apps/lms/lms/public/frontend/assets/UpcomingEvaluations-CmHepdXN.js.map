{"version":3,"file":"UpcomingEvaluations-CmHepdXN.js","sources":["../../../../frontend/src/components/Modals/EvaluationModal.vue","../../../../frontend/src/components/UpcomingEvaluations.vue"],"sourcesContent":["<template>\n\t<Dialog\n\t\tv-model=\"show\"\n\t\t:options=\"{\n\t\t\ttitle: __('Schedule Evaluation'),\n\t\t\tsize: 'xl',\n\t\t\tactions: [\n\t\t\t\t{\n\t\t\t\t\tlabel: __('Submit'),\n\t\t\t\t\tvariant: 'solid',\n\t\t\t\t\tonClick: (close) => submitEvaluation(close),\n\t\t\t\t},\n\t\t\t],\n\t\t}\"\n\t>\n\t\t<template #body-content>\n\t\t\t<div class=\"flex flex-col gap-4\">\n\t\t\t\t<div>\n\t\t\t\t\t<div class=\"mb-1.5 text-sm text-ink-gray-5\">\n\t\t\t\t\t\t{{ __('Course') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<Select v-model=\"evaluation.course\" :options=\"getCourses()\" />\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<div class=\"mb-1.5 text-sm text-ink-gray-5\">\n\t\t\t\t\t\t{{ __('Date') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<FormControl\n\t\t\t\t\t\ttype=\"date\"\n\t\t\t\t\t\tv-model=\"evaluation.date\"\n\t\t\t\t\t\t:min=\"\n\t\t\t\t\t\t\tdayjs()\n\t\t\t\t\t\t\t\t.add(dayjs.duration({ days: 1 }))\n\t\t\t\t\t\t\t\t.format('YYYY-MM-DD')\n\t\t\t\t\t\t\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"slots.data?.length\">\n\t\t\t\t\t<div class=\"mb-1.5 text-sm text-ink-gray-5\">\n\t\t\t\t\t\t{{ __('Select a slot') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"grid grid-cols-2 gap-2\">\n\t\t\t\t\t\t<div v-for=\"slot in slots.data\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"text-base text-center border rounded-md text-ink-gray-8 bg-surface-gray-3 p-2 cursor-pointer\"\n\t\t\t\t\t\t\t\t@click=\"saveSlot(slot)\"\n\t\t\t\t\t\t\t\t:class=\"{\n\t\t\t\t\t\t\t\t\t'border-outline-gray-4':\n\t\t\t\t\t\t\t\t\t\tevaluation.start_time == slot.start_time,\n\t\t\t\t\t\t\t\t}\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ formatTime(slot.start_time) }} -\n\t\t\t\t\t\t\t\t{{ formatTime(slot.end_time) }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tv-else-if=\"evaluation.course && evaluation.date\"\n\t\t\t\t\tclass=\"text-sm italic text-ink-red-4\"\n\t\t\t\t>\n\t\t\t\t\t{{ __('No slots available for this date.') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</template>\n\t</Dialog>\n</template>\n<script setup>\nimport { Dialog, createResource, Select, FormControl, toast } from 'frappe-ui'\nimport { reactive, watch, inject } from 'vue'\nimport { formatTime } from '@/utils/'\n\nconst user = inject('$user')\nconst dayjs = inject('$dayjs')\nconst show = defineModel()\nconst evaluations = defineModel('reloadEvals')\n\nconst props = defineProps({\n\tcourses: {\n\t\ttype: Array,\n\t\tdefault: [],\n\t},\n\tbatch: {\n\t\ttype: String,\n\t\tdefault: null,\n\t},\n\tendDate: {\n\t\ttype: String,\n\t\tdefault: null,\n\t},\n})\n\nconst evaluation = reactive({\n\tcourse: '',\n\tdate: '',\n\tstart_time: '',\n\tend_time: '',\n\tday: '',\n\tbatch: props.batch,\n\tmember: user.data.name,\n})\n\nconst createEvaluation = createResource({\n\turl: 'frappe.client.insert',\n\tmakeParams(values) {\n\t\treturn {\n\t\t\tdoc: {\n\t\t\t\tdoctype: 'LMS Certificate Request',\n\t\t\t\tbatch_name: values.batch,\n\t\t\t\t...values,\n\t\t\t},\n\t\t}\n\t},\n})\n\nfunction submitEvaluation(close) {\n\tcreateEvaluation.submit(evaluation, {\n\t\tvalidate() {\n\t\t\tif (!evaluation.course) {\n\t\t\t\treturn 'Please select a course.'\n\t\t\t}\n\t\t\tif (!evaluation.date) {\n\t\t\t\treturn 'Please select a date.'\n\t\t\t}\n\t\t\tif (!evaluation.start_time) {\n\t\t\t\treturn 'Please select a slot.'\n\t\t\t}\n\t\t\tif (dayjs(evaluation.date).isBefore(dayjs(), 'day')) {\n\t\t\t\treturn 'Please select a future date.'\n\t\t\t}\n\t\t\tif (dayjs(evaluation.date).isAfter(dayjs(props.endDate), 'day')) {\n\t\t\t\treturn `Please select a date before the end date ${dayjs(\n\t\t\t\t\tprops.endDate\n\t\t\t\t).format('DD MMMM YYYY')}.`\n\t\t\t}\n\t\t},\n\t\tonSuccess() {\n\t\t\tevaluations.value.reload()\n\t\t\tclose()\n\t\t},\n\t\tonError(err) {\n\t\t\tconst message = err.messages?.[0] || err\n\t\t\tlet unavailabilityMessage\n\n\t\t\tif (typeof message === 'string') {\n\t\t\t\tunavailabilityMessage = message?.includes('unavailable')\n\t\t\t} else {\n\t\t\t\tunavailabilityMessage = false\n\t\t\t}\n\n\t\t\ttoast.warning(__(unavailabilityMessage || 'Evaluator is unavailable'))\n\t\t},\n\t})\n}\n\nconst getCourses = () => {\n\tconst courses = []\n\tfor (const course of props.courses) {\n\t\tif (course.evaluator) {\n\t\t\tcourses.push({\n\t\t\t\tlabel: course.title,\n\t\t\t\tvalue: course.course,\n\t\t\t})\n\t\t}\n\t}\n\n\tif (courses.length === 1) {\n\t\tevaluation.course = courses[0].value\n\t}\n\n\treturn courses\n}\n\nconst slots = createResource({\n\turl: 'lms.lms.doctype.course_evaluator.course_evaluator.get_schedule',\n\tmakeParams(values) {\n\t\treturn {\n\t\t\tcourse: values.course,\n\t\t\tdate: values.date,\n\t\t\tbatch: props.batch,\n\t\t}\n\t},\n})\n\nwatch(\n\t() => evaluation.date,\n\t(date) => {\n\t\tevaluation.start_time = ''\n\t\tif (date && evaluation.course) {\n\t\t\tslots.submit(evaluation)\n\t\t}\n\t}\n)\n\nwatch(\n\t() => evaluation.course,\n\t(course) => {\n\t\tevaluation.date = ''\n\t\tevaluation.start_time = ''\n\t\tslots.reset()\n\t}\n)\n\nconst saveSlot = (slot) => {\n\tevaluation.start_time = slot.start_time\n\tevaluation.end_time = slot.end_time\n\tevaluation.day = slot.day\n}\n</script>\n","<template>\n\t<div>\n\t\t<div class=\"flex items-center justify-between mb-4\">\n\t\t\t<div class=\"text-lg text-ink-gray-9 font-semibold\">\n\t\t\t\t{{ __('Upcoming Evaluations') }}\n\t\t\t</div>\n\t\t\t<Button\n\t\t\t\tv-if=\"\n\t\t\t\t\t!upcoming_evals.data?.length ||\n\t\t\t\t\tupcoming_evals.length == courses.length\n\t\t\t\t\"\n\t\t\t\t@click=\"openEvalModal\"\n\t\t\t>\n\t\t\t\t{{ __('Schedule Evaluation') }}\n\t\t\t</Button>\n\t\t</div>\n\t\t<div v-if=\"upcoming_evals.data?.length\">\n\t\t\t<div class=\"grid grid-cols-3 gap-4\">\n\t\t\t\t<div v-for=\"evl in upcoming_evals.data\">\n\t\t\t\t\t<div class=\"border text-ink-gray-7 rounded-md p-3\">\n\t\t\t\t\t\t<div class=\"flex justify-between mb-3\">\n\t\t\t\t\t\t\t<span class=\"font-semibold text-ink-gray-9 leading-5\">\n\t\t\t\t\t\t\t\t{{ evl.course_title }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<Menu\n\t\t\t\t\t\t\t\tv-if=\"evl.date > dayjs().format()\"\n\t\t\t\t\t\t\t\tas=\"div\"\n\t\t\t\t\t\t\t\tclass=\"relative inline-block text-left\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<MenuButton class=\"inline-flex w-full justify-center\">\n\t\t\t\t\t\t\t\t\t\t<EllipsisVertical class=\"w-4 h-4 stroke-1.5\" />\n\t\t\t\t\t\t\t\t\t</MenuButton>\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<transition\n\t\t\t\t\t\t\t\t\tenter-active-class=\"transition duration-100 ease-out\"\n\t\t\t\t\t\t\t\t\tenter-from-class=\"transform scale-95 opacity-0\"\n\t\t\t\t\t\t\t\t\tenter-to-class=\"transform scale-100 opacity-100\"\n\t\t\t\t\t\t\t\t\tleave-active-class=\"transition duration-75 ease-in\"\n\t\t\t\t\t\t\t\t\tleave-from-class=\"transform scale-100 opacity-100\"\n\t\t\t\t\t\t\t\t\tleave-to-class=\"transform scale-95 opacity-0\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<MenuItems\n\t\t\t\t\t\t\t\t\t\tclass=\"absolute mt-2 w-32 rounded-md bg-surface-white border p-1.5\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<MenuItem v-slot=\"{ active }\">\n\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\tclass=\"w-full\"\n\t\t\t\t\t\t\t\t\t\t\t\t@click=\"cancelEvaluation(evl)\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<template #prefix>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Ban\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t:active=\"active\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclass=\"size-4 stroke-1.5\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\taria-hidden=\"true\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t\t\t\t{{ __('Cancel') }}\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t\t\t\t</MenuItems>\n\t\t\t\t\t\t\t\t</transition>\n\t\t\t\t\t\t\t</Menu>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"flex items-center mb-2\">\n\t\t\t\t\t\t\t<Calendar class=\"w-4 h-4 stroke-1.5\" />\n\t\t\t\t\t\t\t<span class=\"ml-2\">\n\t\t\t\t\t\t\t\t{{ dayjs(evl.date).format('DD MMMM YYYY') }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"flex items-center mb-2\">\n\t\t\t\t\t\t\t<Clock class=\"w-4 h-4 stroke-1.5\" />\n\t\t\t\t\t\t\t<span class=\"ml-2\">\n\t\t\t\t\t\t\t\t{{ formatTime(evl.start_time) }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t\t\t<GraduationCap class=\"w-4 h-4 stroke-1.5\" />\n\t\t\t\t\t\t\t<span class=\"ml-2\">\n\t\t\t\t\t\t\t\t{{ evl.evaluator_name }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if=\"evl.google_meet_link\"\n\t\t\t\t\t\t\tclass=\"flex items-center justify-between space-x-2 mt-4\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Button @click=\"openEvalCall(evl)\" class=\"w-full\">\n\t\t\t\t\t\t\t\t<template #prefix>\n\t\t\t\t\t\t\t\t\t<HeadsetIcon class=\"w-4 h-4 stroke-1.5\" />\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t{{ __('Join Call') }}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div v-else class=\"text-sm italic text-ink-gray-5\">\n\t\t\t{{ __('Please schedule an evaluation to get certified.') }}\n\t\t</div>\n\t</div>\n\t<EvaluationModal\n\t\t:batch=\"batch\"\n\t\t:endDate=\"endDate\"\n\t\t:courses=\"courses\"\n\t\tv-model=\"showEvalModal\"\n\t\tv-model:reloadEvals=\"upcoming_evals\"\n\t/>\n</template>\n<script setup>\nimport {\n\tBan,\n\tCalendar,\n\tClock,\n\tGraduationCap,\n\tHeadsetIcon,\n\tEllipsisVertical,\n} from 'lucide-vue-next'\nimport { inject, ref, getCurrentInstance } from 'vue'\nimport { formatTime } from '../utils'\nimport { Button, createResource, call } from 'frappe-ui'\nimport EvaluationModal from '@/components/Modals/EvaluationModal.vue'\nimport { Menu, MenuButton, MenuItems, MenuItem } from '@headlessui/vue'\n\nconst dayjs = inject('$dayjs')\nconst user = inject('$user')\nconst showEvalModal = ref(false)\nconst app = getCurrentInstance()\nconst { $dialog } = app.appContext.config.globalProperties\n\nconst props = defineProps({\n\tbatch: {\n\t\ttype: String,\n\t\tdefault: null,\n\t},\n\tcourses: {\n\t\ttype: Array,\n\t\tdefault: [],\n\t},\n\tendDate: {\n\t\ttype: String,\n\t\tdefault: null,\n\t},\n})\n\nconst upcoming_evals = createResource({\n\turl: 'lms.lms.utils.get_upcoming_evals',\n\tparams: {\n\t\tstudent: user.data.name,\n\t\tcourses: props.courses.map((course) => course.course),\n\t\tbatch: props.batch,\n\t},\n\tauto: true,\n})\n\nfunction openEvalModal() {\n\tshowEvalModal.value = true\n}\n\nconst openEvalCall = (evl) => {\n\twindow.open(evl.google_meet_link, '_blank')\n}\n\nconst cancelEvaluation = (evl) => {\n\t$dialog({\n\t\ttitle: __('Cancel this evaluation?'),\n\t\tmessage: __(\n\t\t\t'Are you sure you want to cancel this evaluation? This action cannot be undone.'\n\t\t),\n\t\tactions: [\n\t\t\t{\n\t\t\t\tlabel: __('Cancel'),\n\t\t\t\ttheme: 'red',\n\t\t\t\tvariant: 'solid',\n\t\t\t\tonClick(close) {\n\t\t\t\t\tcall('lms.lms.api.cancel_evaluation', { evaluation: evl }).then(\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tupcoming_evals.reload()\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\t\t\t\t\tclose()\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t})\n}\n</script>\n"],"names":["user","inject","dayjs","show","_useModel","__props","evaluations","props","evaluation","reactive","createEvaluation","createResource","values","submitEvaluation","close","err","message","_a","unavailabilityMessage","toast","getCourses","courses","course","slots","watch","date","saveSlot","slot","showEvalModal","ref","app","getCurrentInstance","$dialog","upcoming_evals","openEvalModal","openEvalCall","evl","cancelEvaluation","call"],"mappings":"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"}