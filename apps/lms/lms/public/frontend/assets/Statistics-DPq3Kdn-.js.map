{"version":3,"file":"Statistics-DPq3Kdn-.js","sources":["../../../../node_modules/frappe-ui/src/components/Charts/donutChartOptions.ts","../../../../node_modules/frappe-ui/src/components/Charts/DonutChart.vue","../../../../frontend/src/pages/Statistics.vue"],"sourcesContent":["import { getTitleOptions } from './eChartOptions'\nimport { formatValue } from './helpers'\nimport { DonutChartConfig } from './types'\n\nexport default function useDonutChartOptions(config: DonutChartConfig) {\n  let data = config.data || []\n\n  data = data.sort((a, b) => {\n    const aValue = a[config.valueColumn]\n    const bValue = b[config.valueColumn]\n    if (aValue === bValue) {\n      return 0\n    }\n    return aValue > bValue ? -1 : 1\n  })\n\n  const labels = data.map((row) => row[config.categoryColumn])\n  const values = data.map((row) => row[config.valueColumn])\n  const total = values.reduce((acc, value) => {\n    return isNaN(value) ? acc : acc + value\n  }, 0)\n\n  let radius = ['40%', '70%']\n  let center = ['50%', '48%']\n\n  if (config.subtitle) {\n    radius = ['40%', '70%']\n    center = ['50%', '50%']\n  }\n\n  if (config.showInlineLabels) {\n    center = ['50%', '50%']\n  }\n\n  // legend position\n  let orient = 'horizontal'\n  let bottom = 0\n  let left = 'center'\n  // let padding = [30, 30, 10, 30]\n  let padding = [0, 10, 10, 10]\n\n  return {\n    animation: true,\n    animationDuration: 700,\n    color: config.colors,\n    textStyle: { fontFamily: ['InterVar', 'sans-serif'] },\n    title: getTitleOptions(config.title, config.subtitle),\n    dataset: {\n      source: [\n        [config.categoryColumn, config.valueColumn],\n        ...data.map((r) => [r[config.categoryColumn], r[config.valueColumn]]),\n      ],\n    },\n    series: [\n      {\n        type: 'pie',\n        name: config.categoryColumn,\n        center,\n        radius,\n        labelLine: {\n          show: config.showInlineLabels,\n          lineStyle: {\n            width: 2,\n          },\n          length: 10,\n          length2: 20,\n          smooth: true,\n        },\n        label: {\n          show: config.showInlineLabels,\n          formatter: ({ value, name }: any) => {\n            const percentage = total > 0 ? (value[1] / total) * 100 : 0\n            return `${name} (${percentage.toFixed(0)}%)`\n          },\n        },\n        emphasis: { scaleSize: 5 },\n      },\n    ],\n    legend: !config.showInlineLabels\n      ? {\n          // top,\n          left: left,\n          bottom: bottom,\n          padding: padding,\n          orient: orient,\n          show: true,\n          type: 'scroll',\n          itemGap: 12,\n          formatter: function (name: string) {\n            const labelIndex = labels.indexOf(name)\n            const percentage =\n              total > 0 ? (values[labelIndex] / total) * 100 : 0\n            return `${name} (${percentage.toFixed(0)}%)`\n          },\n          textStyle: {\n            padding: [0, 0, 0, -5],\n            color: '#000',\n          },\n          icon: 'circle',\n          pageIcons: {\n            horizontal: [\n              'M 17 3 h 2 c 0.386 0 0.738 0.223 0.904 0.572 s 0.115 0.762 -0.13 1.062 L 11.292 15 l 8.482 10.367 c 0.245 0.299 0.295 0.712 0.13 1.062 S 19.386 27 19 27 h -2 c -0.3 0 -0.584 -0.135 -0.774 -0.367 l -9 -11 c -0.301 -0.369 -0.301 -0.898 0 -1.267 l 9 -11 C 16.416 3.135 16.7 3 17 3 Z',\n              'M 12 27 h -2 c -0.386 0 -0.738 -0.223 -0.904 -0.572 s -0.115 -0.762 0.13 -1.062 L 17.708 15 L 9.226 4.633 c -0.245 -0.299 -0.295 -0.712 -0.13 -1.062 S 9.614 3 10 3 h 2 c 0.3 0 0.584 0.135 0.774 0.367 l 9 11 c 0.301 0.369 0.301 0.898 0 1.267 l -9 11 C 12.584 26.865 12.3 27 12 27 Z',\n            ],\n          },\n          pageIconColor: '#64748B',\n          pageInactiveColor: '#C0CCDA',\n          pageIconSize: 10,\n          pageTextStyle: {\n            color: '#64748B',\n          },\n          animationDurationUpdate: 300,\n        }\n      : null,\n    tooltip: {\n      trigger: 'item',\n      confine: true,\n      appendToBody: false,\n      formatter: function (params: any) {\n        const p = params as any\n        const value = p.value[1]\n        const percentage = total > 0 ? (value / total) * 100 : 0\n        const formatted = isNaN(value) ? value : formatValue(value, 1, true)\n        const formattedPercentage = percentage.toFixed(0)\n        return `\n          <div class=\"flex items-center justify-between gap-5\">\n            <div>${p.name}</div>\n            <div class=\"font-bold\">\n              ${formatted} (${formattedPercentage}%)\n            </div>\n          </div>\n        `\n      },\n    },\n  }\n}\n","<template>\n  <ECharts :options=\"options\" :error=\"error\" />\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, ref } from 'vue'\nimport useDonutChartOptions from './donutChartOptions'\nimport ECharts from './ECharts.vue'\nimport { DonutChartConfig } from './types'\n\nconst props = defineProps<{ config: DonutChartConfig }>()\n\nconst error = ref('')\nconst options = computed(() => {\n  try {\n    return useDonutChartOptions(props.config)\n  } catch (e: any) {\n    error.value = e.message\n    return {}\n  }\n})\n</script>\n","<template>\n\t<div class=\"\">\n\t\t<header\n\t\t\tclass=\"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5\"\n\t\t>\n\t\t\t<Breadcrumbs class=\"h-7\" :items=\"breadcrumbs\" />\n\t\t</header>\n\t\t<div v-if=\"chartDetails.data\" class=\"p-5\">\n\t\t\t<div class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4\">\n\t\t\t\t<Tooltip :text=\"__('Published Courses')\">\n\t\t\t\t\t<NumberChart\n\t\t\t\t\t\tclass=\"border rounded-md\"\n\t\t\t\t\t\t:config=\"{ title: 'Courses', value: chartDetails.data.courses }\"\n\t\t\t\t\t/>\n\t\t\t\t</Tooltip>\n\t\t\t\t<Tooltip :text=\"__('Active Members')\">\n\t\t\t\t\t<NumberChart\n\t\t\t\t\t\tclass=\"border rounded-md\"\n\t\t\t\t\t\t:config=\"{ title: 'Signups', value: chartDetails.data.users }\"\n\t\t\t\t\t/>\n\t\t\t\t</Tooltip>\n\t\t\t\t<Tooltip :text=\"__('Course Enrollments')\">\n\t\t\t\t\t<NumberChart\n\t\t\t\t\t\tclass=\"border rounded-md\"\n\t\t\t\t\t\t:config=\"{\n\t\t\t\t\t\t\ttitle: 'Enrollments',\n\t\t\t\t\t\t\tvalue: chartDetails.data.enrollments,\n\t\t\t\t\t\t}\"\n\t\t\t\t\t/>\n\t\t\t\t</Tooltip>\n\t\t\t\t<Tooltip :text=\"__('Course Completions')\">\n\t\t\t\t\t<NumberChart\n\t\t\t\t\t\tclass=\"border rounded-md\"\n\t\t\t\t\t\t:config=\"{\n\t\t\t\t\t\t\ttitle: 'Completions',\n\t\t\t\t\t\t\tvalue: chartDetails.data.completions,\n\t\t\t\t\t\t}\"\n\t\t\t\t\t/>\n\t\t\t\t</Tooltip>\n\t\t\t\t<Tooltip :text=\"__('Certified Members')\">\n\t\t\t\t\t<NumberChart\n\t\t\t\t\t\tclass=\"border rounded-md\"\n\t\t\t\t\t\t:config=\"{\n\t\t\t\t\t\t\ttitle: 'Certifications',\n\t\t\t\t\t\t\tvalue: chartDetails.data.certifications,\n\t\t\t\t\t\t}\"\n\t\t\t\t\t/>\n\t\t\t\t</Tooltip>\n\t\t\t</div>\n\t\t\t<div class=\"grid grid-cols-1 lg:grid-cols-2 gap-4 mt-4\">\n\t\t\t\t<div class=\"border rounded-md min-h-72\">\n\t\t\t\t\t<AxisChart\n\t\t\t\t\t\tv-if=\"signupsChart.data\"\n\t\t\t\t\t\t:config=\"{\n\t\t\t\t\t\t\tdata: signupsChart.data,\n\t\t\t\t\t\t\ttitle: 'Signups',\n\t\t\t\t\t\t\tsubtitle: 'Signups per month',\n\t\t\t\t\t\t\txAxis: {\n\t\t\t\t\t\t\t\tkey: 'date',\n\t\t\t\t\t\t\t\ttype: 'time',\n\t\t\t\t\t\t\t\ttitle: 'Date',\n\t\t\t\t\t\t\t\ttimeGrain: 'day',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tyAxis: {\n\t\t\t\t\t\t\t\ttitle: 'Signups',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tseries: [{ name: 'signups', type: 'line', showDataPoints: true }],\n\t\t\t\t\t\t}\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"border rounded-md min-h-72\">\n\t\t\t\t\t<AxisChart\n\t\t\t\t\t\tv-if=\"enrollmentChart.data\"\n\t\t\t\t\t\t:config=\"{\n\t\t\t\t\t\t\tdata: enrollmentChart.data,\n\t\t\t\t\t\t\ttitle: 'Enrollments',\n\t\t\t\t\t\t\tsubtitle: 'Enrollments per month',\n\t\t\t\t\t\t\txAxis: {\n\t\t\t\t\t\t\t\tkey: 'date',\n\t\t\t\t\t\t\t\ttype: 'time',\n\t\t\t\t\t\t\t\ttitle: 'Date',\n\t\t\t\t\t\t\t\ttimeGrain: 'day',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tyAxis: {\n\t\t\t\t\t\t\t\ttitle: 'Enrollments',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tseries: [\n\t\t\t\t\t\t\t\t{ name: 'enrollments', type: 'line', showDataPoints: true },\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"border rounded-md\">\n\t\t\t\t\t<AxisChart\n\t\t\t\t\t\tv-if=\"certification.data\"\n\t\t\t\t\t\t:config=\"{\n\t\t\t\t\t\t\tdata: certification.data,\n\t\t\t\t\t\t\ttitle: 'Certifications',\n\t\t\t\t\t\t\tsubtitle: 'Certifications per month',\n\t\t\t\t\t\t\txAxis: {\n\t\t\t\t\t\t\t\tkey: 'date',\n\t\t\t\t\t\t\t\ttype: 'time',\n\t\t\t\t\t\t\t\ttitle: 'Date',\n\t\t\t\t\t\t\t\ttimeGrain: 'day',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tyAxis: {\n\t\t\t\t\t\t\t\ttitle: 'Certifications',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tseries: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tname: 'certifications',\n\t\t\t\t\t\t\t\t\ttype: 'line',\n\t\t\t\t\t\t\t\t\tshowDataPoints: true,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"border rounded-md\">\n\t\t\t\t\t<DonutChart\n\t\t\t\t\t\tv-if=\"courseCompletion.data\"\n\t\t\t\t\t\t:config=\"{\n\t\t\t\t\t\t\tdata: courseCompletion.data,\n\t\t\t\t\t\t\ttitle: 'Completions',\n\t\t\t\t\t\t\tsubtitle: 'Course Completion',\n\t\t\t\t\t\t\tcategoryColumn: 'label',\n\t\t\t\t\t\t\tvalueColumn: 'value',\n\t\t\t\t\t\t}\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</template>\n<script setup>\nimport {\n\tAxisChart,\n\tBreadcrumbs,\n\tcreateResource,\n\tDonutChart,\n\tNumberChart,\n\tTooltip,\n\tusePageMeta,\n} from 'frappe-ui'\nimport { computed } from 'vue'\nimport { sessionStore } from '../stores/session'\n\nconst { brand } = sessionStore()\n\nconst breadcrumbs = computed(() => {\n\treturn [\n\t\t{\n\t\t\tlabel: 'Statistics',\n\t\t\troute: {\n\t\t\t\tname: 'Statistics',\n\t\t\t},\n\t\t},\n\t]\n})\n\nconst chartDetails = createResource({\n\turl: 'lms.lms.api.get_chart_details',\n\tcache: ['statistics'],\n\tauto: true,\n})\n\nconst signupsChart = createResource({\n\turl: 'lms.lms.utils.get_chart_data',\n\tparams: {\n\t\tchart_name: 'New Signups',\n\t},\n\tauto: true,\n\ttransform(data) {\n\t\treturn data.map((item) => {\n\t\t\treturn {\n\t\t\t\tdate: new Date(item.date),\n\t\t\t\tsignups: item.count,\n\t\t\t}\n\t\t})\n\t},\n})\n\nconst enrollmentChart = createResource({\n\turl: 'lms.lms.utils.get_chart_data',\n\tcache: ['enrollments'],\n\tparams: {\n\t\tchart_name: 'Course Enrollments',\n\t},\n\tauto: true,\n\ttransform(data) {\n\t\treturn data.map((item) => {\n\t\t\treturn {\n\t\t\t\tdate: new Date(item.date),\n\t\t\t\tenrollments: item.count,\n\t\t\t}\n\t\t})\n\t},\n})\n\nconst certification = createResource({\n\turl: 'lms.lms.utils.get_chart_data',\n\tcache: ['certifications'],\n\tparams: {\n\t\tchart_name: 'Certification',\n\t},\n\tauto: true,\n\ttransform(data) {\n\t\treturn data.map((item) => {\n\t\t\treturn {\n\t\t\t\tdate: new Date(item.date),\n\t\t\t\tcertifications: item.count,\n\t\t\t}\n\t\t})\n\t},\n})\n\nconst courseCompletion = createResource({\n\turl: 'lms.lms.utils.get_course_completion_data',\n\tauto: true,\n\tcache: ['courseCompletion'],\n})\n\nusePageMeta(() => {\n\treturn {\n\t\ttitle: __('Statistics'),\n\t\ticon: brand.favicon,\n\t}\n})\n</script>\n"],"names":["useDonutChartOptions","config","data","b","aValue","bValue","labels","row","values","total","acc","value","radius","center","orient","bottom","left","padding","getTitleOptions","r","name","percentage","labelIndex","params","p","formatted","formatValue","formattedPercentage","props","__props","error","ref","options","computed","e","brand","sessionStore","breadcrumbs","chartDetails","createResource","signupsChart","item","enrollmentChart","certification","courseCompletion","usePageMeta"],"mappings":"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","x_google_ignoreList":[0,1]}