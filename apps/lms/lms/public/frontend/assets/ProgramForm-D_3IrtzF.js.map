{"version":3,"file":"ProgramForm-D_3IrtzF.js","sources":["../../../../frontend/src/pages/ProgramForm.vue"],"sourcesContent":["<template>\n\t<header\n\t\tclass=\"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5\"\n\t>\n\t\t<Breadcrumbs :items=\"breadbrumbs\" />\n\t\t<Button variant=\"solid\" @click=\"saveProgram()\">\n\t\t\t{{ __('Save') }}\n\t\t</Button>\n\t</header>\n\t<div v-if=\"program.doc\" class=\"pt-5 px-5 w-3/4 mx-auto space-y-10\">\n\t\t<FormControl v-model=\"program.doc.title\" :label=\"__('Title')\" />\n\n\t\t<!-- Courses -->\n\t\t<div>\n\t\t\t<div class=\"flex items-center justify-between mb-2\">\n\t\t\t\t<div class=\"text-lg text-ink-gray-9 font-semibold\">\n\t\t\t\t\t{{ __('Program Courses') }}\n\t\t\t\t</div>\n\t\t\t\t<Button\n\t\t\t\t\t@click=\"\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tcurrentForm = 'course'\n\t\t\t\t\t\t\tshowDialog = true\n\t\t\t\t\t\t}\n\t\t\t\t\t\"\n\t\t\t\t>\n\t\t\t\t\t<template #prefix>\n\t\t\t\t\t\t<Plus class=\"w-4 h-4\" />\n\t\t\t\t\t</template>\n\t\t\t\t\t{{ __('Add') }}\n\t\t\t\t</Button>\n\t\t\t</div>\n\n\t\t\t<ListView\n\t\t\t\t:columns=\"courseColumns\"\n\t\t\t\t:rows=\"program.doc.program_courses\"\n\t\t\t\trow-key=\"name\"\n\t\t\t\t:options=\"{\n\t\t\t\t\tshowTooltip: false,\n\t\t\t\t}\"\n\t\t\t>\n\t\t\t\t<ListHeader\n\t\t\t\t\tclass=\"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2\"\n\t\t\t\t>\n\t\t\t\t\t<ListHeaderItem :item=\"item\" v-for=\"item in courseColumns\" />\n\t\t\t\t</ListHeader>\n\t\t\t\t<ListRows>\n\t\t\t\t\t<Draggable\n\t\t\t\t\t\t:list=\"program.doc.program_courses\"\n\t\t\t\t\t\titem-key=\"name\"\n\t\t\t\t\t\tgroup=\"items\"\n\t\t\t\t\t\t@end=\"updateOrder\"\n\t\t\t\t\t\tclass=\"cursor-move\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template #item=\"{ element: row }\">\n\t\t\t\t\t\t\t<ListRow :row=\"row\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</Draggable>\n\t\t\t\t</ListRows>\n\t\t\t\t<ListSelectBanner>\n\t\t\t\t\t<template #actions=\"{ unselectAll, selections }\">\n\t\t\t\t\t\t<div class=\"flex gap-2\">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t@click=\"remove(selections, unselectAll, 'program_courses')\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Trash2 class=\"h-4 w-4 stroke-1.5\" />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</ListSelectBanner>\n\t\t\t</ListView>\n\t\t</div>\n\n\t\t<!-- Members -->\n\t\t<div>\n\t\t\t<div class=\"flex items-center justify-between mb-2\">\n\t\t\t\t<div class=\"text-lg text-ink-gray-9 font-semibold\">\n\t\t\t\t\t{{ __('Program Members') }}\n\t\t\t\t</div>\n\t\t\t\t<Button\n\t\t\t\t\t@click=\"\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tcurrentForm = 'member'\n\t\t\t\t\t\t\tshowDialog = true\n\t\t\t\t\t\t}\n\t\t\t\t\t\"\n\t\t\t\t>\n\t\t\t\t\t<template #prefix>\n\t\t\t\t\t\t<Plus class=\"w-4 h-4\" />\n\t\t\t\t\t</template>\n\t\t\t\t\t{{ __('Add') }}\n\t\t\t\t</Button>\n\t\t\t</div>\n\n\t\t\t<ListView\n\t\t\t\t:columns=\"memberColumns\"\n\t\t\t\t:rows=\"program.doc.program_members\"\n\t\t\t\trow-key=\"name\"\n\t\t\t\t:options=\"{\n\t\t\t\t\tshowTooltip: false,\n\t\t\t\t}\"\n\t\t\t>\n\t\t\t\t<ListHeader\n\t\t\t\t\tclass=\"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2\"\n\t\t\t\t>\n\t\t\t\t\t<ListHeaderItem :item=\"item\" v-for=\"item in memberColumns\" />\n\t\t\t\t</ListHeader>\n\t\t\t\t<ListRows>\n\t\t\t\t\t<ListRow :row=\"row\" v-for=\"row in program.doc.program_members\" />\n\t\t\t\t</ListRows>\n\t\t\t\t<ListSelectBanner>\n\t\t\t\t\t<template #actions=\"{ unselectAll, selections }\">\n\t\t\t\t\t\t<div class=\"flex gap-2\">\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t@click=\"remove(selections, unselectAll, 'program_members')\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Trash2 class=\"h-4 w-4 stroke-1.5\" />\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</ListSelectBanner>\n\t\t\t</ListView>\n\t\t</div>\n\t</div>\n\n\t<Dialog\n\t\tv-model=\"showDialog\"\n\t\t:options=\"{\n\t\t\ttitle:\n\t\t\t\tcurrentForm == 'course'\n\t\t\t\t\t? __('New Program Course')\n\t\t\t\t\t: __('New Program Member'),\n\t\t\tactions: [\n\t\t\t\t{\n\t\t\t\t\tlabel: __('Add'),\n\t\t\t\t\tvariant: 'solid',\n\t\t\t\t\tonClick: () =>\n\t\t\t\t\t\tcurrentForm == 'course'\n\t\t\t\t\t\t\t? addProgramCourse(close)\n\t\t\t\t\t\t\t: addProgramMember(close),\n\t\t\t\t},\n\t\t\t],\n\t\t}\"\n\t>\n\t\t<template #body-content>\n\t\t\t<Link\n\t\t\t\tv-if=\"currentForm == 'course'\"\n\t\t\t\tv-model=\"course\"\n\t\t\t\tdoctype=\"LMS Course\"\n\t\t\t\t:filters=\"{\n\t\t\t\t\tdisable_self_learning: 1,\n\t\t\t\t}\"\n\t\t\t\t:label=\"__('Program Course')\"\n\t\t\t\t:description=\"\n\t\t\t\t\t__(\n\t\t\t\t\t\t'Only courses for which self learning is disabled can be added to program.'\n\t\t\t\t\t)\n\t\t\t\t\"\n\t\t\t/>\n\n\t\t\t<Link\n\t\t\t\tv-if=\"currentForm == 'member'\"\n\t\t\t\tv-model=\"member\"\n\t\t\t\tdoctype=\"User\"\n\t\t\t\t:filters=\"{\n\t\t\t\t\tignore_user_type: 1,\n\t\t\t\t}\"\n\t\t\t\t:label=\"__('Program Member')\"\n\t\t\t\t:onCreate=\"(value, close) => openSettings('Members', close)\"\n\t\t\t/>\n\t\t</template>\n\t</Dialog>\n</template>\n<script setup>\nimport {\n\tBreadcrumbs,\n\tButton,\n\tcall,\n\tcreateDocumentResource,\n\tDialog,\n\tFormControl,\n\tListView,\n\tListRows,\n\tListRow,\n\tListHeader,\n\tListHeaderItem,\n\tListSelectBanner,\n\tusePageMeta,\n\ttoast,\n} from 'frappe-ui'\nimport { computed, ref } from 'vue'\nimport { Plus, Trash2 } from 'lucide-vue-next'\nimport { useRouter } from 'vue-router'\nimport { sessionStore } from '@/stores/session'\nimport { openSettings } from '@/utils'\nimport Draggable from 'vuedraggable'\nimport Link from '@/components/Controls/Link.vue'\n\nconst { brand } = sessionStore()\nconst showDialog = ref(false)\nconst currentForm = ref(null)\nconst course = ref(null)\nconst member = ref(null)\nconst router = useRouter()\n\nconst props = defineProps({\n\tprogramName: {\n\t\ttype: String,\n\t\trequired: true,\n\t},\n})\n\nconst program = createDocumentResource({\n\tdoctype: 'LMS Program',\n\tname: props.programName,\n\tauto: true,\n\tcache: ['program', props.programName],\n})\n\nconst addProgramCourse = () => {\n\tprogram.setValue.submit(\n\t\t{\n\t\t\tprogram_courses: [\n\t\t\t\t...program.doc.program_courses,\n\t\t\t\t{ course: course.value },\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\tonSuccess(data) {\n\t\t\t\tshowDialog.value = false\n\t\t\t\tcourse.value = null\n\t\t\t\ttoast.success(__('Course added to program'))\n\t\t\t\tprogram.reload()\n\t\t\t},\n\t\t\tonError(err) {\n\t\t\t\ttoast.error(err.messages?.[0] || err)\n\t\t\t},\n\t\t}\n\t)\n}\n\nconst addProgramMember = () => {\n\tprogram.setValue.submit(\n\t\t{\n\t\t\tprogram_members: [\n\t\t\t\t...program.doc.program_members,\n\t\t\t\t{ member: member.value },\n\t\t\t],\n\t\t},\n\t\t{\n\t\t\tonSuccess(data) {\n\t\t\t\tshowDialog.value = false\n\t\t\t\tmember.value = null\n\t\t\t\ttoast.success(__('Member added to program'))\n\t\t\t\tprogram.reload()\n\t\t\t},\n\t\t\tonError(err) {\n\t\t\t\ttoast.error(err.messages?.[0] || err)\n\t\t\t},\n\t\t}\n\t)\n}\n\nconst remove = (selections, unselectAll, doctype) => {\n\tselections = Array.from(selections)\n\tprogram.setValue.submit(\n\t\t{\n\t\t\t[doctype]: program.doc[doctype].filter(\n\t\t\t\t(row) => !selections.includes(row.name)\n\t\t\t),\n\t\t},\n\t\t{\n\t\t\tonSuccess(data) {\n\t\t\t\tunselectAll()\n\t\t\t\ttoast.success(__('Items removed successfully'))\n\t\t\t\tprogram.reload()\n\t\t\t},\n\t\t\tonError(err) {\n\t\t\t\ttoast.error(err.messages?.[0] || err)\n\t\t\t},\n\t\t}\n\t)\n}\n\nconst updateOrder = (e) => {\n\tlet sourceIdx = e.from.dataset.idx\n\tlet targetIdx = e.to.dataset.idx\n\tlet courses = program.doc.program_courses\n\tcourses.splice(targetIdx, 0, courses.splice(sourceIdx, 1)[0])\n\n\tcourses.forEach((course, index) => {\n\t\tcourse.idx = index + 1\n\t})\n\n\tprogram.setValue.submit(\n\t\t{\n\t\t\tprogram_courses: courses,\n\t\t},\n\t\t{\n\t\t\tonSuccess(data) {\n\t\t\t\ttoast.success(__('Course moved successfully'))\n\t\t\t\tprogram.reload()\n\t\t\t},\n\t\t\tonError(err) {\n\t\t\t\ttoast.error(err.messages?.[0] || err)\n\t\t\t},\n\t\t}\n\t)\n}\n\nconst saveProgram = () => {\n\tcall('frappe.model.rename_doc.update_document_title', {\n\t\tdoctype: 'LMS Program',\n\t\tdocname: program.doc.name,\n\t\tname: program.doc.title,\n\t}).then((data) => {\n\t\trouter.push({ name: 'ProgramForm', params: { programName: data } })\n\t})\n}\n\nconst courseColumns = computed(() => {\n\treturn [\n\t\t{\n\t\t\tlabel: 'Title',\n\t\t\tkey: 'course_title',\n\t\t\twidth: 3,\n\t\t},\n\t\t{\n\t\t\tlabel: 'ID',\n\t\t\tkey: 'course',\n\t\t\twidth: 3,\n\t\t},\n\t]\n})\n\nconst memberColumns = computed(() => {\n\treturn [\n\t\t{\n\t\t\tlabel: 'Member',\n\t\t\tkey: 'member',\n\t\t\twidth: 3,\n\t\t\talign: 'left',\n\t\t},\n\t\t{\n\t\t\tlabel: 'Full Name',\n\t\t\tkey: 'full_name',\n\t\t\twidth: 3,\n\t\t\talign: 'left',\n\t\t},\n\t\t{\n\t\t\tlabel: 'Progress (%)',\n\t\t\tkey: 'progress',\n\t\t\twidth: 3,\n\t\t\talign: 'right',\n\t\t},\n\t]\n})\n\nconst breadbrumbs = computed(() => {\n\treturn [\n\t\t{\n\t\t\tlabel: 'Programs',\n\t\t\troute: { name: 'Programs' },\n\t\t},\n\t\t{\n\t\t\tlabel: props.programName === 'new' ? 'New Program' : props.programName,\n\t\t},\n\t]\n})\n\nusePageMeta(() => {\n\treturn {\n\t\ttitle: program.doc?.title,\n\t\ticon: brand.favicon,\n\t}\n})\n</script>\n"],"names":["brand","sessionStore","showDialog","ref","currentForm","course","member","router","useRouter","props","__props","program","createDocumentResource","addProgramCourse","data","toast","err","_a","addProgramMember","remove","selections","unselectAll","doctype","row","updateOrder","sourceIdx","targetIdx","courses","index","saveProgram","call","courseColumns","computed","memberColumns","breadbrumbs","usePageMeta"],"mappings":"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"}