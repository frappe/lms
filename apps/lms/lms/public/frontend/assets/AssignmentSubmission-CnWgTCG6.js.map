{"version":3,"file":"AssignmentSubmission-CnWgTCG6.js","sources":["../../../../frontend/src/components/Assignment.vue","../../../../frontend/src/pages/AssignmentSubmission.vue"],"sourcesContent":["<template>\n\t<div\n\t\tv-if=\"assignment.data\"\n\t\tclass=\"grid grid-cols-2 h-full\"\n\t\t:class=\"{ 'border rounded-lg overflow-auto': !showTitle }\"\n\t>\n\t\t<div\n\t\t\tclass=\"border-r p-5 overflow-y-auto h-[calc(100vh-3.2rem)]\"\n\t\t\t:class=\"{ 'h-full': !showTitle }\"\n\t\t>\n\t\t\t<div v-if=\"showTitle\" class=\"text-lg font-semibold mb-5 text-ink-gray-9\">\n\t\t\t\t<div v-if=\"submissionName === 'new'\">\n\t\t\t\t\t{{ __('Submission by') }} {{ user.data?.full_name }}\n\t\t\t\t</div>\n\t\t\t\t<div v-else>\n\t\t\t\t\t{{ __('Submission by') }} {{ submissionResource.doc?.member_name }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"text-sm text-ink-gray-7 font-medium mb-2\">\n\t\t\t\t{{ __('Question') }}:\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-html=\"assignment.data.question\"\n\t\t\t\tclass=\"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal\"\n\t\t\t></div>\n\t\t</div>\n\n\t\t<div class=\"flex flex-col\">\n\t\t\t<div class=\"p-5\">\n\t\t\t\t<div class=\"flex items-center justify-between mb-4\">\n\t\t\t\t\t<div class=\"font-semibold text-ink-gray-9\">\n\t\t\t\t\t\t{{ __('Submission') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"flex items-center space-x-2\">\n\t\t\t\t\t\t<Badge v-if=\"isDirty\" theme=\"orange\">\n\t\t\t\t\t\t\t{{ __('Not Saved') }}\n\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\tv-else-if=\"submissionResource.doc?.status\"\n\t\t\t\t\t\t\t:theme=\"statusTheme\"\n\t\t\t\t\t\t\tsize=\"lg\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ submissionResource.doc?.status }}\n\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t<Button variant=\"solid\" @click=\"submitAssignment()\">\n\t\t\t\t\t\t\t{{ __('Save') }}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"\n\t\t\t\t\t\tsubmissionName != 'new' &&\n\t\t\t\t\t\t!['Pass', 'Fail'].includes(submissionResource.doc?.status) &&\n\t\t\t\t\t\tsubmissionResource.doc?.owner == user.data?.name\n\t\t\t\t\t\"\n\t\t\t\t\tclass=\"bg-surface-blue-2 text-ink-blue-2 p-3 rounded-md leading-5 text-sm mb-4\"\n\t\t\t\t>\n\t\t\t\t\t{{ __(\"You've successfully submitted the assignment.\") }}\n\t\t\t\t\t{{\n\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\"Once the moderator grades your submission, you'll find the details here.\"\n\t\t\t\t\t\t)\n\t\t\t\t\t}}\n\t\t\t\t\t{{ __('Feel free to make edits to your submission if needed.') }}\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"showUploader()\">\n\t\t\t\t\t<div class=\"text-xs text-ink-gray-5 mt-1 mb-2\">\n\t\t\t\t\t\t{{ __('Add your assignment as {0}').format(assignment.data.type) }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<FileUploader\n\t\t\t\t\t\tv-if=\"!submissionFile\"\n\t\t\t\t\t\t:fileTypes=\"getType()\"\n\t\t\t\t\t\t:validateFile=\"validateFile\"\n\t\t\t\t\t\t@success=\"(file) => saveSubmission(file)\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template #default=\"{ uploading, progress, openFileSelector }\">\n\t\t\t\t\t\t\t<Button @click=\"openFileSelector\" :loading=\"uploading\">\n\t\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\t\tuploading\n\t\t\t\t\t\t\t\t\t\t? __('Uploading {0}%').format(progress)\n\t\t\t\t\t\t\t\t\t\t: __('Upload File')\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</FileUploader>\n\t\t\t\t\t<div v-else>\n\t\t\t\t\t\t<div class=\"flex text-ink-gray-7\">\n\t\t\t\t\t\t\t<div class=\"border self-start rounded-md p-2 mr-2\">\n\t\t\t\t\t\t\t\t<FileText class=\"h-5 w-5 stroke-1.5\" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t:href=\"submissionFile.file_url\"\n\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\tclass=\"flex flex-col cursor-pointer !no-underline\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span class=\"text-sm leading-5\">\n\t\t\t\t\t\t\t\t\t{{ submissionFile.file_name }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span class=\"text-sm text-ink-gray-5 mt-1\">\n\t\t\t\t\t\t\t\t\t{{ getFileSize(submissionFile.file_size) }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t<X\n\t\t\t\t\t\t\t\tv-if=\"canModifyAssignment\"\n\t\t\t\t\t\t\t\t@click=\"removeSubmission()\"\n\t\t\t\t\t\t\t\tclass=\"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-else-if=\"assignment.data.type == 'URL'\">\n\t\t\t\t\t<div class=\"text-xs text-ink-gray-5 mb-1\">\n\t\t\t\t\t\t{{ __('Enter a URL') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<FormControl\n\t\t\t\t\t\tv-model=\"answer\"\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t:readonly=\"!canModifyAssignment\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div v-else>\n\t\t\t\t\t<div class=\"text-sm mb-2 text-ink-gray-7\">\n\t\t\t\t\t\t{{ __('Write your answer here') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<TextEditor\n\t\t\t\t\t\t:content=\"answer\"\n\t\t\t\t\t\t@change=\"(val) => (answer = val)\"\n\t\t\t\t\t\t:editable=\"true\"\n\t\t\t\t\t\t:fixedMenu=\"true\"\n\t\t\t\t\t\teditorClass=\"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"\n\t\t\t\t\t\tuser.data?.name == submissionResource.doc?.owner &&\n\t\t\t\t\t\tsubmissionResource.doc?.comments\n\t\t\t\t\t\"\n\t\t\t\t\tclass=\"mt-8 p-3 bg-surface-blue-2 rounded-md\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"text-sm text-ink-gray-5 font-medium mb-2\">\n\t\t\t\t\t\t{{ __('Comments by Evaluator') }}:\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"leading-5 text-ink-gray-9\"\n\t\t\t\t\t\tv-html=\"submissionResource.doc.comments\"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\n\t\t\t\t<!-- Grading -->\n\t\t\t\t<div v-if=\"canGradeSubmission\" class=\"mt-8 space-y-4\">\n\t\t\t\t\t<div class=\"font-semibold mb-2 text-ink-gray-9\">\n\t\t\t\t\t\t{{ __('Grading') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<FormControl\n\t\t\t\t\t\tv-if=\"submissionResource.doc\"\n\t\t\t\t\t\tv-model=\"submissionResource.doc.status\"\n\t\t\t\t\t\t:label=\"__('Grade')\"\n\t\t\t\t\t\ttype=\"select\"\n\t\t\t\t\t\t:options=\"submissionStatusOptions\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div class=\"text-sm text-ink-gray-5 mb-1\">\n\t\t\t\t\t\t\t{{ __('Comments') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<TextEditor\n\t\t\t\t\t\t\t:content=\"comments\"\n\t\t\t\t\t\t\t@change=\"\n\t\t\t\t\t\t\t\t(val) => {\n\t\t\t\t\t\t\t\t\tcomments = val\n\t\t\t\t\t\t\t\t\tisDirty = true\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\"\n\t\t\t\t\t\t\t:editable=\"true\"\n\t\t\t\t\t\t\t:fixedMenu=\"true\"\n\t\t\t\t\t\t\teditorClass=\"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</template>\n<script setup>\nimport {\n\tBadge,\n\tButton,\n\tcall,\n\tcreateResource,\n\tcreateDocumentResource,\n\tFileUploader,\n\tFormControl,\n\tTextEditor,\n\ttoast,\n} from 'frappe-ui'\nimport { computed, inject, onMounted, onBeforeUnmount, ref, watch } from 'vue'\nimport { FileText, X } from 'lucide-vue-next'\nimport { getFileSize } from '@/utils'\nimport { useRouter } from 'vue-router'\n\nconst submissionFile = ref(null)\nconst answer = ref(null)\nconst comments = ref(null)\nconst router = useRouter()\nconst user = inject('$user')\nconst isDirty = ref(false)\n\nconst props = defineProps({\n\tassignmentID: {\n\t\ttype: String,\n\t\trequired: true,\n\t},\n\tsubmissionName: {\n\t\ttype: String,\n\t\tdefault: 'new',\n\t},\n\tshowTitle: {\n\t\ttype: Boolean,\n\t\tdefault: true,\n\t},\n})\n\nonMounted(() => {\n\twindow.addEventListener('keydown', keyboardShortcut)\n})\n\nconst keyboardShortcut = (e) => {\n\tif (e.key === 's' && (e.ctrlKey || e.metaKey)) {\n\t\tsubmitAssignment()\n\t\te.preventDefault()\n\t}\n}\n\nonBeforeUnmount(() => {\n\twindow.removeEventListener('keydown', keyboardShortcut)\n})\n\nconst assignment = createResource({\n\turl: 'frappe.client.get',\n\tparams: {\n\t\tdoctype: 'LMS Assignment',\n\t\tname: props.assignmentID,\n\t},\n\tauto: true,\n\tonSuccess(data) {\n\t\tif (props.submissionName != 'new') {\n\t\t\tsubmissionResource.reload()\n\t\t}\n\t},\n})\n\nconst newSubmission = createResource({\n\turl: 'frappe.client.insert',\n\tmakeParams(values) {\n\t\tlet doc = {\n\t\t\tdoctype: 'LMS Assignment Submission',\n\t\t\tassignment: props.assignmentID,\n\t\t\tmember: user.data?.name,\n\t\t}\n\t\tif (showUploader()) {\n\t\t\tdoc.assignment_attachment = submissionFile.value.file_url\n\t\t} else {\n\t\t\tdoc.answer = answer.value\n\t\t}\n\t\treturn {\n\t\t\tdoc: doc,\n\t\t}\n\t},\n})\n\nconst imageResource = createResource({\n\turl: 'lms.lms.api.get_file_info',\n\tmakeParams(values) {\n\t\treturn {\n\t\t\tfile_url: values.image,\n\t\t}\n\t},\n\tauto: false,\n\tonSuccess(data) {\n\t\tsubmissionFile.value = data\n\t},\n})\n\nconst submissionResource = createDocumentResource({\n\tdoctype: 'LMS Assignment Submission',\n\tname: props.submissionName,\n\tonError(err) {\n\t\ttoast.error(err.messages?.[0] || err)\n\t},\n\tauto: false,\n\tcache: [user.data?.name, props.assignmentID],\n})\n\nwatch(submissionResource, () => {\n\tif (submissionResource.doc) {\n\t\tif (submissionResource.doc.assignment_attachment) {\n\t\t\timageResource.reload({\n\t\t\t\timage: submissionResource.doc.assignment_attachment,\n\t\t\t})\n\t\t}\n\t\tif (submissionResource.doc.answer) {\n\t\t\tanswer.value = submissionResource.doc.answer\n\t\t}\n\t\tif (submissionResource.doc.comments) {\n\t\t\tcomments.value = submissionResource.doc.comments\n\t\t}\n\t\tif (submissionResource.isDirty) {\n\t\t\tisDirty.value = true\n\t\t} else if (showUploader() && !submissionFile.value) {\n\t\t\tisDirty.value = true\n\t\t} else if (!showUploader() && !answer.value) {\n\t\t\tisDirty.value = true\n\t\t} else {\n\t\t\tisDirty.value = false\n\t\t}\n\t}\n})\n\nwatch(submissionFile, () => {\n\tif (props.submissionName == 'new' && submissionFile.value) {\n\t\tisDirty.value = true\n\t}\n})\n\nconst submitAssignment = () => {\n\tif (props.submissionName != 'new') {\n\t\tlet evaluator =\n\t\t\tsubmissionResource.doc && submissionResource.doc.owner != user.data?.name\n\t\t\t\t? user.data?.name\n\t\t\t\t: null\n\n\t\tsubmissionResource.setValue.submit(\n\t\t\t{\n\t\t\t\t...submissionResource.doc,\n\t\t\t\tassignment_attachment: submissionFile.value?.file_url,\n\t\t\t\tevaluator: evaluator,\n\t\t\t\tcomments: comments.value,\n\t\t\t\tanswer: answer.value,\n\t\t\t},\n\t\t\t{\n\t\t\t\tonSuccess(data) {\n\t\t\t\t\ttoast.success(__('Changes saved successfully'))\n\t\t\t\t},\n\t\t\t}\n\t\t)\n\t} else {\n\t\taddNewSubmission()\n\t}\n}\n\nconst addNewSubmission = () => {\n\tnewSubmission.submit(\n\t\t{},\n\t\t{\n\t\t\tonSuccess(data) {\n\t\t\t\ttoast.success(__('Assignment submitted successfully'))\n\t\t\t\tif (router.currentRoute.value.name == 'AssignmentSubmission') {\n\t\t\t\t\trouter.push({\n\t\t\t\t\t\tname: 'AssignmentSubmission',\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tassignmentID: props.assignmentID,\n\t\t\t\t\t\t\tsubmissionName: data.name,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tquery: { fromLesson: router.currentRoute.value.query.fromLesson },\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\tmarkLessonProgress()\n\t\t\t\t\trouter.go()\n\t\t\t\t}\n\t\t\t\tsubmissionResource.name = data.name\n\t\t\t\tsubmissionResource.reload()\n\t\t\t},\n\t\t\tonError(err) {\n\t\t\t\ttoast.error(err.messages?.[0] || err)\n\t\t\t},\n\t\t}\n\t)\n}\n\nconst saveSubmission = (file) => {\n\tisDirty.value = true\n\tsubmissionFile.value = file\n}\n\nconst markLessonProgress = () => {\n\tif (router.currentRoute.value.name == 'Lesson') {\n\t\tlet courseName = router.currentRoute.value.params.courseName\n\t\tlet chapterNumber = router.currentRoute.value.params.chapterNumber\n\t\tlet lessonNumber = router.currentRoute.value.params.lessonNumber\n\n\t\tcall('lms.lms.api.mark_lesson_progress', {\n\t\t\tcourse: courseName,\n\t\t\tchapter_number: chapterNumber,\n\t\t\tlesson_number: lessonNumber,\n\t\t})\n\t}\n}\n\nconst getType = () => {\n\tconst type = assignment.data?.type\n\tif (type == 'Image') {\n\t\treturn ['image/*']\n\t} else if (type == 'Document') {\n\t\treturn [\n\t\t\t'.doc',\n\t\t\t'.docx',\n\t\t\t'.xml',\n\t\t\t'application/msword',\n\t\t\t'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n\t\t]\n\t} else if (type == 'PDF') {\n\t\treturn ['.pdf']\n\t}\n}\n\nconst validateFile = (file) => {\n\tlet type = assignment.data?.type\n\tlet extension = file.name.split('.').pop().toLowerCase()\n\tif (type == 'Image' && !['jpg', 'jpeg', 'png'].includes(extension)) {\n\t\treturn 'Only image file is allowed.'\n\t} else if (\n\t\ttype == 'Document' &&\n\t\t!['doc', 'docx', 'xml'].includes(extension)\n\t) {\n\t\treturn 'Only document file is allowed.'\n\t} else if (type == 'PDF' && !['pdf'].includes(extension)) {\n\t\treturn 'Only PDF file is allowed.'\n\t}\n}\n\nconst removeSubmission = () => {\n\tisDirty.value = true\n\tsubmissionFile.value = null\n}\n\nconst canGradeSubmission = computed(() => {\n\treturn (\n\t\t(user.data?.is_moderator ||\n\t\t\tuser.data?.is_evaluator ||\n\t\t\tuser.data?.is_instructor) &&\n\t\tprops.submissionName != 'new' &&\n\t\trouter.currentRoute.value.name == 'AssignmentSubmission'\n\t)\n})\n\nconst canModifyAssignment = computed(() => {\n\treturn (\n\t\t!submissionResource.doc ||\n\t\t(submissionResource.doc?.owner == user.data?.name &&\n\t\t\tsubmissionResource.doc?.status == 'Not Graded')\n\t)\n})\n\nconst submissionStatusOptions = computed(() => {\n\treturn [\n\t\t{ label: 'Not Graded', value: 'Not Graded' },\n\t\t{ label: 'Pass', value: 'Pass' },\n\t\t{ label: 'Fail', value: 'Fail' },\n\t]\n})\n\nconst statusTheme = computed(() => {\n\tif (!submissionResource.doc) {\n\t\treturn 'orange'\n\t} else if (submissionResource.doc.status == 'Pass') {\n\t\treturn 'green'\n\t} else if (submissionResource.doc.status == 'Not Graded') {\n\t\treturn 'blue'\n\t} else {\n\t\treturn 'red'\n\t}\n})\n\nconst showUploader = () => {\n\treturn ['PDF', 'Image', 'Document'].includes(assignment.data?.type)\n}\n</script>\n","<template>\n\t<header\n\t\tv-if=\"!fromLesson\"\n\t\tclass=\"flex justify-between sticky top-0 z-10 border-b bg-surface-white px-3 py-2.5 sm:px-5\"\n\t>\n\t\t<Breadcrumbs :items=\"breadcrumbs\" />\n\t</header>\n\t<div class=\"overflow-hidden h-[calc(100vh-3.2rem)]\">\n\t\t<Assignment\n\t\t\t:assignmentID=\"assignmentID\"\n\t\t\t:submissionName=\"submissionName\"\n\t\t\t:showTitle=\"!fromLesson\"\n\t\t/>\n\t</div>\n</template>\n<script setup>\nimport { Breadcrumbs, createResource, usePageMeta } from 'frappe-ui'\nimport { computed, inject, onMounted, ref } from 'vue'\nimport { sessionStore } from '../stores/session'\nimport Assignment from '@/components/Assignment.vue'\n\nconst user = inject('$user')\nconst fromLesson = ref(false)\nconst { brand } = sessionStore()\n\nconst props = defineProps({\n\tassignmentID: {\n\t\ttype: String,\n\t\trequired: true,\n\t},\n\tsubmissionName: {\n\t\ttype: String,\n\t\tdefault: 'new',\n\t},\n})\n\nconst title = createResource({\n\turl: 'frappe.client.get_value',\n\tparams: {\n\t\tdoctype: 'LMS Assignment',\n\t\tfieldname: 'title',\n\t\tfilters: {\n\t\t\tname: props.assignmentID,\n\t\t},\n\t},\n\tauto: true,\n})\n\nonMounted(() => {\n\tif (!user.data) {\n\t\twindow.location.href = '/login'\n\t}\n\n\tif (new URLSearchParams(window.location.search).get('fromLesson')) {\n\t\tfromLesson.value = true\n\t}\n})\n\nconst breadcrumbs = computed(() => {\n\tlet crumbs = [\n\t\t{\n\t\t\tlabel: 'Submissions',\n\t\t\troute: { name: 'AssignmentSubmissionList' },\n\t\t},\n\t\t{\n\t\t\tlabel: title.data?.title,\n\t\t\troute: {\n\t\t\t\tname: 'AssignmentSubmission',\n\t\t\t\tparams: {\n\t\t\t\t\tassignmentID: props.assignmentID,\n\t\t\t\t},\n\t\t\t},\n\t\t},\n\t]\n\treturn crumbs\n})\n\nusePageMeta(() => {\n\treturn {\n\t\ttitle: title.data?.title,\n\t\ticon: brand.favicon,\n\t}\n})\n</script>\n"],"names":["submissionFile","ref","answer","comments","router","useRouter","user","inject","isDirty","props","__props","onMounted","keyboardShortcut","submitAssignment","onBeforeUnmount","assignment","createResource","data","submissionResource","newSubmission","values","doc","_a","showUploader","imageResource","createDocumentResource","err","toast","watch","evaluator","_b","_c","addNewSubmission","markLessonProgress","saveSubmission","file","courseName","chapterNumber","lessonNumber","call","getType","type","validateFile","extension","removeSubmission","canGradeSubmission","computed","canModifyAssignment","submissionStatusOptions","statusTheme","fromLesson","brand","sessionStore","title","breadcrumbs","usePageMeta"],"mappings":"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"}