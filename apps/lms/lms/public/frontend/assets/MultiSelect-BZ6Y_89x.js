import{J as E,K as T,c3 as A,r as p,b as _,c4 as L,A as U,e as r,f as o,k as g,g as u,C as S,p as I,t as x,h as d,n as m,l,be as J,b3 as W,c5 as X,F as $,x as B,j as G,c6 as H,_ as Q,P as Y,b4 as Z,c7 as R,bW as ee,bk as te,c8 as se,b9 as ae,a3 as le}from"./index-D24HXhLT.js";const oe={key:0,class:"text-ink-red-3"},re={class:"w-full"},ue={class:"mt-1 rounded-lg bg-surface-white py-1 text-base border-2"},ne={class:"flex flex-col gap-1 p-1"},ie={class:"text-base font-medium text-ink-gray-8"},ce={class:"text-sm text-ink-gray-5"},de={key:0,class:"absolute bottom-2 left-1 w-[98%] pt-2 bg-white border-t"},fe={key:1,class:"grid grid-cols-2 gap-2 mt-1"},pe={class:"flex items-center justify-between break-all bg-surface-gray-2 text-ink-gray-7 word-wrap p-2 rounded-md mr-2"},me={class:"break-all"},ye={__name:"MultiSelect",props:E({label:{type:String},size:{type:String,default:"sm"},doctype:{type:String,required:!0},filters:{type:Object,default:()=>({})},validate:{type:Function,default:null},errorMessage:{type:Function,default:n=>`${n} is an Invalid value`},required:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(n,{expose:N}){const i=n,a=T(n,"modelValue"),V=A(),y=p([]),C=p(null),k=p(null),f=p(""),b=p(""),h=p(!1),F=_({get:()=>f.value||"",set:e=>{f.value="",e&&(h.value=!1),e!=null&&e.value&&z(e.value)}});L(f,e=>{e=e||"",b.value!==e&&(b.value=e,q(e))},{debounce:300,immediate:!0});const w=U({url:"frappe.desk.search.search_link",method:"POST",cache:[b.value,i.doctype],auto:!0,params:{txt:b.value,doctype:i.doctype}}),j=_(()=>w.data||[]);function q(e){w.update({params:{txt:e,doctype:i.doctype}}),w.reload()}const z=e=>{k.value=null,e&&(e.split(",").forEach(t=>{var c;if(t=t.trim(),t&&!((c=a.value)!=null&&c.includes(t))){if(t&&i.validate&&!i.validate(t)){k.value=i.errorMessage(t);return}a.value?a.value.push(t):a.value=[t],t=t.replace(t,"")}}),!k.value&&(e=""))},K=e=>{a.value=a.value.filter(s=>s!==e)},O=()=>{var s;if(f.value)return;let e=(s=y.value[y.value.length-1])==null?void 0:s.$el;document.activeElement===e?(a.value.pop(),le(()=>{a.value.length?(e=y.value[y.value.length-1].$el,e==null||e.focus()):M()})):e==null||e.focus()};function M(){C.value.$el.focus()}N({setFocus:M});const P=_(()=>[{sm:"text-xs",md:"text-base"}[i.size||"sm"],"text-ink-gray-5"]);return(e,s)=>(o(),r("div",null,[n.label?(o(),r("label",{key:0,class:S(["block mb-1",P.value])},[I(x(n.label)+" ",1),n.required?(o(),r("span",oe,"*")):g("",!0)],2)):g("",!0),u("div",re,[d(l(se),{modelValue:F.value,"onUpdate:modelValue":s[2]||(s[2]=t=>F.value=t),nullable:""},{default:m(()=>[d(l(J),{class:"w-full",show:h.value,"onUpdate:show":s[1]||(s[1]=t=>h.value=t)},{target:m(({togglePopover:t})=>[d(l(R),{ref_key:"search",ref:C,class:"search-input form-input w-full focus-visible:!ring-0",type:"text",value:f.value,onChange:s[0]||(s[0]=c=>{f.value=c.target.value,h.value=!0}),autocomplete:"off",onFocus:()=>t(),onKeydownCapture:ee(te(O,["stop"]),["delete"])},null,8,["value","onFocus","onKeydownCapture"])]),body:m(({isOpen:t,close:c})=>[W(u("div",null,[u("div",ue,[d(l(X),{class:"my-1 min-h-[6rem] max-h-[12rem] overflow-y-auto px-1.5",static:""},{default:m(()=>[(o(!0),r($,null,B(j.value,v=>(o(),G(l(H),{key:v.value,value:v},{default:m(({active:D})=>[u("li",{class:S(["flex cursor-pointer items-center rounded px-2 py-1 text-base",{"bg-surface-gray-2":D}])},[u("div",ne,[u("div",ie,x(v.description),1),u("div",ce,x(v.value),1)])],2)]),_:2},1032,["value"]))),128)),l(V).onCreate?(o(),r("div",de,[d(l(Q),{variant:"ghost",class:"w-full !justify-start",label:e.__("Create New"),onClick:v=>l(V).onCreate(c)},{prefix:m(()=>[d(l(Y),{class:"h-4 w-4 stroke-1.5"})]),_:2},1032,["label","onClick"])])):g("",!0)]),_:2},1024)])],512),[[Z,t]])]),_:1},8,["show"])]),_:1},8,["modelValue"])]),a.value.length?(o(),r("div",fe,[(o(!0),r($,null,B(a.value,t=>(o(),r("div",pe,[u("span",me,x(t),1),d(l(ae),{class:"size-4 stroke-1.5 cursor-pointer",onClick:c=>K(t)},null,8,["onClick"])]))),256))])):g("",!0)]))}};export{ye as _};
//# sourceMappingURL=MultiSelect-BZ6Y_89x.js.map
