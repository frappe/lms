import{J as se,K as X,r as H,i as Z,aw as te,L as O,A as V,w as ee,j as h,f as d,n as _,g as r,e as c,k as q,t as b,h as n,l as a,aH as ae,aG as le,q as p,F as U,x as T,ag as oe,_ as z,p as M,M as ne,H as v,s as ie,z as ue,o as re,T as de,b as Y,u as me,d as _e,P as ce,ah as pe,ai as fe,ak as be,al as ke,am as ye,an as qe,ao as ve,ap as Ve,N as ge}from"./index-D24HXhLT.js";import{_ as we}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-DRN2bHzK.js";const he={class:"p-5 space-y-5"},ze={class:"text-lg font-semibold text-ink-gray-9 mb-5"},Qe={key:0,class:"flex items-center text-xs text-ink-gray-7 space-x-5"},$e={key:1,class:"space-y-2"},Se={class:"block text-xs text-ink-gray-5 mb-1"},Me={class:"grid grid-cols-2 gap-4"},Ue={key:0,class:"text-base font-semibold text-ink-gray-9 mb-5 mt-5"},De={key:1,class:"text-base font-semibold text-ink-gray-9 mb-5 mt-5"},xe={key:2,class:"grid grid-cols-2 gap-4"},Ce={class:"space-y-4 py-2"},Le={key:3,class:"grid grid-cols-2 gap-4 py-2"},Ee={key:2,class:"space-y-2"},Ie={class:"flex items-center justify-end space-x-2 mt-5"},Pe={__name:"Question",props:se({title:{type:String,default:__("Add a new question")},questionDetail:{type:[Object,null],required:!0}},{modelValue:{},modelModifiers:{},quiz:{},quizModifiers:{}}),emits:["update:modelValue","update:quiz"],setup(Q){const y=X(Q,"modelValue"),g=X(Q,"quiz"),f=H(!1),w=H(!1),D=Z("$user"),{updateOnboardingStep:x}=te("learning"),m=O({question:"",marks:1}),s=O({question:"",type:"Choices",marks:1}),$=()=>{let o=["option","is_correct","explanation","possibility"],l=1;o.forEach(e=>{for(;l<=4;)s[`${e}_${l}`]=e==="is_correct"?!1:null,l++})};$();const u=Q,C=V({url:"frappe.client.get",makeParams(){return{doctype:"LMS Question",name:u.questionDetail.question}},auto:!1,onSuccess(o){let l=1;for(w.value=!0,Object.keys(o).forEach(e=>{Object.hasOwn(s,e)&&(s[e]=o[e])});l<=4;)s[`is_correct_${l}`]=!!o[`is_correct_${l}`],l++;s.marks=u.questionDetail.marks}});ee(y,()=>{y.value&&(w.value=!1,u.questionDetail.question?C.fetch():(s.question="",s.marks=1,s.type="Choices",m.question="",m.marks=1,f.value=!1,$()),u.questionDetail.marks&&(s.marks=u.questionDetail.marks))});const j=V({url:"frappe.client.insert",makeParams(o){return{doc:{doctype:"LMS Quiz Question",parent:g.value.data.name,parentfield:"questions",parenttype:"LMS Quiz",...o}}}}),L=V({url:"frappe.client.insert",makeParams(o){return{doc:{doctype:"LMS Question",...s}}}}),N=()=>{var o;(o=u.questionDetail)!=null&&o.question?F():A()},A=()=>{f.value?E({question:m.question,marks:m.marks}):L.submit({},{onSuccess(o){E({question:o.name,marks:s.marks})},onError(o){var l;v.error(((l=o.messages)==null?void 0:l[0])||o)}})},E=o=>{j.submit({...o},{onSuccess(){var l;(l=D.data)!=null&&l.is_system_manager&&x("create_first_quiz"),y.value=!1,v.success(__("Question added successfully")),g.value.reload(),y.value=!1},onError(l){var e;v.error(((e=l.messages)==null?void 0:e[0])||l),y.value=!1}})},I=V({url:"frappe.client.set_value",auto:!1,makeParams(o){var l;return{doctype:"LMS Question",name:(l=C.data)==null?void 0:l.name,fieldname:{...s}}}}),P=V({url:"frappe.client.set_value",auto:!1,makeParams(o){return{doctype:"LMS Quiz Question",name:u.questionDetail.name,fieldname:{marks:s.marks}}}}),F=()=>{I.submit({},{onSuccess(){P.submit({},{onSuccess(){y.value=!1,v.success(__("Question updated successfully")),g.value.reload()}})},onError(o){var l;v.error(((l=o.messages)==null?void 0:l[0])||o)}})};return(o,l)=>(d(),h(a(ne),{modelValue:y.value,"onUpdate:modelValue":l[7]||(l[7]=e=>y.value=e),options:{size:"3xl"}},{body:_(()=>[r("div",he,[r("div",ze,b(o.__(u.title)),1),w.value?q("",!0):(d(),c("div",Qe,[n(a(ae),{size:"sm",label:o.__("Choose an existing question"),modelValue:f.value,"onUpdate:modelValue":l[0]||(l[0]=e=>f.value=e),class:"!p-0"},null,8,["label","modelValue"])])),!f.value||w.value?(d(),c("div",$e,[r("div",null,[r("label",Se,b(o.__("Question")),1),n(a(le),{content:s.question,onChange:l[1]||(l[1]=e=>s.question=e),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),r("div",Me,[n(a(p),{modelValue:s.marks,"onUpdate:modelValue":l[2]||(l[2]=e=>s.marks=e),label:o.__("Marks"),type:"number"},null,8,["modelValue","label"]),n(a(p),{label:o.__("Type"),modelValue:s.type,"onUpdate:modelValue":l[3]||(l[3]=e=>s.type=e),type:"select",options:["Choices","User Input","Open Ended"],class:"pb-2",required:!0},null,8,["label","modelValue"])]),s.type=="Choices"?(d(),c("div",Ue,b(o.__("Options")),1)):s.type=="User Input"?(d(),c("div",De,b(o.__("Possibilities")),1)):q("",!0),s.type=="Choices"?(d(),c("div",xe,[(d(),c(U,null,T(4,e=>r("div",Ce,[n(a(p),{label:o.__("Option")+" "+e,modelValue:s[`option_${e}`],"onUpdate:modelValue":t=>s[`option_${e}`]=t,required:e<=2},null,8,["label","modelValue","onUpdate:modelValue","required"]),n(a(p),{label:o.__("Explanation"),modelValue:s[`explanation_${e}`],"onUpdate:modelValue":t=>s[`explanation_${e}`]=t},null,8,["label","modelValue","onUpdate:modelValue"]),n(a(p),{label:o.__("Correct Answer"),modelValue:s[`is_correct_${e}`],"onUpdate:modelValue":t=>s[`is_correct_${e}`]=t,type:"checkbox"},null,8,["label","modelValue","onUpdate:modelValue"])])),64))])):s.type=="User Input"?(d(),c("div",Le,[(d(),c(U,null,T(4,e=>r("div",null,[n(a(p),{label:o.__("Possibility")+" "+e,modelValue:s[`possibility_${e}`],"onUpdate:modelValue":t=>s[`possibility_${e}`]=t,required:e==1},null,8,["label","modelValue","onUpdate:modelValue","required"])])),64))])):q("",!0)])):f.value?(d(),c("div",Ee,[n(oe,{modelValue:m.question,"onUpdate:modelValue":l[4]||(l[4]=e=>m.question=e),label:o.__("Select a question"),doctype:"LMS Question"},null,8,["modelValue","label"]),n(a(p),{modelValue:m.marks,"onUpdate:modelValue":l[5]||(l[5]=e=>m.marks=e),label:o.__("Marks"),type:"number"},null,8,["modelValue","label"])])):q("",!0),r("div",Ie,[n(a(z),{variant:"solid",onClick:l[6]||(l[6]=e=>N())},{default:_(()=>[M(b(o.__("Submit")),1)]),_:1})])])]),_:1},8,["modelValue"]))}},Oe={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Te={key:0,class:"space-x-2"},je={class:"w-3/4 mx-auto py-5"},Ne={class:"mb-8"},Ae={class:"font-semibold text-ink-gray-9 mb-4"},Fe={key:0},Re={class:"grid grid-cols-2 gap-5 mt-4 mb-8"},Be={class:"mb-8"},He={class:"font-semibold text-ink-gray-9 mb-4"},Ke={class:"grid grid-cols-3 gap-5 my-4"},Ge={class:"mb-8"},Je={class:"font-semibold text-ink-gray-9 mb-4"},We={class:"grid grid-cols-3"},Xe={class:"flex items-center justify-between mb-4"},Ye={class:"font-semibold text-ink-gray-9"},Ze=["innerHTML"],es={key:1,class:"text-xs"},ss={class:"flex gap-2"},ls={__name:"QuizForm",props:{quizID:{type:String,required:!0}},setup(Q){const{brand:y}=ie(),g=H(!1),f=O({question:"",marks:0,name:""}),w=Z("$user"),D=ue(),x=window.read_only_mode,m=Q,s=O({title:"",total_marks:0,passing_percentage:0,max_attempts:0,duration:0,limit_questions_to:0,show_answers:!0,show_submission_history:!1,shuffle_questions:!1,questions:[]});re(()=>{var e,t;m.quizID=="new"&&!((e=w.data)!=null&&e.is_moderator)&&!((t=w.data)!=null&&t.is_instructor)&&D.push({name:"Courses"}),m.quizID!=="new"&&u.reload(),window.addEventListener("keydown",$)});const $=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&(L(),e.preventDefault())};de(()=>{window.removeEventListener("keydown",$)}),ee(()=>m.quizID!=="new",e=>{e&&u.reload()});const u=V({url:"frappe.client.get",makeParams(e){return{doctype:"LMS Quiz",name:m.quizID}},auto:!1,onSuccess(e){Object.keys(e).forEach(k=>{Object.hasOwn(s,k)&&(s[k]=e[k])});let t=["show_answers","show_submission_history","shuffle_questions"];for(let k in t){let S=t[k];s[S]=!!s[S]}}}),C=V({url:"frappe.client.insert",auto:!1,makeParams(e){return{doc:{doctype:"LMS Quiz",...s}}}}),j=V({url:"frappe.client.set_value",auto:!1,makeParams(e){return{doctype:"LMS Quiz",name:e.quizID,fieldname:{total_marks:E(),...s}}}}),L=()=>{var e;(e=u.data)!=null&&e.name?A():N()},N=()=>{C.submit({},{onSuccess(e){v.success(__("Quiz created successfully")),D.push({name:"QuizForm",params:{quizID:e.name}})},onError(e){var t;v.error(((t=e.messages)==null?void 0:t[0])||e)}})},A=()=>{var e;j.submit({quizID:(e=u.data)==null?void 0:e.name},{onSuccess(t){s.total_marks=t.total_marks,v.success(__("Quiz updated successfully"))},onError(t){var k;v.error(((k=t.messages)==null?void 0:k[0])||t)}})},E=()=>{let e=0;return s.limit_questions_to&&s.questions.length>0?s.questions[0].marks*s.limit_questions_to:(s.questions.forEach(t=>{e+=t.marks}),e)},I=Y(()=>[{label:__("ID"),key:"question",width:"10rem"},{label:__("Question"),key:__("question_detail"),width:"40rem"},{label:__("Marks"),key:"marks",width:"5rem"}]),P=(e=null)=>{e?(f.question=e.question,f.marks=e.marks,f.name=e.name):(f.question="",f.marks=0,f.name=""),g.value=!0},F=V({url:"lms.lms.api.delete_documents",makeParams(e){return{doctype:"LMS Quiz Question",documents:e.questions}}}),o=(e,t)=>{F.submit({questions:Array.from(e)},{onSuccess(){v.success(__("Questions deleted successfully")),u.reload(),t()}})},l=Y(()=>{var t;let e=[{label:__("Quizzes"),route:{name:"Quizzes"}}];return e.push({label:m.quizID=="new"?__("New Quiz"):(t=u.data)==null?void 0:t.title,route:{name:"QuizForm",params:{quizID:m.quizID}}}),e});return me(()=>{var e;return{title:m.quizID=="new"?__("New Quiz"):(e=u.data)==null?void 0:e.title,icon:y.favicon}}),(e,t)=>{var S,K,G,J;const k=_e("router-link");return d(),c(U,null,[r("header",Oe,[n(a(we),{items:l.value},null,8,["items"]),a(x)?q("",!0):(d(),c("div",Te,[(S=a(u).data)!=null&&S.name?(d(),h(k,{key:0,to:{name:"QuizPage",params:{quizID:a(u).data.name}}},{default:_(()=>[n(a(z),null,{default:_(()=>[M(b(e.__("Open")),1)]),_:1})]),_:1},8,["to"])):q("",!0),(K=a(u).data)!=null&&K.name?(d(),h(k,{key:1,to:{name:"QuizSubmissionList",params:{quizID:a(u).data.name}}},{default:_(()=>[n(a(z),null,{default:_(()=>[M(b(e.__("Submission List")),1)]),_:1})]),_:1},8,["to"])):q("",!0),n(a(z),{variant:"solid",onClick:t[0]||(t[0]=i=>L())},{default:_(()=>[M(b(e.__("Save")),1)]),_:1})]))]),r("div",je,[r("div",Ne,[r("div",Ae,b(e.__("Details")),1),n(a(p),{modelValue:s.title,"onUpdate:modelValue":t[1]||(t[1]=i=>s.title=i),label:(G=a(u).data)!=null&&G.name?e.__("Title"):e.__("Enter a title and save the quiz to proceed"),required:!0},null,8,["modelValue","label"]),(J=a(u).data)!=null&&J.name?(d(),c("div",Fe,[r("div",Re,[n(a(p),{type:"number",modelValue:s.max_attempts,"onUpdate:modelValue":t[2]||(t[2]=i=>s.max_attempts=i),label:e.__("Maximum Attempts")},null,8,["modelValue","label"]),n(a(p),{type:"number",modelValue:s.duration,"onUpdate:modelValue":t[3]||(t[3]=i=>s.duration=i),label:e.__("Duration (in minutes)")},null,8,["modelValue","label"]),n(a(p),{modelValue:s.total_marks,"onUpdate:modelValue":t[4]||(t[4]=i=>s.total_marks=i),label:e.__("Total Marks"),disabled:""},null,8,["modelValue","label"]),n(a(p),{modelValue:s.passing_percentage,"onUpdate:modelValue":t[5]||(t[5]=i=>s.passing_percentage=i),label:e.__("Passing Percentage")},null,8,["modelValue","label"])]),r("div",Be,[r("div",He,b(e.__("Settings")),1),r("div",Ke,[n(a(p),{modelValue:s.show_answers,"onUpdate:modelValue":t[6]||(t[6]=i=>s.show_answers=i),type:"checkbox",label:e.__("Show Answers")},null,8,["modelValue","label"]),n(a(p),{modelValue:s.show_submission_history,"onUpdate:modelValue":t[7]||(t[7]=i=>s.show_submission_history=i),type:"checkbox",label:e.__("Show Submission History")},null,8,["modelValue","label"])])]),r("div",Ge,[r("div",Je,b(e.__("Shuffle Settings")),1),r("div",We,[n(a(p),{modelValue:s.shuffle_questions,"onUpdate:modelValue":t[8]||(t[8]=i=>s.shuffle_questions=i),type:"checkbox",label:e.__("Shuffle Questions")},null,8,["modelValue","label"]),s.shuffle_questions?(d(),h(a(p),{key:0,modelValue:s.limit_questions_to,"onUpdate:modelValue":t[9]||(t[9]=i=>s.limit_questions_to=i),label:e.__("Limit Questions To")},null,8,["modelValue","label"])):q("",!0)])]),r("div",null,[r("div",Xe,[r("div",Ye,b(e.__("Questions")),1),a(x)?q("",!0):(d(),h(a(z),{key:0,onClick:t[10]||(t[10]=i=>P())},{prefix:_(()=>[n(a(ce),{class:"w-4 h-4"})]),default:_(()=>[M(" "+b(e.__("New Question")),1)]),_:1}))]),n(a(Ve),{columns:I.value,rows:s.questions,"row-key":"name",options:{showTooltip:!1}},{default:_(()=>[n(a(pe),{class:"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2"},{default:_(()=>[(d(!0),c(U,null,T(I.value,i=>(d(),h(a(fe),{item:i},null,8,["item"]))),256))]),_:1}),n(a(be),null,{default:_(()=>[(d(!0),c(U,null,T(s.questions,i=>(d(),h(a(ke),{row:i,onClick:R=>P(i),class:"cursor-pointer"},{default:_(({idx:R,column:W,item:B})=>[n(a(ye),{item:B},{default:_(()=>[W.key=="question_detail"?(d(),c("div",{key:0,class:"text-xs truncate h-4",innerHTML:B},null,8,Ze)):(d(),c("div",es,b(B),1))]),_:2},1032,["item"])]),_:2},1032,["row","onClick"]))),256))]),_:1}),n(a(qe),null,{actions:_(({unselectAll:i,selections:R})=>[r("div",ss,[n(a(z),{variant:"ghost",onClick:W=>o(R,i)},{default:_(()=>[n(a(ve),{class:"h-4 w-4 stroke-1.5"})]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["columns","rows"])])])):q("",!0)])]),n(Pe,{modelValue:g.value,"onUpdate:modelValue":t[11]||(t[11]=i=>g.value=i),questionDetail:f,quiz:a(u),"onUpdate:quiz":t[12]||(t[12]=i=>ge(u)?u.value=i:null),title:f.question?e.__("Edit the question"):e.__("Add a new question")},null,8,["modelValue","questionDetail","quiz","title"])],64)}}};export{ls as default};
//# sourceMappingURL=QuizForm-BjM3vEI6.js.map
