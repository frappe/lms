import{i as he,r as M,L as P,z as fe,A as z,b as ge,aF as ye,w as O,e as o,k as m,l as t,f as n,g as i,t as l,h as q,j as f,n as b,_ as C,F as R,x as j,b3 as ve,ci as K,cj as W,ck as Z,b4 as ke,q as be,B as ee,aG as we,ap as qe,H as te,a as xe}from"./index-D24HXhLT.js";import{_ as Se}from"./ProgressBar-rBBAZ6HI.js";const ze={key:0},Ce={class:"bg-surface-blue-2 space-y-1 py-2 px-2 mb-4 rounded-md text-sm text-ink-blue-3"},$e={class:"leading-5"},Te={key:0,class:"leading-5"},Me={key:1,class:"leading-5"},Ne={key:2,class:"leading-relaxed"},Ie={key:3,class:"leading-5"},Qe={key:0,class:"flex flex-col space-x-1 my-4"},Ee={class:"mb-2"},Le={class:""},Ae={class:"font-semibold"},Pe={key:1},Oe={class:"border text-center p-20 rounded-md"},Re={class:"font-semibold text-lg text-ink-gray-9"},je={key:1,class:"leading-5 text-ink-gray-7"},Be={key:2},De={key:0,class:"border rounded-md p-5"},Ve={class:"flex justify-between"},He={class:"text-sm text-ink-gray-5"},Ye={class:"mr-2"},Ue={class:"text-ink-gray-9 text-sm font-semibold item-left"},Fe=["innerHTML"],Je={key:0,class:"flex items-center bg-surface-gray-3 rounded-md p-3 mt-4 w-full cursor-pointer focus:border-blue-600"},Ge=["name","onChange"],Xe=["name","onChange"],Ke={key:0},We=["innerHTML"],Ze={key:1},et={key:0},tt={key:2},st={class:"flex items-center justify-between mt-4"},at={class:"text-sm text-ink-gray-5"},nt={key:3,class:"border rounded-md p-20 text-center space-y-2"},ot={class:"text-lg font-semibold text-ink-gray-9"},rt={key:0,class:"leading-5 text-ink-gray-7"},it={key:1},lt={key:4,class:"mt-10"},ct={__name:"Quiz",props:{quizName:{type:String,required:!0}},setup(se){const ae=he("$user"),p=M(0),$=M(""),h=P([0,0,0,0]),d=P([]);let g=P([]);const w=M(null),x=M(0);let N=null;const T=fe(),I=se,s=z({url:"frappe.client.get",makeParams(e){return{doctype:"LMS Quiz",name:I.quizName}},cache:["quiz",I.quizName],auto:!0,transform(e){e.duration=parseInt(e.duration)},onSuccess(e){Q(),B()}}),Q=()=>{let e=s.data;e.shuffle_questions?(g=ie(e.questions),e.limit_questions_to&&(g=g.slice(0,e.limit_questions_to))):g=e.questions},B=()=>{s.data.duration&&(x.value=s.data.duration*60)},ne=()=>{N=setInterval(()=>{x.value--,x.value==0&&(clearInterval(N),Y())},1e3)},oe=e=>{const a=Math.floor(e/3600).toString().padStart(2,"0"),u=Math.floor(e%3600/60).toString().padStart(2,"0"),_=(e%60).toString().padStart(2,"0");return a!="00"?`${a}:${u}:${_}`:`${u}:${_}`},re=ge(()=>x.value/(s.data.duration*60)*100),ie=e=>{for(let a=e.length-1;a>0;a--){const u=Math.floor(Math.random()*(a+1));[e[a],e[u]]=[e[u],e[a]]}return e},v=z({url:"frappe.client.get_list",makeParams(e){var a,u;return{doctype:"LMS Quiz Submission",filters:{member:(a=ae.data)==null?void 0:a.name,quiz:(u=s.data)==null?void 0:u.name},fields:["name","creation","score","score_out_of","percentage","passing_percentage"],order_by:"creation desc"}},transform(e){e.forEach((a,u)=>{a.creation=ye(a.creation),a.idx=u+1})}});O(()=>s.data,()=>{s.data&&Q(),s.data&&s.data.max_attempts&&(v.reload(),F())});const k=z({url:"lms.lms.doctype.lms_quiz.lms_quiz.quiz_summary",makeParams(e){return{quiz:s.data.name,results:localStorage.getItem(s.data.title)}}}),r=z({url:"lms.lms.utils.get_question_details",makeParams(e){return{question:$.value}}});O(p,e=>{e>0&&($.value=s.data.questions[e-1].question,r.reload())}),O(()=>I.quizName,e=>{e&&s.reload()});const le=()=>{p.value=1,localStorage.removeItem(s.data.title),s.data.duration&&ne()},D=e=>{r.data.multiple||h.splice(0,h.length,0,0,0,0),h[e-1]=h[e-1]?0:1},V=()=>{let e=[];return r.data.type=="Choices"?h.forEach((u,_)=>{h[_]&&e.push(r.data[`option_${_+1}`])}):e.push(w.value),e},E=()=>{let e=V();if(!e.length){te.warning(__("Please select an option"));return}z({url:"lms.lms.doctype.lms_quiz.lms_quiz.check_answer",params:{question:$.value,type:r.data.type,answers:JSON.stringify(e)},auto:!0,onSuccess(a){r.data.type=="Choices"?h.forEach((_,y)=>{_?d[y]=_&&a[y]:a[y]==2?d[y]=2:d[y]=void 0}):d.push(a),L(),s.data.show_answers||H()}})},L=()=>{let e=JSON.parse(localStorage.getItem(s.data.title)),a={question_name:$.value,answer:V().join(),is_correct:d.filter(u=>u!=null)};e?e.push(a):e=[a],localStorage.setItem(s.data.title,JSON.stringify(e))},ue=()=>{var e,a;!s.data.show_answers&&((e=r.data)==null?void 0:e.type)!="Open Ended"?E():(((a=r.data)==null?void 0:a.type)=="Open Ended"&&L(),H())},H=()=>{p.value!=s.data.questions.length&&(p.value=p.value+1,h.splice(0,h.length,0,0,0,0),d.length=0,w.value=null)},Y=()=>{if(!s.data.show_answers){r.data.type=="Open Ended"?L():E(),setTimeout(()=>{U()},500);return}U()},U=()=>{k.submit({},{onSuccess(e){ce(),s.data&&s.data.max_attempts&&v.reload(),s.data.duration&&clearInterval(N)},onError(e){var u;if(((e==null?void 0:e.message)||"").includes("MaximumAttemptsExceededError")){const _=((u=e.messages)==null?void 0:u[0])||e;te.error(__(_)),setTimeout(()=>{window.location.reload()},3e3)}}})},F=()=>{p.value=0,h.splice(0,h.length,0,0,0,0),d.length=0,k.reset(),Q(),B()},de=e=>e.type=="Choices"?e.multiple?__("Choose all answers that apply"):__("Choose one answer"):__("Type your answer"),ce=()=>{T.currentRoute.value.name=="Lesson"&&xe("lms.lms.api.mark_lesson_progress",{course:T.currentRoute.value.params.courseName,chapter_number:T.currentRoute.value.params.chapterNumber,lesson_number:T.currentRoute.value.params.lessonNumber})},me=()=>[{label:"No.",key:"idx"},{label:"Date",key:"creation"},{label:"Score",key:"score",align:"center"},{label:"Score out of",key:"score_out_of",align:"center"},{label:"Percentage",key:"percentage",align:"center"}];return(e,a)=>{var u,_,y,J,G,X;return t(s).data?(n(),o("div",ze,[i("div",Ce,[i("div",$e,l(e.__("This quiz consists of {0} questions.").format(t(g).length)),1),(u=t(s).data)!=null&&u.duration?(n(),o("div",Te,l(e.__("Please ensure that you complete all the questions in {0} minutes.").format(t(s).data.duration)),1)):m("",!0),(_=t(s).data)!=null&&_.duration?(n(),o("div",Me,l(e.__("If you fail to do so, the quiz will be automatically submitted when the timer ends.")),1)):m("",!0),t(s).data.passing_percentage?(n(),o("div",Ne,l(e.__("You will have to get {0}% correct answers in order to pass the quiz.").format(t(s).data.passing_percentage)),1)):m("",!0),t(s).data.max_attempts?(n(),o("div",Ie,l(e.__("You can attempt this quiz {0}.").format(t(s).data.max_attempts==1?"1 time":`${t(s).data.max_attempts} times`)),1)):m("",!0)]),t(s).data.duration?(n(),o("div",Qe,[i("div",Ee,[i("span",Le,l(e.__("Time"))+": ",1),i("span",Ae,l(oe(x.value)),1)]),q(Se,{progress:re.value},null,8,["progress"])])):m("",!0),p.value==0?(n(),o("div",Pe,[i("div",Oe,[i("div",Re,l(t(s).data.title),1),!t(s).data.max_attempts||((y=t(v).data)==null?void 0:y.length)<t(s).data.max_attempts?(n(),f(t(C),{key:0,onClick:le,class:"mt-2"},{default:b(()=>[i("span",null,l(e.__("Start")),1)]),_:1})):(n(),o("div",je,l(e.__("You have already exceeded the maximum number of attempts allowed for this quiz.")),1))])])):t(k).data?(n(),o("div",nt,[i("div",ot,l(e.__("Quiz Summary")),1),t(k).data.is_open_ended?(n(),o("div",rt,l(e.__("Your submission has been successfully saved. The instructor will review and grade it shortly, and you'll be notified of your final result.")),1)):(n(),o("div",it,l(e.__("You got {0}% correct answers with a score of {1} out of {2}").format(Math.ceil(t(k).data.percentage),t(k).data.score,t(k).data.score_out_of)),1)),!t(s).data.max_attempts||((J=t(v))==null?void 0:J.data.length)<t(s).data.max_attempts?(n(),f(t(C),{key:2,onClick:a[5]||(a[5]=A=>F()),class:"mt-2"},{default:b(()=>[i("span",null,l(e.__("Try Again")),1)]),_:1})):m("",!0)])):(n(),o("div",Be,[(n(!0),o(R,null,j(t(g),(A,_e)=>(n(),o("div",null,[_e==p.value-1&&t(r).data?(n(),o("div",De,[i("div",Ve,[i("div",He,[i("span",Ye,l(e.__("Question {0}").format(p.value))+": ",1),i("span",null,l(de(t(r).data)),1)]),i("div",Ue,l(A.marks)+" "+l(A.marks==1?e.__("Mark"):e.__("Marks")),1)]),i("div",{class:"text-ink-gray-9 font-semibold mt-2 leading-5",innerHTML:t(r).data.question},null,8,Fe),t(r).data.type=="Choices"?(n(),o(R,{key:0},j(4,c=>i("div",null,[t(r).data[`option_${c}`]?(n(),o("label",Je,[!d.length&&!t(r).data.multiple?(n(),o("input",{key:0,type:"radio",name:encodeURIComponent(t(r).data.question),class:"w-3.5 h-3.5 text-ink-gray-9 focus:ring-outline-gray-modals",onChange:S=>D(c)},null,40,Ge)):!d.length&&t(r).data.multiple?(n(),o("input",{key:1,type:"checkbox",name:encodeURIComponent(t(r).data.question),class:"w-3.5 h-3.5 text-ink-gray-9 rounded-sm focus:ring-outline-gray-modals",onChange:S=>D(c)},null,40,Xe)):t(s).data.show_answers?(n(!0),o(R,{key:2},j(d,(S,pe)=>(n(),o("div",null,[c-1==pe?(n(),o("div",Ke,[S==1?(n(),f(t(K),{key:0,class:"w-4 h-4 text-ink-green-2"})):S==2?(n(),f(t(W),{key:1,class:"w-4 h-4 text-ink-green-2"})):S==0?(n(),f(t(Z),{key:2,class:"w-4 h-4 text-ink-red-3"})):(n(),f(t(W),{key:3,class:"w-4 h-4"}))])):m("",!0)]))),256)):m("",!0),i("span",{class:"ml-2",innerHTML:t(r).data[`option_${c}`]},null,8,We)])):m("",!0),t(r).data[`explanation_${c}`]?ve((n(),o("div",{key:1,class:"mt-2 text-xs"},l(t(r).data[`explanation_${c}`]),513)),[[ke,d.length]]):m("",!0)])),64)):t(r).data.type=="User Input"?(n(),o("div",Ze,[q(t(be),{modelValue:w.value,"onUpdate:modelValue":a[0]||(a[0]=c=>w.value=c),type:"textarea",disabled:!!d.length,class:"my-2"},null,8,["modelValue","disabled"]),d.length?(n(),o("div",et,[d[0]?(n(),f(t(ee),{key:0,label:e.__("Correct"),theme:"green"},{prefix:b(()=>[q(t(K),{class:"w-4 h-4 text-ink-green-2 mr-1"})]),_:1},8,["label"])):(n(),f(t(ee),{key:1,theme:"red",label:e.__("Incorrect")},{prefix:b(()=>[q(t(Z),{class:"w-4 h-4 text-ink-red-3 mr-1"})]),_:1},8,["label"]))])):m("",!0)])):(n(),o("div",tt,[q(t(we),{class:"mt-4",content:w.value,onChange:a[1]||(a[1]=c=>w.value=c),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])])),i("div",st,[i("div",at,l(e.__("Question {0} of {1}").format(p.value,t(g).length)),1),t(s).data.show_answers&&!d.length&&t(r).data.type!="Open Ended"?(n(),f(t(C),{key:0,onClick:a[2]||(a[2]=c=>E())},{default:b(()=>[i("span",null,l(e.__("Check")),1)]),_:1})):p.value!=t(g).length?(n(),f(t(C),{key:1,onClick:a[3]||(a[3]=c=>ue())},{default:b(()=>[i("span",null,l(e.__("Next")),1)]),_:1})):(n(),f(t(C),{key:2,onClick:a[4]||(a[4]=c=>Y())},{default:b(()=>[i("span",null,l(e.__("Submit")),1)]),_:1}))])])):m("",!0)]))),256))])),t(s).data.show_submission_history&&((G=t(v))!=null&&G.data)&&t(v).data.length>0?(n(),o("div",lt,[q(t(qe),{columns:me(),rows:(X=t(v))==null?void 0:X.data,"row-key":"name",options:{selectable:!1,showTooltip:!1,emptyState:{title:e.__("No Quiz submissions found")}}},null,8,["columns","rows","options"])])):m("",!0)])):m("",!0)}}};export{ct as _};
//# sourceMappingURL=Quiz-r3iN0O08.js.map
