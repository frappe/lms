import{J as B,i as x,K as j,L as N,A as V,w as P,j as D,f as d,n as u,g as l,e as _,k,h as n,t as i,l as a,v as A,q as T,F as S,x as U,C as z,a8 as Y,M as L,H as R,r as q,as as F,p as E,_ as M,aU as G,aV as H,aW as J,aX as I,aY as K,aZ as W,a_ as X,aB as Z,a7 as O,G as Q,a$ as ee,N as ae,a as te}from"./index-D24HXhLT.js";const se={class:"flex flex-col gap-4"},le={class:"mb-1.5 text-sm text-ink-gray-5"},oe={class:"mb-1.5 text-sm text-ink-gray-5"},ne={key:0},ie={class:"mb-1.5 text-sm text-ink-gray-5"},re={class:"grid grid-cols-2 gap-2"},ce=["onClick"],de={key:1,class:"text-sm italic text-ink-red-4"},ue={__name:"EvaluationModal",props:B({courses:{type:Array,default:[]},batch:{type:String,default:null},endDate:{type:String,default:null}},{modelValue:{},modelModifiers:{},reloadEvals:{},reloadEvalsModifiers:{}}),emits:["update:modelValue","update:reloadEvals"],setup(f){const y=x("$user"),v=x("$dayjs"),h=j(f,"modelValue"),C=j(f,"reloadEvals"),p=f,t=N({course:"",date:"",start_time:"",end_time:"",day:"",batch:p.batch,member:y.data.name}),m=V({url:"frappe.client.insert",makeParams(e){return{doc:{doctype:"LMS Certificate Request",batch_name:e.batch,...e}}}});function $(e){m.submit(t,{validate(){if(!t.course)return"Please select a course.";if(!t.date)return"Please select a date.";if(!t.start_time)return"Please select a slot.";if(v(t.date).isBefore(v(),"day"))return"Please select a future date.";if(v(t.date).isAfter(v(p.endDate),"day"))return`Please select a date before the end date ${v(p.endDate).format("DD MMMM YYYY")}.`},onSuccess(){C.value.reload(),e()},onError(o){var b;const r=((b=o.messages)==null?void 0:b[0])||o;let s;typeof r=="string"?s=r==null?void 0:r.includes("unavailable"):s=!1,R.warning(__(s||"Evaluator is unavailable"))}})}const w=()=>{const e=[];for(const o of p.courses)o.evaluator&&e.push({label:o.title,value:o.course});return e.length===1&&(t.course=e[0].value),e},g=V({url:"lms.lms.doctype.course_evaluator.course_evaluator.get_schedule",makeParams(e){return{course:e.course,date:e.date,batch:p.batch}}});P(()=>t.date,e=>{t.start_time="",e&&t.course&&g.submit(t)}),P(()=>t.course,e=>{t.date="",t.start_time="",g.reset()});const c=e=>{t.start_time=e.start_time,t.end_time=e.end_time,t.day=e.day};return(e,o)=>(d(),D(a(L),{modelValue:h.value,"onUpdate:modelValue":o[2]||(o[2]=r=>h.value=r),options:{title:e.__("Schedule Evaluation"),size:"xl",actions:[{label:e.__("Submit"),variant:"solid",onClick:r=>$(r)}]}},{"body-content":u(()=>{var r;return[l("div",se,[l("div",null,[l("div",le,i(e.__("Course")),1),n(a(A),{modelValue:t.course,"onUpdate:modelValue":o[0]||(o[0]=s=>t.course=s),options:w()},null,8,["modelValue","options"])]),l("div",null,[l("div",oe,i(e.__("Date")),1),n(a(T),{type:"date",modelValue:t.date,"onUpdate:modelValue":o[1]||(o[1]=s=>t.date=s),min:a(v)().add(a(v).duration({days:1})).format("YYYY-MM-DD")},null,8,["modelValue","min"])]),(r=a(g).data)!=null&&r.length?(d(),_("div",ne,[l("div",ie,i(e.__("Select a slot")),1),l("div",re,[(d(!0),_(S,null,U(a(g).data,s=>(d(),_("div",null,[l("div",{class:z(["text-base text-center border rounded-md text-ink-gray-8 bg-surface-gray-3 p-2 cursor-pointer",{"border-outline-gray-4":t.start_time==s.start_time}]),onClick:b=>c(s)},i(a(Y)(s.start_time))+" - "+i(a(Y)(s.end_time)),11,ce)]))),256))])])):t.course&&t.date?(d(),_("div",de,i(e.__("No slots available for this date.")),1)):k("",!0)])]}),_:1},8,["modelValue","options"]))}},me={class:"flex items-center justify-between mb-4"},_e={class:"text-lg text-ink-gray-9 font-semibold"},fe={key:0},ve={class:"grid grid-cols-3 gap-4"},pe={class:"border text-ink-gray-7 rounded-md p-3"},he={class:"flex justify-between mb-3"},ge={class:"font-semibold text-ink-gray-9 leading-5"},be={class:"flex items-center mb-2"},ye={class:"ml-2"},ke={class:"flex items-center mb-2"},xe={class:"ml-2"},Ce={class:"flex items-center"},$e={class:"ml-2"},we={key:0,class:"flex items-center justify-between space-x-2 mt-4"},Ee={key:1,class:"text-sm italic text-ink-gray-5"},De={__name:"UpcomingEvaluations",props:{batch:{type:String,default:null},courses:{type:Array,default:[]},endDate:{type:String,default:null}},setup(f){const y=x("$dayjs"),v=x("$user"),h=q(!1),C=F(),{$dialog:p}=C.appContext.config.globalProperties,t=f,m=V({url:"lms.lms.utils.get_upcoming_evals",params:{student:v.data.name,courses:t.courses.map(c=>c.course),batch:t.batch},auto:!0});function $(){h.value=!0}const w=c=>{window.open(c.google_meet_link,"_blank")},g=c=>{p({title:__("Cancel this evaluation?"),message:__("Are you sure you want to cancel this evaluation? This action cannot be undone."),actions:[{label:__("Cancel"),theme:"red",variant:"solid",onClick(e){te("lms.lms.api.cancel_evaluation",{evaluation:c}).then(()=>{m.reload()}),e()}}]})};return(c,e)=>{var o,r;return d(),_(S,null,[l("div",null,[l("div",me,[l("div",_e,i(c.__("Upcoming Evaluations")),1),!((o=a(m).data)!=null&&o.length)||a(m).length==f.courses.length?(d(),D(a(M),{key:0,onClick:$},{default:u(()=>[E(i(c.__("Schedule Evaluation")),1)]),_:1})):k("",!0)]),(r=a(m).data)!=null&&r.length?(d(),_("div",fe,[l("div",ve,[(d(!0),_(S,null,U(a(m).data,s=>(d(),_("div",null,[l("div",pe,[l("div",he,[l("span",ge,i(s.course_title),1),s.date>a(y)().format()?(d(),D(a(X),{key:0,as:"div",class:"relative inline-block text-left"},{default:u(()=>[l("div",null,[n(a(G),{class:"inline-flex w-full justify-center"},{default:u(()=>[n(a(H),{class:"w-4 h-4 stroke-1.5"})]),_:1})]),n(J,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:u(()=>[n(a(I),{class:"absolute mt-2 w-32 rounded-md bg-surface-white border p-1.5"},{default:u(()=>[n(a(K),null,{default:u(({active:b})=>[n(a(M),{variant:"ghost",class:"w-full",onClick:Me=>g(s)},{prefix:u(()=>[n(a(W),{active:b,class:"size-4 stroke-1.5","aria-hidden":"true"},null,8,["active"])]),default:u(()=>[E(" "+i(c.__("Cancel")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):k("",!0)]),l("div",be,[n(a(Z),{class:"w-4 h-4 stroke-1.5"}),l("span",ye,i(a(y)(s.date).format("DD MMMM YYYY")),1)]),l("div",ke,[n(a(O),{class:"w-4 h-4 stroke-1.5"}),l("span",xe,i(a(Y)(s.start_time)),1)]),l("div",Ce,[n(a(Q),{class:"w-4 h-4 stroke-1.5"}),l("span",$e,i(s.evaluator_name),1)]),s.google_meet_link?(d(),_("div",we,[n(a(M),{onClick:b=>w(s),class:"w-full"},{prefix:u(()=>[n(a(ee),{class:"w-4 h-4 stroke-1.5"})]),default:u(()=>[E(" "+i(c.__("Join Call")),1)]),_:2},1032,["onClick"])])):k("",!0)])]))),256))])])):(d(),_("div",Ee,i(c.__("Please schedule an evaluation to get certified.")),1))]),n(ue,{batch:f.batch,endDate:f.endDate,courses:f.courses,modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=s=>h.value=s),reloadEvals:a(m),"onUpdate:reloadEvals":e[1]||(e[1]=s=>ae(m)?m.value=s:null)},null,8,["batch","endDate","courses","modelValue","reloadEvals"])],64)}}};export{De as _};
//# sourceMappingURL=UpcomingEvaluations-CmHepdXN.js.map
