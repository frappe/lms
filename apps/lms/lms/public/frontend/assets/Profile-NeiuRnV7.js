import{i as I,d as N,e as v,f as d,g as a,k as S,p as y,t as u,l as s,h as n,n as c,_ as U,J as A,K as q,L as O,A as V,b5 as H,w as M,j as $,b6 as L,b7 as D,b8 as G,b9 as J,q as E,aG as K,M as X,H as Y,r as F,ba as Q,F as z,x as W,bb as Z,bc as ee,bd as se,be as te,s as ae,R as oe,z as le,o as re,aI as ie,bf as ne,b as de,u as ue,C as me,bg as R,N as ce}from"./index-D24HXhLT.js";import{_ as fe}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-DRN2bHzK.js";import{T as pe}from"./TabButtons-C21neZP3.js";import{_ as _e}from"./UserAvatar-CNqvj4u9.js";const be={class:"border rounded-md w-1/3 mx-auto my-32"},ge={class:"border-b px-5 py-3 font-medium"},ve={key:0,class:"px-5 py-3"},he={class:"px-5 py-3"},xe={__name:"NoPermission",setup(P){const k=I("$user"),_=()=>{window.location.href="/login"};return(t,b)=>{const w=N("router-link");return d(),v("div",be,[a("div",ge,[b[1]||(b[1]=a("span",{class:"inline-flex items-center before:bg-surface-red-5 before:w-2 before:h-2 before:rounded-md before:mr-2"},null,-1)),y(" "+u(t.__("Not Permitted")),1)]),s(k).data?(d(),v("div",ve,[a("div",null,u(t.__("You do not have permission to access this page.")),1),n(w,{to:{name:"Courses"}},{default:c(()=>[n(s(U),{variant:"solid",class:"mt-2"},{default:c(()=>[y(u(t.__("Checkout Courses")),1)]),_:1})]),_:1})])):S("",!0),a("div",he,[a("div",null,u(t.__("Please login to access this page.")),1),n(s(U),{onClick:b[0]||(b[0]=g=>_()),class:"mt-4"},{default:c(()=>[y(u(t.__("Login")),1)]),_:1})])])}}},ye={class:"mb-4"},ke={key:1,class:"mb-4"},we={class:"text-xs text-ink-gray-5 mb-1"},$e={class:"flex items-center"},Pe={class:"border rounded-md p-2 mr-2"},Ce={class:"text-base flex flex-col"},Se={class:"text-sm text-ink-gray-4 mt-1"},Ue={class:"mb-4"},Ve={class:"mb-1.5 text-sm text-ink-gray-5"},je={__name:"EditProfile",props:A({profile:{type:Object,required:!0}},{reloadProfile:{},reloadProfileModifiers:{}}),emits:["update:reloadProfile"],setup(P){const k=q(P,"reloadProfile"),_=P,t=O({first_name:"",last_name:"",headline:"",bio:"",image:""}),b=V({url:"lms.lms.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){t.image=e}}),w=V({url:"frappe.client.set_value",makeParams(e){return t.bio=H(t.bio),{doctype:"User",name:_.profile.data.name,fieldname:{user_image:t.image.file_url,...t}}},onSuccess(e){_.profile.data=e}}),g=e=>{w.submit({},{onSuccess(){e(),k.value.reload()},onError(l){var i;Y.error(((i=l.messages)==null?void 0:i[0])||l)}})},f=e=>{let l=e.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png"].includes(l))return"Only image file is allowed."},h=e=>{t.image=e},m=()=>{t.image=null};return M(()=>_.profile.data,e=>{e&&(t.first_name=e.first_name,t.last_name=e.last_name,t.headline=e.headline,t.bio=e.bio,e.user_image&&b.submit({image:e.user_image}))}),(e,l)=>(d(),$(s(X),{options:{title:"Edit your profile",size:"xl",actions:[{label:"Save",variant:"solid",onClick:i=>g(i)}]}},{"body-content":c(()=>[a("div",null,[t.image?(d(),v("div",ke,[a("div",we,u(e.__("Profile Image")),1),a("div",$e,[a("div",Pe,[n(s(D),{class:"h-5 w-5 stroke-1.5 text-ink-gray-7"})]),a("div",Ce,[a("span",null,u(t.image.file_name),1),a("span",Se,u(s(G)(t.image.file_size)),1)]),n(s(J),{onClick:l[1]||(l[1]=i=>m()),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})])])):(d(),$(s(L),{key:0,fileTypes:["image/*"],validateFile:f,onSuccess:l[0]||(l[0]=i=>h(i))},{default:c(({file:i,progress:j,uploading:C,openFileSelector:T})=>[a("div",ye,[n(s(U),{onClick:T,loading:C},{default:c(()=>[y(u(C?`Uploading ${j}%`:"Upload a profile image"),1)]),_:2},1032,["onClick","loading"])])]),_:1})),n(s(E),{modelValue:t.first_name,"onUpdate:modelValue":l[2]||(l[2]=i=>t.first_name=i),label:e.__("First Name"),class:"mb-4"},null,8,["modelValue","label"]),n(s(E),{modelValue:t.last_name,"onUpdate:modelValue":l[3]||(l[3]=i=>t.last_name=i),label:e.__("Last Name"),class:"mb-4"},null,8,["modelValue","label"]),n(s(E),{modelValue:t.headline,"onUpdate:modelValue":l[4]||(l[4]=i=>t.headline=i),label:e.__("Headline"),class:"mb-4"},null,8,["modelValue","label"]),a("div",Ue,[a("div",Ve,u(e.__("Bio")),1),n(s(K),{fixedMenu:!0,onChange:l[5]||(l[5]=i=>t.bio=i),content:t.bio,editorClass:"prose-sm py-2 px-2 min-h-[200px] border-outline-gray-2 hover:border-outline-gray-3 rounded-md bg-surface-gray-3"},null,8,["content"])])])]),_:1},8,["options"]))}},Te={class:"absolute left-1/2 mt-3 w-96 max-w-lg -translate-x-1/2 transform rounded-lg bg-surface-white px-4 sm:px-0 lg:max-w-3xl"},Ee={class:"overflow-hidden rounded-lg p-3 shadow-2xl ring-1 ring-black ring-opacity-5"},Fe={class:"flex items-center justify-center space-x-2"},Me={class:""},Re={class:"relative mt-2 grid w-[25.5rem] gap-2 bg-surface-white lg:grid-cols-2"},Ie=["onClick"],Ne=["src"],Le={key:0,class:"mt-2 text-center text-sm text-ink-gray-4"},ze={class:"underline",target:"_blank",href:"https://unsplash.com"},Be={__name:"EditCoverImage",emits:["select"],setup(P,{emit:k}){const _=F(null),t=k,b=V({url:"lms.lms.api.get_unsplash_photos",makeParams:()=>({keyword:_.value}),auto:!0,debounce:500});M(()=>_.value,()=>{b.reload()});const w=f=>{t("select",f.file_url)},g=f=>{let h=f.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png"].includes(h))return"Only image file is allowed."};return(f,h)=>(d(),$(s(te),{transition:"default"},{target:c(({isOpen:m,togglePopover:e})=>[Z(f.$slots,"default",ee(se({isOpen:m,togglePopover:e})))]),body:c(()=>[a("div",Te,[a("div",Ee,[a("div",Fe,[n(s(Q),{type:"text",placeholder:"search by keyword",modelValue:_.value,"onUpdate:modelValue":h[0]||(h[0]=m=>_.value=m),debounce:300,class:"flex-1"},null,8,["modelValue"]),n(s(L),{fileTypes:["image/*"],validateFile:g,onSuccess:h[1]||(h[1]=m=>w(m))},{default:c(({file:m,progress:e,uploading:l,openFileSelector:i})=>[a("div",Me,[n(s(U),{onClick:i,loading:l},{default:c(()=>[y(u(l?`Uploading ${e}%`:"Upload Image"),1)]),_:2},1032,["onClick","loading"])])]),_:1})]),a("div",Re,[(d(!0),v(z,null,W(s(b).data,m=>(d(),v("button",{key:m.id,class:"h-[50px] w-[200px] overflow-hidden rounded hover:opacity-80",onClick:e=>f.$emit("select",m.urls.raw)},[a("img",{src:m.urls.raw+"&w=200&h=50&fit=crop&crop=entropy,faces,focalpoint"},null,8,Ne)],8,Ie))),128))]),s(b).data?(d(),v("div",Le,[y(u(f.__("Image search powered by"))+" ",1),a("a",ze,u(f.__("Unsplash")),1)])):S("",!0)])])]),_:3}))}},Ae={key:1},qe={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Oe={class:"group relative h-[130px] w-full"},He=["src"],De={key:2,class:"absolute bottom-0 left-1/2 mb-4 flex -translate-x-1/2 space-x-2 opacity-0 transition-opacity focus-within:opacity-100 group-hover:opacity-100"},Ge={class:"mx-auto -mt-10 md:-mt-4 max-w-4xl translate-x-0 px-5"},Je={class:"flex flex-col md:flex-row items-center"},Ke=["src"],Xe={class:"ml-6"},Ye={class:"mt-2 text-3xl font-semibold text-ink-gray-9"},Qe={class:"mt-2 text-base text-ink-gray-7"},We={class:"mb-4 mt-6"},os={__name:"Profile",props:{username:{type:String,required:!0}},setup(P){const{user:k,brand:_}=ae(),t=I("$user"),b=oe(),w=le(),g=F(""),f=F(!1),h=window.read_only_mode,m=P;re(()=>{t.data&&e.reload(),i()});const e=V({url:"frappe.client.get",makeParams(r){return{doctype:"User",filters:{username:m.username}}}}),l=V({url:"frappe.client.set_value",makeParams(r){var o;return{doctype:"User",name:(o=e.data)==null?void 0:o.name,fieldname:"cover_image",value:r.url}},onSuccess(){e.reload()}}),i=()=>{let r=b.path.split("/");["certificates","roles","slots","schedule"].forEach(x=>{r.includes(x)&&(g.value=ie(x))}),g.value||(g.value="About")};ne(()=>{if(g.value){let r={About:{name:"ProfileAbout"},Certificates:{name:"ProfileCertificates"},Roles:{name:"ProfileRoles"},Slots:{name:"ProfileEvaluator"},Schedule:{name:"ProfileEvaluationSchedule"}}[g.value];w.push(r)}}),M(()=>m.username,()=>{e.reload()});const j=()=>{f.value=!0},C=()=>{var r,o;return((r=t.data)==null?void 0:r.email)===((o=e.data)==null?void 0:o.email)},T=()=>{var o,x,p;let r=[{label:"About"},{label:"Certificates"}];return(o=t.data)!=null&&o.is_moderator&&r.push({label:"Roles"}),C()&&((x=t.data)!=null&&x.is_evaluator||(p=t.data)!=null&&p.is_moderator)&&(r.push({label:"Slots"}),r.push({label:"Schedule"})),r},B=de(()=>{var o,x;return[{label:"People"},{label:(o=e.data)==null?void 0:o.full_name,route:{name:"Profile",params:{username:(x=k.doc)==null?void 0:x.username}}}]});return ue(()=>{var r;return{title:(r=e.data)==null?void 0:r.full_name,icon:_.favicon}}),(r,o)=>{const x=N("router-view");return d(),v(z,null,[s(t).data?s(e).data?(d(),v("div",Ae,[a("header",qe,[n(s(fe),{class:"h-7",items:B.value},null,8,["items"])]),a("div",Oe,[s(e).data.cover_image?(d(),v("img",{key:0,src:s(e).data.cover_image,class:"h-[130px] w-full object-cover object-center"},null,8,He)):(d(),v("div",{key:1,class:me([{"bg-surface-gray-2":!s(e).data.cover_image},"h-[130px] w-full"])},null,2)),C()?(d(),v("div",De,[n(Be,{onSelect:o[0]||(o[0]=p=>s(l).submit({url:p}))},{default:c(({togglePopover:p})=>[s(h)?S("",!0):(d(),$(s(U),{key:0,variant:"outline",onClick:Ze=>p()},{prefix:c(()=>[n(s(R),{class:"w-4 h-4 stroke-1.5 text-ink-gray-7"})]),default:c(()=>[y(" "+u(r.__("Edit")),1)]),_:2},1032,["onClick"]))]),_:1})])):S("",!0)]),a("div",Ge,[a("div",Je,[a("div",null,[s(e).data.user_image?(d(),v("img",{key:0,src:s(e).data.user_image,class:"object-cover h-[100px] w-[100px] rounded-full border-4 border-white object-cover"},null,8,Ke)):(d(),$(_e,{key:1,user:s(e).data,class:"object-cover h-[100px] w-[100px] rounded-full border-4 border-white object-cover"},null,8,["user"]))]),a("div",Xe,[a("h2",Ye,u(s(e).data.full_name),1),a("div",Qe,u(s(e).data.headline),1)]),C()&&!s(h)?(d(),$(s(U),{key:0,class:"mt-3 sm:mt-0 md:ml-auto",onClick:o[1]||(o[1]=p=>j())},{prefix:c(()=>[n(s(R),{class:"w-4 h-4 stroke-1.5 text-ink-gray-7"})]),default:c(()=>[y(" "+u(r.__("Edit Profile")),1)]),_:1})):S("",!0)]),a("div",We,[n(s(pe),{class:"inline-block",buttons:T(),modelValue:g.value,"onUpdate:modelValue":o[2]||(o[2]=p=>g.value=p)},null,8,["buttons","modelValue"])]),n(x,{profile:s(e)},null,8,["profile"])])])):S("",!0):(d(),$(xe,{key:0})),n(je,{modelValue:f.value,"onUpdate:modelValue":o[3]||(o[3]=p=>f.value=p),reloadProfile:s(e),"onUpdate:reloadProfile":o[4]||(o[4]=p=>ce(e)?e.value=p:null),profile:s(e)},null,8,["modelValue","reloadProfile","profile"])],64)}}};export{os as default};
//# sourceMappingURL=Profile-NeiuRnV7.js.map
