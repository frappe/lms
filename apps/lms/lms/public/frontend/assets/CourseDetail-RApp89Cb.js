import{z as F,i as T,b as L,A as R,d as I,e as u,f as o,k as m,g as a,t as l,l as e,j as b,h as i,n as f,_ as x,p as C,B as A,C as B,D as H,U as D,E as W,S as E,G as O,H as U,I as Y,J,K as z,L as K,q as Q,M as X,r as Z,F as N,x as S,N as P,s as ee,u as te,O as j}from"./index-D24HXhLT.js";import{_ as se}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-DRN2bHzK.js";import{_ as ae}from"./CertificationLinks-BzrfvskL.js";import{_ as re}from"./CourseOutline-BvUv8tpK.js";import{_ as G}from"./UserAvatar-CNqvj4u9.js";import{_ as oe}from"./Rating.vue_vue_type_script_setup_true_lang-CVJvQkqE.js";import{_ as ne}from"./CourseInstructors-AYbj4319.js";import"./vuedraggable.umd-D_03Sejs.js";const le={class:"border-2 rounded-md min-w-80"},ie=["src"],ue={class:"p-5"},de={key:0,class:"text-2xl font-semibold mb-3"},ce={key:1},me={key:0,class:"space-y-2"},_e={class:"space-y-4"},fe={class:"flex items-center text-ink-gray-9"},pe={class:"ml-2"},ve={class:"flex items-center text-ink-gray-9"},he={class:"ml-2"},ge={key:0,class:"flex items-center text-ink-gray-9"},we={class:"ml-2"},ye={key:1,class:"flex items-center font-semibold text-ink-gray-9"},be={class:"ml-2"},ke={key:2,class:"flex items-center font-semibold text-ink-gray-9"},$e={class:"ml-2"},q={__name:"CourseCardOverlay",props:{course:{type:Object,default:null}},setup(r){const $=F(),_=T("$user"),t=window.read_only_mode,n=r,c=L(()=>n.course.data.video_link?"https://www.youtube.com/embed/"+n.course.data.video_link:null);function k(){_.data?R({url:"lms.lms.doctype.lms_enrollment.lms_enrollment.create_membership"}).submit({course:n.course.data.name}).then(()=>{Y("enrolled_in_course",{course:n.course.data.name}),U.success(__("You have been enrolled in this course")),setTimeout(()=>{$.push({name:"Lesson",params:{courseName:n.course.data.name,chapterNumber:1,lessonNumber:1}})},2e3)}):(U.success(__("You need to login first to enroll for this course")),setTimeout(()=>{window.location.href=`/login?redirect-to=${window.location.pathname}`},1e3))}const g=()=>{let s=!1;return n.course.data.instructors.forEach(v=>{var y;!s&&v.name==((y=_.data)==null?void 0:y.name)&&(s=!0)}),s},w=L(()=>{var s,v,y;return!!((s=n.course.data)!=null&&s.enable_certification&&((y=(v=n.course.data)==null?void 0:v.membership)==null?void 0:y.progress)==100)}),h=R({url:"lms.lms.doctype.lms_certificate.lms_certificate.create_certificate",makeParams(s){return{course:s.course}},onSuccess(s){window.open(`/api/method/frappe.utils.print_format.download_pdf?doctype=LMS+Certificate&name=${s.name}&format=${encodeURIComponent(s.template)}`,"_blank")}}),p=()=>{var s,v;h.submit({course:(s=n.course.data)==null?void 0:s.name,member:(v=_.data)==null?void 0:v.name})};return(s,v)=>{var d,V;const y=I("router-link");return o(),u("div",le,[r.course.data.video_link?(o(),u("iframe",{key:0,src:c.value,class:"rounded-t-md min-h-56 w-full"},null,8,ie)):m("",!0),a("div",ue,[r.course.data.paid_course?(o(),u("div",de,l(r.course.data.price),1)):m("",!0),e(t)?m("",!0):(o(),u("div",ce,[r.course.data.membership?(o(),u("div",me,[i(y,{to:{name:"Lesson",params:{courseName:r.course.name,chapterNumber:r.course.data.current_lesson?r.course.data.current_lesson.split("-")[0]:1,lessonNumber:r.course.data.current_lesson?r.course.data.current_lesson.split("-")[1]:1}}},{default:f(()=>[i(e(x),{variant:"solid",size:"md",class:"w-full"},{default:f(()=>[a("span",null,l(s.__("Continue Learning")),1)]),_:1})]),_:1},8,["to"]),i(ae,{courseName:r.course.data.name,class:"w-full"},null,8,["courseName"])])):r.course.data.paid_course?(o(),b(y,{key:1,to:{name:"Billing",params:{type:"course",name:r.course.data.name}}},{default:f(()=>[i(e(x),{variant:"solid",size:"md",class:"w-full"},{default:f(()=>[a("span",null,l(s.__("Buy this course")),1)]),_:1})]),_:1},8,["to"])):r.course.data.disable_self_learning?(o(),b(e(A),{key:2,theme:"blue",size:"lg"},{default:f(()=>[C(l(s.__("Contact the Administrator to enroll for this course.")),1)]),_:1})):(o(),b(e(x),{key:3,onClick:v[0]||(v[0]=M=>k()),variant:"solid",class:"w-full",size:"md"},{default:f(()=>[a("span",null,l(s.__("Start Learning")),1)]),_:1})),w.value?(o(),b(e(x),{key:4,onClick:v[1]||(v[1]=M=>p()),variant:"subtle",class:"w-full mt-2",size:"md"},{default:f(()=>[C(l(s.__("Get Certificate")),1)]),_:1})):m("",!0),(V=(d=e(_))==null?void 0:d.data)!=null&&V.is_moderator||g()?(o(),b(y,{key:5,to:{name:"CourseForm",params:{courseName:r.course.data.name}}},{default:f(()=>[i(e(x),{variant:"subtle",class:"w-full mt-2",size:"md"},{default:f(()=>[a("span",null,l(s.__("Edit")),1)]),_:1})]),_:1},8,["to"])):m("",!0)])),a("div",_e,[a("div",{class:B(["font-medium text-ink-gray-9",{"mt-8":!e(t)}])},l(s.__("This course has:")),3),a("div",fe,[i(e(H),{class:"h-4 w-4 stroke-1.5"}),a("span",pe,l(r.course.data.lessons)+" "+l(s.__("Lessons")),1)]),a("div",ve,[i(e(D),{class:"h-4 w-4 stroke-1.5"}),a("span",he,l(e(W)(r.course.data.enrollments))+" "+l(s.__("Enrolled Students")),1)]),parseInt(r.course.data.rating)>0?(o(),u("div",ge,[i(e(E),{class:"size-4 stroke-1.5 fill-yellow-500 text-transparent"}),a("span",we,l(r.course.data.rating)+" "+l(s.__("Rating")),1)])):m("",!0),r.course.data.enable_certification?(o(),u("div",ye,[i(e(O),{class:"h-4 w-4 stroke-2"}),a("span",be,l(s.__("Certificate of Completion")),1)])):m("",!0),r.course.data.paid_certificate?(o(),u("div",ke,[i(e(O),{class:"h-4 w-4 stroke-2"}),a("span",$e,l(s.__("Paid Certificate after Evaluation")),1)])):m("",!0)])])])}}},xe={class:"flex flex-col gap-4"},Re={__name:"ReviewModal",props:J({courseName:{type:String,required:!0}},{modelValue:{},modelModifiers:{},reloadReviews:{},reloadReviewsModifiers:{},hasReviewed:{},hasReviewedModifiers:{}}),emits:["update:modelValue","update:reloadReviews","update:hasReviewed"],setup(r){const $=z(r,"modelValue"),_=z(r,"reloadReviews"),t=z(r,"hasReviewed");let n=K({review:"",rating:0});const c=r,k=R({url:"frappe.client.insert",makeParams(w){return{doc:{doctype:"LMS Course Review",course:c.courseName,...w}}}});function g(w){n.rating=n.rating/5,k.submit(n,{validate(){if(!n.rating)return"Please enter a rating."},onSuccess(){_.value.reload(),t.value.reload()},onError(h){var p;U.error(((p=h.messages)==null?void 0:p[0])||h)}}),w()}return(w,h)=>(o(),b(e(X),{modelValue:$.value,"onUpdate:modelValue":h[2]||(h[2]=p=>$.value=p),options:{title:w.__("Write a Review"),size:"xl",actions:[{label:"Submit",variant:"solid",onClick:p=>g(p)}]}},{"body-content":f(()=>[a("div",xe,[i(e(oe),{modelValue:e(n).rating,"onUpdate:modelValue":h[0]||(h[0]=p=>e(n).rating=p),label:w.__("Rating")},null,8,["modelValue","label"]),i(e(Q),{label:w.__("Review"),type:"textarea",modelValue:e(n).review,"onUpdate:modelValue":h[1]||(h[1]=p=>e(n).review=p),rows:5},null,8,["label","modelValue"])])]),_:1},8,["modelValue","options"]))}},Ne={key:0,class:"mt-20 mb-10"},Ce={class:"flex items-center font-semibold text-2xl text-ink-gray-9"},Se={class:"grid gap-8 mt-10"},Ve={class:"flex items-center"},Me={class:"mx-4"},ze={class:"text-lg font-medium mr-4 text-ink-gray-7"},Le={class:"text-ink-gray-7"},Ue={class:"flex mt-2 space-x-1"},Be={key:0,class:"mt-4 leading-5 text-ink-gray-7"},Ee={__name:"CourseReviews",props:{courseName:{type:String,required:!0},avg_rating:{type:String,required:!0},membership:{type:Object,required:!1}},setup(r){var g,w,h;const $=T("$user"),_=r,t=R({url:"frappe.client.get_count",cache:["eligible_to_review",_.courseName,(g=_.membership)==null?void 0:g.member],params:{doctype:"LMS Course Review",filters:{course:_.courseName,owner:(w=_.membership)==null?void 0:w.member}},auto:!!((h=$.data)!=null&&h.name)}),n=R({url:"lms.lms.utils.get_reviews",cache:["course_reviews",_.courseName],params:{course:_.courseName},auto:!0}),c=Z(!1);function k(){c.value=!0}return(p,s)=>{var y;const v=I("router-link");return o(),u(N,null,[(y=e(n).data)!=null&&y.length||r.membership?(o(),u("div",Ne,[r.membership&&!e(t).data?(o(),b(e(x),{key:0,onClick:s[0]||(s[0]=d=>k()),class:"float-right"},{default:f(()=>[C(l(p.__("Write a Review")),1)]),_:1})):m("",!0),a("div",Ce,l(p.__("Student Reviews")),1),a("div",Se,[(o(!0),u(N,null,S(e(n).data,(d,V)=>(o(),u("div",null,[a("div",Ve,[i(v,{to:{name:"Profile",params:{username:d.owner_details.username}}},{default:f(()=>[i(G,{user:d.owner_details,size:"2xl"},null,8,["user"])]),_:2},1032,["to"]),a("div",Me,[i(v,{to:{name:"Profile",params:{username:d.owner_details.username}}},{default:f(()=>[a("span",ze,l(d.owner_details.full_name),1)]),_:2},1032,["to"]),a("span",Le,l(d.creation),1),a("div",Ue,[(o(),u(N,null,S(5,M=>i(e(E),{class:B(["size-4 text-transparent rounded-sm",M<=Math.ceil(d.rating)?"fill-yellow-500":"fill-gray-300"])},null,8,["class"])),64))])])]),d.review?(o(),u("div",Be,l(d.review),1)):m("",!0)]))),256))])])):m("",!0),i(Re,{modelValue:c.value,"onUpdate:modelValue":s[1]||(s[1]=d=>c.value=d),reloadReviews:e(n),"onUpdate:reloadReviews":s[2]||(s[2]=d=>P(n)?n.value=d:null),hasReviewed:e(t),"onUpdate:hasReviewed":s[3]||(s[3]=d=>P(t)?t.value=d:null),courseName:r.courseName},null,8,["modelValue","reloadReviews","hasReviewed","courseName"])],64)}}},Oe={key:0},Pe={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},je={class:"m-5"},qe={class:"flex justify-between w-full"},Te={class:"md:w-2/3"},Ie={class:"text-3xl font-semibold text-ink-gray-9"},Ae={class:"my-3 leading-6 text-ink-gray-7"},De={class:"flex items-center"},Ge={class:"ml-1 text-ink-gray-7"},Fe={key:1,class:"mx-3"},He={class:"ml-1"},We={key:3,class:"mx-3"},Ye={class:"flex items-center"},Je={key:0,class:"flex my-4 w-fit"},Ke=["innerHTML"],Qe={class:"mt-10"},Xe={class:"hidden md:block"},lt={__name:"CourseDetail",props:{courseName:{type:String,required:!0}},setup(r){const{brand:$}=ee(),_=r,t=R({url:"lms.lms.utils.get_course_details",cache:["course",_.courseName],params:{course:_.courseName},auto:!0}),n=L(()=>{var k,g;let c=[{label:"Courses",route:{name:"Courses"}}];return c.push({label:(k=t==null?void 0:t.data)==null?void 0:k.title,route:{name:"CourseDetail",params:{courseName:(g=t==null?void 0:t.data)==null?void 0:g.name}}}),c});return te(()=>{var c;return{title:(c=t==null?void 0:t.data)==null?void 0:c.title,icon:$.favicon}}),(c,k)=>e(t).data?(o(),u("div",Oe,[a("header",Pe,[i(e(se),{class:"h-7",items:n.value},null,8,["items"])]),a("div",je,[a("div",qe,[a("div",Te,[a("div",Ie,l(e(t).data.title),1),a("div",Ae,l(e(t).data.short_introduction),1),a("div",De,[parseInt(e(t).data.rating)>0?(o(),b(e(j),{key:0,text:c.__("Average Rating"),class:"flex items-center"},{default:f(()=>[i(e(E),{class:"size-4 text-transparent fill-yellow-500"}),a("span",Ge,l(e(t).data.rating),1)]),_:1},8,["text"])):m("",!0),parseInt(e(t).data.rating)>0?(o(),u("span",Fe,"·")):m("",!0),e(t).data.enrollment_count?(o(),b(e(j),{key:2,text:c.__("Enrolled Students"),class:"flex items-center"},{default:f(()=>[i(e(D),{class:"h-4 w-4 text-ink-gray-7"}),a("span",He,l(e(t).data.enrollment_count_formatted),1)]),_:1},8,["text"])):m("",!0),e(t).data.enrollment_count?(o(),u("span",We,"·")):m("",!0),a("div",Ye,[a("span",{class:B(["h-6 mr-1",{"avatar-group overlap":e(t).data.instructors.length>1}])},[(o(!0),u(N,null,S(e(t).data.instructors,g=>(o(),b(G,{user:g},null,8,["user"]))),256))],2),i(ne,{instructors:e(t).data.instructors},null,8,["instructors"])])]),e(t).data.tags?(o(),u("div",Je,[(o(!0),u(N,null,S(e(t).data.tags.split(", "),g=>(o(),b(e(A),{theme:"gray",size:"lg",class:"mr-2 text-ink-gray-9"},{default:f(()=>[C(l(g),1)]),_:2},1024))),256))])):m("",!0),i(q,{course:e(t),class:"md:hidden mb-4"},null,8,["course"]),a("div",{innerHTML:e(t).data.description,class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal mt-10"},null,8,Ke),a("div",Qe,[i(re,{title:c.__("Course Outline"),courseName:e(t).data.name,showOutline:!0},null,8,["title","courseName"])]),i(Ee,{courseName:e(t).data.name,avg_rating:e(t).data.rating,membership:e(t).data.membership},null,8,["courseName","avg_rating","membership"])]),a("div",Xe,[i(q,{course:e(t)},null,8,["course"])])])])])):m("",!0)}};export{lt as default};
//# sourceMappingURL=CourseDetail-RApp89Cb.js.map
