{"version":3,"file":"Courses-DoU-khhO.js","sources":["../../../../frontend/src/pages/Courses.vue"],"sourcesContent":["<template>\n\t<header\n\t\tclass=\"sticky flex items-center justify-between top-0 z-10 border-b bg-surface-white px-3 py-2.5 sm:px-5\"\n\t>\n\t\t<Breadcrumbs :items=\"breadcrumbs\" />\n\t\t<router-link\n\t\t\tv-if=\"canCreateCourse()\"\n\t\t\t:to=\"{\n\t\t\t\tname: 'CourseForm',\n\t\t\t\tparams: { courseName: 'new' },\n\t\t\t}\"\n\t\t>\n\t\t\t<Button variant=\"solid\">\n\t\t\t\t<template #prefix>\n\t\t\t\t\t<Plus class=\"h-4 w-4 stroke-1.5\" />\n\t\t\t\t</template>\n\t\t\t\t{{ __('New') }}\n\t\t\t</Button>\n\t\t</router-link>\n\t</header>\n\t<div class=\"p-5 pb-10\">\n\t\t<div\n\t\t\tclass=\"flex flex-col lg:flex-row space-y-4 lg:space-y-0 lg:items-center justify-between mb-5\"\n\t\t>\n\t\t\t<div class=\"text-lg text-ink-gray-9 font-semibold\">\n\t\t\t\t{{ __('All Courses') }}\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass=\"flex flex-col space-y-2 lg:space-y-0 lg:flex-row lg:items-center lg:space-x-4\"\n\t\t\t>\n\t\t\t\t<TabButtons :buttons=\"courseTabs\" v-model=\"currentTab\" />\n\t\t\t\t<FormControl\n\t\t\t\t\tv-model=\"certification\"\n\t\t\t\t\t:label=\"__('Certification')\"\n\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t@change=\"updateCourses()\"\n\t\t\t\t/>\n\t\t\t\t<div class=\"grid grid-cols-2 gap-2\">\n\t\t\t\t\t<FormControl\n\t\t\t\t\t\tv-model=\"title\"\n\t\t\t\t\t\t:placeholder=\"__('Search by Title')\"\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tclass=\"min-w-40 lg:min-w-0 lg:w-32 xl:w-40\"\n\t\t\t\t\t\t@input=\"updateCourses()\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div class=\"min-w-40 lg:min-w-0 lg:w-32 xl:w-40\">\n\t\t\t\t\t\t<Select\n\t\t\t\t\t\t\tv-if=\"categories.length\"\n\t\t\t\t\t\t\tv-model=\"currentCategory\"\n\t\t\t\t\t\t\t:options=\"categories\"\n\t\t\t\t\t\t\t:placeholder=\"__('Category')\"\n\t\t\t\t\t\t\t@change=\"updateCourses()\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div\n\t\t\tv-if=\"courses.data?.length\"\n\t\t\tclass=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-4\"\n\t\t>\n\t\t\t<router-link\n\t\t\t\tv-for=\"course in courses.data\"\n\t\t\t\t:to=\"{ name: 'CourseDetail', params: { courseName: course.name } }\"\n\t\t\t>\n\t\t\t\t<CourseCard :course=\"course\" />\n\t\t\t</router-link>\n\t\t</div>\n\t\t<EmptyState v-else-if=\"!courses.list.loading\" type=\"Courses\" />\n\t\t<div\n\t\t\tv-if=\"!courses.list.loading && courses.hasNextPage\"\n\t\t\tclass=\"flex justify-center mt-5\"\n\t\t>\n\t\t\t<Button @click=\"courses.next()\">\n\t\t\t\t{{ __('Load More') }}\n\t\t\t</Button>\n\t\t</div>\n\t</div>\n</template>\n<script setup>\nimport {\n\tBreadcrumbs,\n\tButton,\n\tcall,\n\tcreateListResource,\n\tFormControl,\n\tSelect,\n\tTabButtons,\n\tusePageMeta,\n} from 'frappe-ui'\nimport { computed, inject, onMounted, ref, watch } from 'vue'\nimport { Plus } from 'lucide-vue-next'\nimport { sessionStore } from '@/stores/session'\nimport { canCreateCourse } from '@/utils'\nimport CourseCard from '@/components/CourseCard.vue'\nimport EmptyState from '@/components/EmptyState.vue'\nimport router from '../router'\n\nconst user = inject('$user')\nconst dayjs = inject('$dayjs')\nconst start = ref(0)\nconst pageLength = ref(30)\nconst categories = ref([])\nconst currentCategory = ref(null)\nconst title = ref('')\nconst certification = ref(false)\nconst filters = ref({})\nconst currentTab = ref('Live')\nconst { brand } = sessionStore()\nconst courseCount = ref(0)\n\nonMounted(() => {\n\tsetFiltersFromQuery()\n\tupdateCourses()\n\tgetCourseCount()\n\tcategories.value = [\n\t\t{\n\t\t\tlabel: '',\n\t\t\tvalue: null,\n\t\t},\n\t]\n})\n\nconst setFiltersFromQuery = () => {\n\tlet queries = new URLSearchParams(location.search)\n\ttitle.value = queries.get('title') || ''\n\tcurrentCategory.value = queries.get('category') || null\n\tcertification.value = queries.get('certification') || false\n}\n\nconst courses = createListResource({\n\tdoctype: 'LMS Course',\n\turl: 'lms.lms.utils.get_courses',\n\tcache: ['courses', user.data?.name],\n\tpageLength: pageLength.value,\n\tstart: start.value,\n\tonSuccess(data) {\n\t\tsetCategories(data)\n\t},\n})\n\nconst setCategories = (data) => {\n\tlet allCategories = data.map((course) => course.category)\n\tallCategories = allCategories.filter(\n\t\t(category, index) => allCategories.indexOf(category) === index && category\n\t)\n\tif (categories.value.length <= allCategories.length) {\n\t\tupdateCategories(data)\n\t}\n}\n\nconst isPersonaCaptured = async () => {\n\tlet persona = await call('frappe.client.get_single_value', {\n\t\tdoctype: 'LMS Settings',\n\t\tfield: 'persona_captured',\n\t})\n\treturn persona\n}\n\nconst identifyUserPersona = async () => {\n\tif (user.data?.is_system_manager && !user.data?.developer_mode) {\n\t\tlet personaCaptured = await isPersonaCaptured()\n\t\tif (personaCaptured) return\n\t\tif (!courseCount.value) {\n\t\t\trouter.push({\n\t\t\t\tname: 'PersonaForm',\n\t\t\t})\n\t\t}\n\t}\n}\n\nconst getCourseCount = () => {\n\tif (!user.data) return\n\n\tcall('frappe.client.get_count', {\n\t\tdoctype: 'LMS Course',\n\t}).then((data) => {\n\t\tcourseCount.value = data\n\t\tidentifyUserPersona()\n\t})\n}\n\nconst updateCourses = () => {\n\tupdateFilters()\n\tcourses.update({\n\t\tfilters: filters.value,\n\t})\n\tcourses.reload()\n}\n\nconst updateFilters = () => {\n\tupdateCategoryFilter()\n\tupdateTitleFilter()\n\tupdateCertificationFilter()\n\tupdateTabFilter()\n\tupdateStudentFilter()\n\tsetQueryParams()\n}\n\nconst updateCategoryFilter = () => {\n\tif (currentCategory.value) {\n\t\tfilters.value['category'] = currentCategory.value\n\t} else {\n\t\tdelete filters.value['category']\n\t}\n}\n\nconst updateTitleFilter = () => {\n\tif (title.value) {\n\t\tfilters.value['title'] = ['like', `%${title.value}%`]\n\t} else {\n\t\tdelete filters.value['title']\n\t}\n}\n\nconst updateCertificationFilter = () => {\n\tif (certification.value) {\n\t\tfilters.value['certification'] = 1\n\t} else {\n\t\tdelete filters.value['certification']\n\t}\n}\n\nconst updateTabFilter = () => {\n\tdelete filters.value['live']\n\tdelete filters.value['created']\n\tdelete filters.value['published_on']\n\tdelete filters.value['upcoming']\n\n\tif (currentTab.value == 'Enrolled' && user.data?.is_student) {\n\t\tfilters.value['enrolled'] = 1\n\t\tdelete filters.value['published']\n\t} else {\n\t\tdelete filters.value['published']\n\t\tdelete filters.value['enrolled']\n\n\t\tif (currentTab.value == 'Live') {\n\t\t\tfilters.value['published'] = 1\n\t\t\tfilters.value['upcoming'] = 0\n\t\t\tfilters.value['live'] = 1\n\t\t} else if (currentTab.value == 'Upcoming') {\n\t\t\tfilters.value['upcoming'] = 1\n\t\t\tfilters.value['published'] = 1\n\t\t} else if (currentTab.value == 'New') {\n\t\t\tfilters.value['published'] = 1\n\t\t\tfilters.value['published_on'] = [\n\t\t\t\t'>=',\n\t\t\t\tdayjs().add(-3, 'month').format('YYYY-MM-DD'),\n\t\t\t]\n\t\t} else if (currentTab.value == 'Created') {\n\t\t\tfilters.value['created'] = 1\n\t\t}\n\t}\n}\n\nconst updateStudentFilter = () => {\n\tif (!user.data || (user.data?.is_student && currentTab.value != 'Enrolled')) {\n\t\tfilters.value['published'] = 1\n\t}\n}\n\nconst setQueryParams = () => {\n\tlet queries = new URLSearchParams(location.search)\n\tlet filterKeys = {\n\t\ttitle: title.value,\n\t\tcategory: currentCategory.value,\n\t\tcertification: certification.value,\n\t}\n\n\tObject.keys(filterKeys).forEach((key) => {\n\t\tif (filterKeys[key]) {\n\t\t\tqueries.set(key, filterKeys[key])\n\t\t} else {\n\t\t\tqueries.delete(key)\n\t\t}\n\t})\n\n\tlet queryString = ''\n\tif (queries.toString()) {\n\t\tqueryString = `?${queries.toString()}`\n\t}\n\n\thistory.replaceState({}, '', `${location.pathname}${queryString}`)\n}\n\nconst updateCategories = (data) => {\n\tdata.forEach((course) => {\n\t\tif (\n\t\t\tcourse.category &&\n\t\t\t!categories.value.find((category) => category.value === course.category)\n\t\t)\n\t\t\tcategories.value.push({\n\t\t\t\tlabel: course.category,\n\t\t\t\tvalue: course.category,\n\t\t\t})\n\t})\n}\n\nwatch(currentTab, () => {\n\tupdateCourses()\n})\n\nconst courseTabs = computed(() => {\n\tlet tabs = [\n\t\t{\n\t\t\tlabel: __('Live'),\n\t\t},\n\t\t{\n\t\t\tlabel: __('New'),\n\t\t},\n\t\t{\n\t\t\tlabel: __('Upcoming'),\n\t\t},\n\t]\n\tif (\n\t\tuser.data?.is_moderator ||\n\t\tuser.data?.is_instructor ||\n\t\tuser.data?.is_evaluator\n\t) {\n\t\ttabs.push({ label: __('Created') })\n\t} else if (user.data) {\n\t\ttabs.push({ label: __('Enrolled') })\n\t}\n\treturn tabs\n})\n\nconst breadcrumbs = computed(() => [\n\t{\n\t\tlabel: __('Courses'),\n\t\troute: { name: 'Courses' },\n\t},\n])\n\nusePageMeta(() => {\n\treturn {\n\t\ttitle: __('Courses'),\n\t\ticon: brand.favicon,\n\t}\n})\n</script>\n"],"names":["user","inject","dayjs","start","ref","pageLength","categories","currentCategory","title","certification","filters","currentTab","brand","sessionStore","courseCount","onMounted","setFiltersFromQuery","updateCourses","getCourseCount","queries","courses","createListResource","_a","data","setCategories","allCategories","course","category","index","updateCategories","isPersonaCaptured","call","identifyUserPersona","_b","router","updateFilters","updateCategoryFilter","updateTitleFilter","updateCertificationFilter","updateTabFilter","updateStudentFilter","setQueryParams","filterKeys","key","queryString","watch","courseTabs","computed","tabs","_c","breadcrumbs","usePageMeta"],"mappings":"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"}