{"version":3,"file":"Programs-plQ1UkM7.js","sources":["../../../../frontend/src/pages/Programs.vue"],"sourcesContent":["<template>\n\t<header\n\t\tclass=\"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5\"\n\t>\n\t\t<Breadcrumbs :items=\"breadbrumbs\" />\n\t\t<Button\n\t\t\tv-if=\"canCreateProgram()\"\n\t\t\t@click=\"showDialog = true\"\n\t\t\tvariant=\"solid\"\n\t\t>\n\t\t\t<template #prefix>\n\t\t\t\t<Plus class=\"h-4 w-4 stroke-1.5\" />\n\t\t\t</template>\n\t\t\t{{ __('New') }}\n\t\t</Button>\n\t</header>\n\t<div v-if=\"programs.data?.length\" class=\"pt-5 px-5\">\n\t\t<div v-for=\"program in programs.data\" class=\"mb-10\">\n\t\t\t<div class=\"flex items-center justify-between\">\n\t\t\t\t<div class=\"text-xl text-ink-gray-9 font-semibold\">\n\t\t\t\t\t{{ program.name }}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"flex items-center space-x-2\">\n\t\t\t\t\t<Badge\n\t\t\t\t\t\tv-if=\"program.members\"\n\t\t\t\t\t\tvariant=\"subtle\"\n\t\t\t\t\t\ttheme=\"green\"\n\t\t\t\t\t\tsize=\"lg\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ program.members }}\n\t\t\t\t\t\t{{ program.members == 1 ? __('member') : __('members') }}\n\t\t\t\t\t</Badge>\n\t\t\t\t\t<Badge\n\t\t\t\t\t\tv-if=\"program.progress\"\n\t\t\t\t\t\tvariant=\"subtle\"\n\t\t\t\t\t\ttheme=\"blue\"\n\t\t\t\t\t\tsize=\"lg\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ program.progress }}{{ __('% completed') }}\n\t\t\t\t\t</Badge>\n\n\t\t\t\t\t<router-link\n\t\t\t\t\t\tv-if=\"user.data?.is_moderator || user.data?.is_instructor\"\n\t\t\t\t\t\t:to=\"{\n\t\t\t\t\t\t\tname: 'ProgramForm',\n\t\t\t\t\t\t\tparams: { programName: program.name },\n\t\t\t\t\t\t}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Button v-if=\"!readOnlyMode\">\n\t\t\t\t\t\t\t<template #prefix>\n\t\t\t\t\t\t\t\t<Edit class=\"h-4 w-4 stroke-1.5\" />\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t{{ __('Edit') }}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</router-link>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if=\"program.courses?.length\"\n\t\t\t\tclass=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5 mt-5\"\n\t\t\t>\n\t\t\t\t<div v-for=\"course in program.courses\" class=\"relative group\">\n\t\t\t\t\t<CourseCard\n\t\t\t\t\t\t:course=\"course\"\n\t\t\t\t\t\t@click=\"enrollMember(program.name, course.name)\"\n\t\t\t\t\t\tclass=\"cursor-pointer\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"lockCourse(course)\"\n\t\t\t\t\t\tclass=\"absolute inset-0 bg-black-overlay-500 opacity-60 rounded-md\"\n\t\t\t\t\t></div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"lockCourse(course)\"\n\t\t\t\t\t\tclass=\"absolute inset-0 flex items-center justify-center\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<LockKeyhole class=\"size-10 text-ink-white\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-else class=\"text-sm italic text-ink-gray-5 mt-4\">\n\t\t\t\t{{ __('No courses in this program') }}\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<EmptyState v-else type=\"Programs\" />\n\n\t<Dialog\n\t\tv-model=\"showDialog\"\n\t\t:options=\"{\n\t\t\ttitle: __('New Program'),\n\t\t\tactions: [\n\t\t\t\t{\n\t\t\t\t\tlabel: __('Create'),\n\t\t\t\t\tvariant: 'solid',\n\t\t\t\t\tonClick: () => createProgram(close),\n\t\t\t\t},\n\t\t\t],\n\t\t}\"\n\t>\n\t\t<template #body-content>\n\t\t\t<FormControl :label=\"__('Title')\" v-model=\"title\" />\n\t\t</template>\n\t</Dialog>\n</template>\n<script setup>\nimport {\n\tBadge,\n\tBreadcrumbs,\n\tButton,\n\tcall,\n\tcreateResource,\n\tDialog,\n\tFormControl,\n\tusePageMeta,\n\ttoast,\n} from 'frappe-ui'\nimport { computed, inject, onMounted, ref } from 'vue'\nimport { Edit, Plus, LockKeyhole } from 'lucide-vue-next'\nimport CourseCard from '@/components/CourseCard.vue'\nimport EmptyState from '@/components/EmptyState.vue'\nimport { useRouter } from 'vue-router'\nimport { sessionStore } from '../stores/session'\nimport { useSettings } from '@/stores/settings'\n\nconst { brand } = sessionStore()\nconst user = inject('$user')\nconst showDialog = ref(false)\nconst router = useRouter()\nconst title = ref('')\nconst settings = useSettings()\nconst readOnlyMode = window.read_only_mode\n\nonMounted(() => {\n\tif (\n\t\t!settings.learningPaths.data &&\n\t\t!user.data?.is_moderator &&\n\t\t!user.data?.is_instructor\n\t) {\n\t\trouter.push({ name: 'Courses' })\n\t}\n})\n\nconst programs = createResource({\n\turl: 'lms.lms.utils.get_programs',\n\tauto: true,\n\tcache: 'programs',\n})\n\nconst createProgram = (close) => {\n\tcall('frappe.client.insert', {\n\t\tdoc: {\n\t\t\tdoctype: 'LMS Program',\n\t\t\ttitle: title.value,\n\t\t},\n\t}).then((res) => {\n\t\trouter.push({ name: 'ProgramForm', params: { programName: res.name } })\n\t})\n}\n\nconst enrollMember = (program, course) => {\n\tcall('lms.lms.utils.enroll_in_program_course', {\n\t\tprogram: program,\n\t\tcourse: course,\n\t})\n\t\t.then((data) => {\n\t\t\tif (data.current_lesson) {\n\t\t\t\trouter.push({\n\t\t\t\t\tname: 'Lesson',\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tcourseName: course,\n\t\t\t\t\t\tchapterNumber: data.current_lesson.split('-')[0],\n\t\t\t\t\t\tlessonNumber: data.current_lesson.split('-')[1],\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t} else if (data) {\n\t\t\t\trouter.push({\n\t\t\t\t\tname: 'Lesson',\n\t\t\t\t\tparams: {\n\t\t\t\t\t\tcourseName: course,\n\t\t\t\t\t\tchapterNumber: 1,\n\t\t\t\t\t\tlessonNumber: 1,\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t}\n\t\t})\n\t\t.catch((err) => {\n\t\t\ttoast.error(err.messages?.[0] || err)\n\t\t})\n}\n\nconst lockCourse = (course) => {\n\tif (user.data?.is_moderator || user.data?.is_instructor) return false\n\tif (course.membership) return false\n\tif (course.eligible) return false\n\treturn true\n}\n\nconst canCreateProgram = () => {\n\tif (readOnlyMode) return false\n\tif (user.data?.is_moderator || user.data?.is_instructor) return true\n\treturn false\n}\n\nconst breadbrumbs = computed(() => [\n\t{\n\t\tlabel: __('Programs'),\n\t},\n])\n\nusePageMeta(() => {\n\treturn {\n\t\ttitle: __('Programs'),\n\t\ticon: brand.favicon,\n\t}\n})\n</script>\n"],"names":["brand","sessionStore","user","inject","showDialog","ref","router","useRouter","title","settings","useSettings","readOnlyMode","onMounted","_a","_b","programs","createResource","createProgram","close","call","res","enrollMember","program","course","data","err","toast","lockCourse","canCreateProgram","breadbrumbs","computed","usePageMeta"],"mappings":"wrCA4HA,KAAM,CAAE,MAAAA,CAAO,EAAGC,EAAY,EACxBC,EAAOC,EAAO,OAAO,EACrBC,EAAaC,EAAI,EAAK,EACtBC,EAASC,EAAS,EAClBC,EAAQH,EAAI,EAAE,EACdI,EAAWC,EAAW,EACtBC,EAAe,OAAO,eAE5BC,EAAU,IAAM,SAEd,CAACH,EAAS,cAAc,MACxB,GAACI,EAAAX,EAAK,OAAL,MAAAW,EAAW,eACZ,GAACC,EAAAZ,EAAK,OAAL,MAAAY,EAAW,gBAEZR,EAAO,KAAK,CAAE,KAAM,SAAW,CAAA,CAEjC,CAAC,EAED,MAAMS,EAAWC,EAAe,CAC/B,IAAK,6BACL,KAAM,GACN,MAAO,UACR,CAAC,EAEKC,EAAiBC,GAAU,CAChCC,EAAK,uBAAwB,CAC5B,IAAK,CACJ,QAAS,cACT,MAAOX,EAAM,KACb,CACH,CAAE,EAAE,KAAMY,GAAQ,CAChBd,EAAO,KAAK,CAAE,KAAM,cAAe,OAAQ,CAAE,YAAac,EAAI,KAAQ,CAAA,CACtE,CAAA,CACF,EAEMC,EAAe,CAACC,EAASC,IAAW,CACzCJ,EAAK,yCAA0C,CAC9C,QAASG,EACT,OAAQC,CACR,CAAA,EACC,KAAMC,GAAS,CACXA,EAAK,eACRlB,EAAO,KAAK,CACX,KAAM,SACN,OAAQ,CACP,WAAYiB,EACZ,cAAeC,EAAK,eAAe,MAAM,GAAG,EAAE,CAAC,EAC/C,aAAcA,EAAK,eAAe,MAAM,GAAG,EAAE,CAAC,CAC9C,CACD,CAAA,EACSA,GACVlB,EAAO,KAAK,CACX,KAAM,SACN,OAAQ,CACP,WAAYiB,EACZ,cAAe,EACf,aAAc,CACd,CACD,CAAA,CAEF,CAAA,EACA,MAAOE,GAAQ,OACfC,EAAM,QAAMb,EAAAY,EAAI,WAAJ,YAAAZ,EAAe,KAAMY,CAAG,CACpC,CAAA,CACH,EAEME,EAAcJ,GAAW,SAG9B,MAFI,GAAAV,EAAAX,EAAK,OAAL,MAAAW,EAAW,eAAgBC,EAAAZ,EAAK,OAAL,MAAAY,EAAW,eACtCS,EAAO,YACPA,EAAO,SAEZ,EAEMK,EAAmB,IAAM,SAC9B,OAAIjB,EAAqB,GACrB,IAAAE,EAAAX,EAAK,OAAL,MAAAW,EAAW,eAAgBC,EAAAZ,EAAK,OAAL,MAAAY,EAAW,cAE3C,EAEMe,EAAcC,EAAS,IAAM,CAClC,CACC,MAAO,GAAG,UAAU,CACpB,CACF,CAAC,EAED,OAAAC,EAAY,KACJ,CACN,MAAO,GAAG,UAAU,EACpB,KAAM/B,EAAM,OACd,EACC"}