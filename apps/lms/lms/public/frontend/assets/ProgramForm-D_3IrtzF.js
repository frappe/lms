import{s as K,r as h,z as Q,a6 as W,b as P,u as X,e as p,f as n,g as d,k as V,h as l,l as s,n as t,p as x,t as g,_ as f,q as Y,P as E,ah as D,F as C,x as N,j as b,ai as F,ak as T,al as U,an as j,ao as A,ap as B,ag as I,ax as Z,M as ee,a as se,H as i}from"./index-D24HXhLT.js";import{_ as ae}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-DRN2bHzK.js";import{D as re}from"./vuedraggable.umd-D_03Sejs.js";const oe={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},le={key:0,class:"pt-5 px-5 w-3/4 mx-auto space-y-10"},te={class:"flex items-center justify-between mb-2"},ue={class:"text-lg text-ink-gray-9 font-semibold"},me={class:"flex gap-2"},ne={class:"flex items-center justify-between mb-2"},de={class:"text-lg text-ink-gray-9 font-semibold"},ie={class:"flex gap-2"},ge={__name:"ProgramForm",props:{programName:{type:String,required:!0}},setup(L){const{brand:q}=K(),c=h(!1),_=h(null),v=h(null),w=h(null),z=Q(),y=L,o=W({doctype:"LMS Program",name:y.programName,auto:!0,cache:["program",y.programName]}),O=()=>{o.setValue.submit({program_courses:[...o.doc.program_courses,{course:v.value}]},{onSuccess(e){c.value=!1,v.value=null,i.success(__("Course added to program")),o.reload()},onError(e){var r;i.error(((r=e.messages)==null?void 0:r[0])||e)}})},R=()=>{o.setValue.submit({program_members:[...o.doc.program_members,{member:w.value}]},{onSuccess(e){c.value=!1,w.value=null,i.success(__("Member added to program")),o.reload()},onError(e){var r;i.error(((r=e.messages)==null?void 0:r[0])||e)}})},$=(e,r,a)=>{e=Array.from(e),o.setValue.submit({[a]:o.doc[a].filter(u=>!e.includes(u.name))},{onSuccess(u){r(),i.success(__("Items removed successfully")),o.reload()},onError(u){var m;i.error(((m=u.messages)==null?void 0:m[0])||u)}})},H=e=>{let r=e.from.dataset.idx,a=e.to.dataset.idx,u=o.doc.program_courses;u.splice(a,0,u.splice(r,1)[0]),u.forEach((m,k)=>{m.idx=k+1}),o.setValue.submit({program_courses:u},{onSuccess(m){i.success(__("Course moved successfully")),o.reload()},onError(m){var k;i.error(((k=m.messages)==null?void 0:k[0])||m)}})},G=()=>{se("frappe.model.rename_doc.update_document_title",{doctype:"LMS Program",docname:o.doc.name,name:o.doc.title}).then(e=>{z.push({name:"ProgramForm",params:{programName:e}})})},M=P(()=>[{label:"Title",key:"course_title",width:3},{label:"ID",key:"course",width:3}]),S=P(()=>[{label:"Member",key:"member",width:3,align:"left"},{label:"Full Name",key:"full_name",width:3,align:"left"},{label:"Progress (%)",key:"progress",width:3,align:"right"}]),J=P(()=>[{label:"Programs",route:{name:"Programs"}},{label:y.programName==="new"?"New Program":y.programName}]);return X(()=>{var e;return{title:(e=o.doc)==null?void 0:e.title,icon:q.favicon}}),(e,r)=>(n(),p(C,null,[d("header",oe,[l(s(ae),{items:J.value},null,8,["items"]),l(s(f),{variant:"solid",onClick:r[0]||(r[0]=a=>G())},{default:t(()=>[x(g(e.__("Save")),1)]),_:1})]),s(o).doc?(n(),p("div",le,[l(s(Y),{modelValue:s(o).doc.title,"onUpdate:modelValue":r[1]||(r[1]=a=>s(o).doc.title=a),label:e.__("Title")},null,8,["modelValue","label"]),d("div",null,[d("div",te,[d("div",ue,g(e.__("Program Courses")),1),l(s(f),{onClick:r[2]||(r[2]=()=>{_.value="course",c.value=!0})},{prefix:t(()=>[l(s(E),{class:"w-4 h-4"})]),default:t(()=>[x(" "+g(e.__("Add")),1)]),_:1})]),l(s(B),{columns:M.value,rows:s(o).doc.program_courses,"row-key":"name",options:{showTooltip:!1}},{default:t(()=>[l(s(D),{class:"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2"},{default:t(()=>[(n(!0),p(C,null,N(M.value,a=>(n(),b(s(F),{item:a},null,8,["item"]))),256))]),_:1}),l(s(T),null,{default:t(()=>[l(s(re),{list:s(o).doc.program_courses,"item-key":"name",group:"items",onEnd:H,class:"cursor-move"},{item:t(({element:a})=>[l(s(U),{row:a},null,8,["row"])]),_:1},8,["list"])]),_:1}),l(s(j),null,{actions:t(({unselectAll:a,selections:u})=>[d("div",me,[l(s(f),{variant:"ghost",onClick:m=>$(u,a,"program_courses")},{default:t(()=>[l(s(A),{class:"h-4 w-4 stroke-1.5"})]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["columns","rows"])]),d("div",null,[d("div",ne,[d("div",de,g(e.__("Program Members")),1),l(s(f),{onClick:r[3]||(r[3]=()=>{_.value="member",c.value=!0})},{prefix:t(()=>[l(s(E),{class:"w-4 h-4"})]),default:t(()=>[x(" "+g(e.__("Add")),1)]),_:1})]),l(s(B),{columns:S.value,rows:s(o).doc.program_members,"row-key":"name",options:{showTooltip:!1}},{default:t(()=>[l(s(D),{class:"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2"},{default:t(()=>[(n(!0),p(C,null,N(S.value,a=>(n(),b(s(F),{item:a},null,8,["item"]))),256))]),_:1}),l(s(T),null,{default:t(()=>[(n(!0),p(C,null,N(s(o).doc.program_members,a=>(n(),b(s(U),{row:a},null,8,["row"]))),256))]),_:1}),l(s(j),null,{actions:t(({unselectAll:a,selections:u})=>[d("div",ie,[l(s(f),{variant:"ghost",onClick:m=>$(u,a,"program_members")},{default:t(()=>[l(s(A),{class:"h-4 w-4 stroke-1.5"})]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["columns","rows"])])])):V("",!0),l(s(ee),{modelValue:c.value,"onUpdate:modelValue":r[6]||(r[6]=a=>c.value=a),options:{title:_.value=="course"?e.__("New Program Course"):e.__("New Program Member"),actions:[{label:e.__("Add"),variant:"solid",onClick:()=>_.value=="course"?O(e.close):R(e.close)}]}},{"body-content":t(()=>[_.value=="course"?(n(),b(I,{key:0,modelValue:v.value,"onUpdate:modelValue":r[4]||(r[4]=a=>v.value=a),doctype:"LMS Course",filters:{disable_self_learning:1},label:e.__("Program Course"),description:e.__("Only courses for which self learning is disabled can be added to program.")},null,8,["modelValue","label","description"])):V("",!0),_.value=="member"?(n(),b(I,{key:1,modelValue:w.value,"onUpdate:modelValue":r[5]||(r[5]=a=>w.value=a),doctype:"User",filters:{ignore_user_type:1},label:e.__("Program Member"),onCreate:(a,u)=>s(Z)("Members",u)},null,8,["modelValue","label","onCreate"])):V("",!0)]),_:1},8,["modelValue","options"])],64))}};export{ge as default};
//# sourceMappingURL=ProgramForm-D_3IrtzF.js.map
