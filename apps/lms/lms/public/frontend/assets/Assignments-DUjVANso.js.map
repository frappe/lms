{"version":3,"file":"Assignments-DUjVANso.js","sources":["../../../../frontend/src/components/Modals/AssignmentForm.vue","../../../../frontend/src/pages/Assignments.vue"],"sourcesContent":["<template>\n\t<Dialog\n\t\tv-model=\"show\"\n\t\t:options=\"{\n\t\t\tsize: 'lg',\n\t\t}\"\n\t>\n\t\t<template #body>\n\t\t\t<div class=\"p-5 text-base\">\n\t\t\t\t<div class=\"text-lg text-ink-gray-9 font-semibold mb-5\">\n\t\t\t\t\t{{\n\t\t\t\t\t\tassignmentID === 'new'\n\t\t\t\t\t\t\t? __('Create an Assignment')\n\t\t\t\t\t\t\t: __('Edit Assignment')\n\t\t\t\t\t}}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"space-y-4 max-h-[75vh] overflow-y-auto\">\n\t\t\t\t\t<FormControl\n\t\t\t\t\t\tv-model=\"assignment.title\"\n\t\t\t\t\t\t:label=\"__('Title')\"\n\t\t\t\t\t\t:required=\"true\"\n\t\t\t\t\t/>\n\t\t\t\t\t<FormControl\n\t\t\t\t\t\tv-model=\"assignment.type\"\n\t\t\t\t\t\ttype=\"select\"\n\t\t\t\t\t\t:options=\"assignmentOptions\"\n\t\t\t\t\t\t:label=\"__('Submission Type')\"\n\t\t\t\t\t\t:required=\"true\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div class=\"text-xs text-ink-gray-5 mb-2\">\n\t\t\t\t\t\t\t{{ __('Question') }}\n\t\t\t\t\t\t\t<span class=\"text-ink-red-3\">*</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<TextEditor\n\t\t\t\t\t\t\t:content=\"assignment.question\"\n\t\t\t\t\t\t\t@change=\"(val) => (assignment.question = val)\"\n\t\t\t\t\t\t\t:editable=\"true\"\n\t\t\t\t\t\t\t:fixedMenu=\"true\"\n\t\t\t\t\t\t\teditorClass=\"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem] max-h-[18rem] overflow-y-auto\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"flex justify-end space-x-2 mt-5\">\n\t\t\t\t\t<router-link\n\t\t\t\t\t\t:to=\"{\n\t\t\t\t\t\t\tname: 'AssignmentSubmissionList',\n\t\t\t\t\t\t\tquery: {\n\t\t\t\t\t\t\t\tassignmentID: assignmentID,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Button v-if=\"assignmentID !== 'new'\" variant=\"subtle\">\n\t\t\t\t\t\t\t{{ __('Check Submissions') }}\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</router-link>\n\t\t\t\t\t<Button variant=\"solid\" @click=\"saveAssignment\">\n\t\t\t\t\t\t{{ __('Save') }}\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</template>\n\t</Dialog>\n</template>\n<script setup lang=\"ts\">\nimport { Button, Dialog, FormControl, TextEditor, toast } from 'frappe-ui'\nimport { computed, reactive, watch } from 'vue'\n\nconst show = defineModel()\nconst assignments = defineModel<Assignments>('assignments')\n\ninterface Assignment {\n\ttitle: string\n\ttype: string\n\tquestion: string\n}\n\ninterface Assignments {\n\tdata: Assignment[]\n\tget: (params: { doctype: string; name: string }) => Promise<Assignment>\n\tinsert: {\n\t\tsubmit: (params: Assignment, options: { onSuccess: () => void }) => void\n\t}\n}\n\nconst assignment = reactive({\n\ttitle: '',\n\ttype: '',\n\tquestion: '',\n})\n\nconst props = defineProps({\n\tassignmentID: {\n\t\ttype: String,\n\t\tdefault: 'new',\n\t},\n})\n\nwatch(\n\t() => props.assignmentID,\n\t(val) => {\n\t\tif (val !== 'new') {\n\t\t\tassignments.value?.data.forEach((row) => {\n\t\t\t\tif (row.name === val) {\n\t\t\t\t\tassignment.title = row.title\n\t\t\t\t\tassignment.type = row.type\n\t\t\t\t\tassignment.question = row.question\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t},\n\t{ flush: 'post' }\n)\n\nconst saveAssignment = () => {\n\tif (props.assignmentID == 'new') {\n\t\tassignments.value.insert.submit(\n\t\t\t{\n\t\t\t\t...assignment,\n\t\t\t},\n\t\t\t{\n\t\t\t\tonSuccess() {\n\t\t\t\t\tshow.value = false\n\t\t\t\t\ttoast.success(__('Assignment created successfully'))\n\t\t\t\t},\n\t\t\t}\n\t\t)\n\t} else {\n\t\tassignments.value.setValue.submit(\n\t\t\t{\n\t\t\t\t...assignment,\n\t\t\t\tname: props.assignmentID,\n\t\t\t},\n\t\t\t{\n\t\t\t\tonSuccess() {\n\t\t\t\t\tshow.value = false\n\t\t\t\t\ttoast.success(__('Assignment updated successfully'))\n\t\t\t\t},\n\t\t\t}\n\t\t)\n\t}\n}\n\nconst assignmentOptions = computed(() => {\n\treturn [\n\t\t{ label: 'PDF', value: 'PDF' },\n\t\t{ label: 'Image', value: 'Image' },\n\t\t{ label: 'Document', value: 'Document' },\n\t\t{ label: 'Text', value: 'Text' },\n\t\t{ label: 'URL', value: 'URL' },\n\t]\n})\n</script>\n","<template>\n\t<header\n\t\tclass=\"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5\"\n\t>\n\t\t<Breadcrumbs :items=\"breadcrumbs\" />\n\t\t<Button\n\t\t\tv-if=\"!readOnlyMode\"\n\t\t\tvariant=\"solid\"\n\t\t\t@click=\"\n\t\t\t\t() => {\n\t\t\t\t\tassignmentID = 'new'\n\t\t\t\t\tshowAssignmentForm = true\n\t\t\t\t}\n\t\t\t\"\n\t\t>\n\t\t\t<template #prefix>\n\t\t\t\t<Plus class=\"w-4 h-4\" />\n\t\t\t</template>\n\t\t\t{{ __('New') }}\n\t\t</Button>\n\t</header>\n\n\t<div class=\"md:w-3/4 md:mx-auto py-5 mx-5\">\n\t\t<div class=\"flex items-center justify-between mb-5\">\n\t\t\t<div\n\t\t\t\tv-if=\"assignmentCount\"\n\t\t\t\tclass=\"text-xl font-semibold text-ink-gray-7 mb-4\"\n\t\t\t>\n\t\t\t\t{{ __('{0} Assignments').format(assignmentCount) }}\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if=\"assignments.data?.length || assigmentCount > 0\"\n\t\t\t\tclass=\"grid grid-cols-2 gap-5\"\n\t\t\t>\n\t\t\t\t<FormControl\n\t\t\t\t\tv-model=\"titleFilter\"\n\t\t\t\t\t:placeholder=\"__('Search by title')\"\n\t\t\t\t/>\n\t\t\t\t<FormControl\n\t\t\t\t\tv-model=\"typeFilter\"\n\t\t\t\t\ttype=\"select\"\n\t\t\t\t\t:options=\"assignmentTypes\"\n\t\t\t\t\t:placeholder=\"__('Type')\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t\t<ListView\n\t\t\tv-if=\"assignments.data?.length\"\n\t\t\t:columns=\"assignmentColumns\"\n\t\t\t:rows=\"assignments.data\"\n\t\t\trow-key=\"name\"\n\t\t\t:options=\"{\n\t\t\t\tshowTooltip: false,\n\t\t\t\tselectable: false,\n\t\t\t\tonRowClick: (row) => {\n\t\t\t\t\tif (readOnlyMode) return\n\t\t\t\t\tassignmentID = row.name\n\t\t\t\t\tshowAssignmentForm = true\n\t\t\t\t},\n\t\t\t}\"\n\t\t>\n\t\t</ListView>\n\t\t<EmptyState v-else type=\"Assignments\" />\n\t\t<div\n\t\t\tv-if=\"assignments.data && assignments.hasNextPage\"\n\t\t\tclass=\"flex justify-center my-5\"\n\t\t>\n\t\t\t<Button @click=\"assignments.next()\">\n\t\t\t\t{{ __('Load More') }}\n\t\t\t</Button>\n\t\t</div>\n\t</div>\n\t<AssignmentForm\n\t\tv-model=\"showAssignmentForm\"\n\t\tv-model:assignments=\"assignments\"\n\t\t:assignmentID=\"assignmentID\"\n\t/>\n</template>\n<script setup>\nimport {\n\tBreadcrumbs,\n\tButton,\n\tcall,\n\tcreateListResource,\n\tFormControl,\n\tListView,\n\tusePageMeta,\n} from 'frappe-ui'\nimport { computed, inject, onMounted, ref, watch } from 'vue'\nimport { Plus } from 'lucide-vue-next'\nimport { useRouter } from 'vue-router'\nimport { sessionStore } from '../stores/session'\nimport AssignmentForm from '@/components/Modals/AssignmentForm.vue'\nimport EmptyState from '@/components/EmptyState.vue'\n\nconst user = inject('$user')\nconst dayjs = inject('$dayjs')\nconst titleFilter = ref('')\nconst typeFilter = ref('')\nconst showAssignmentForm = ref(false)\nconst assignmentID = ref('new')\nconst assignmentCount = ref(0)\nconst { brand } = sessionStore()\nconst router = useRouter()\nconst readOnlyMode = window.read_only_mode\n\nonMounted(() => {\n\tif (!user.data?.is_moderator && !user.data?.is_instructor) {\n\t\trouter.push({ name: 'Courses' })\n\t}\n\tgetAssignmentCount()\n\ttitleFilter.value = router.currentRoute.value.query.title\n\ttypeFilter.value = router.currentRoute.value.query.type\n})\n\nwatch([titleFilter, typeFilter], () => {\n\trouter.push({\n\t\tquery: {\n\t\t\ttitle: titleFilter.value,\n\t\t\ttype: typeFilter.value,\n\t\t},\n\t})\n\treloadAssignments()\n})\n\nconst reloadAssignments = () => {\n\tassignments.update({\n\t\tfilters: assignmentFilter.value,\n\t})\n\tassignments.reload()\n}\n\nconst assignmentFilter = computed(() => {\n\tlet filters = {}\n\tif (titleFilter.value) {\n\t\tfilters.title = ['like', `%${titleFilter.value}%`]\n\t}\n\tif (typeFilter.value) {\n\t\tfilters.type = typeFilter.value\n\t}\n\tif (!user.data?.is_moderator) {\n\t\tfilters.owner = user.data?.email\n\t}\n\treturn filters\n})\n\nconst assignments = createListResource({\n\tdoctype: 'LMS Assignment',\n\tfields: ['name', 'title', 'type', 'creation', 'question'],\n\torderBy: 'modified desc',\n\tcache: ['assignments'],\n\ttransform(data) {\n\t\treturn data.map((row) => {\n\t\t\treturn {\n\t\t\t\t...row,\n\t\t\t\tcreation: dayjs(row.creation).fromNow(),\n\t\t\t}\n\t\t})\n\t},\n})\n\nconst assignmentColumns = computed(() => {\n\treturn [\n\t\t{\n\t\t\tlabel: __('Title'),\n\t\t\tkey: 'title',\n\t\t\twidth: 2,\n\t\t},\n\t\t{\n\t\t\tlabel: __('Type'),\n\t\t\tkey: 'type',\n\t\t\twidth: 1,\n\t\t\talign: 'left',\n\t\t},\n\t\t{\n\t\t\tlabel: __('Created'),\n\t\t\tkey: 'creation',\n\t\t\twidth: 1,\n\t\t\talign: 'right',\n\t\t},\n\t]\n})\n\nconst getAssignmentCount = () => {\n\tcall('frappe.client.get_count', {\n\t\tdoctype: 'LMS Assignment',\n\t}).then((data) => {\n\t\tassignmentCount.value = data\n\t})\n}\n\nconst assignmentTypes = computed(() => {\n\tlet types = ['', 'Document', 'Image', 'PDF', 'URL', 'Text']\n\treturn types.map((type) => {\n\t\treturn {\n\t\t\tlabel: __(type),\n\t\t\tvalue: type,\n\t\t}\n\t})\n})\n\nconst breadcrumbs = computed(() => [\n\t{\n\t\tlabel: 'Assignments',\n\t\troute: { name: 'Assignments' },\n\t},\n])\n\nusePageMeta(() => {\n\treturn {\n\t\ttitle: __('Assignments'),\n\t\ticon: brand.favicon,\n\t}\n})\n</script>\n"],"names":["show","_useModel","__props","assignments","assignment","reactive","props","watch","val","_a","row","saveAssignment","toast","assignmentOptions","computed","user","inject","dayjs","titleFilter","ref","typeFilter","showAssignmentForm","assignmentID","assignmentCount","brand","sessionStore","router","useRouter","readOnlyMode","onMounted","_b","getAssignmentCount","reloadAssignments","assignmentFilter","filters","createListResource","data","assignmentColumns","call","assignmentTypes","type","breadcrumbs","usePageMeta"],"mappings":"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"}