{"version":3,"file":"Batches-5AoO7Cgk.js","sources":["../../../../frontend/src/pages/Batches.vue"],"sourcesContent":["<template>\n\t<header\n\t\tclass=\"sticky flex items-center justify-between top-0 z-10 border-b bg-surface-white px-3 py-2.5 sm:px-5\"\n\t>\n\t\t<Breadcrumbs :items=\"breadcrumbs\" />\n\t\t<router-link\n\t\t\tv-if=\"canCreateBatch()\"\n\t\t\t:to=\"{\n\t\t\t\tname: 'BatchForm',\n\t\t\t\tparams: { batchName: 'new' },\n\t\t\t}\"\n\t\t>\n\t\t\t<Button variant=\"solid\">\n\t\t\t\t<template #prefix>\n\t\t\t\t\t<Plus class=\"h-4 w-4 stroke-1.5\" />\n\t\t\t\t</template>\n\t\t\t\t{{ __('New') }}\n\t\t\t</Button>\n\t\t</router-link>\n\t</header>\n\t<div class=\"p-5 pb-10\">\n\t\t<div\n\t\t\tclass=\"flex flex-col lg:flex-row space-y-4 lg:space-y-0 lg:items-center justify-between mb-5\"\n\t\t>\n\t\t\t<div class=\"text-lg text-ink-gray-9 font-semibold\">\n\t\t\t\t{{ __('All Batches') }}\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass=\"flex flex-col space-y-2 lg:space-y-0 lg:flex-row lg:items-center lg:space-x-4\"\n\t\t\t>\n\t\t\t\t<TabButtons\n\t\t\t\t\tv-if=\"user.data\"\n\t\t\t\t\t:buttons=\"batchTabs\"\n\t\t\t\t\tv-model=\"currentTab\"\n\t\t\t\t/>\n\t\t\t\t<FormControl\n\t\t\t\t\tv-model=\"certification\"\n\t\t\t\t\t:label=\"__('Certification')\"\n\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t@change=\"updateBatches()\"\n\t\t\t\t/>\n\t\t\t\t<div class=\"grid grid-cols-2 gap-2\">\n\t\t\t\t\t<FormControl\n\t\t\t\t\t\tv-model=\"title\"\n\t\t\t\t\t\t:placeholder=\"__('Search by Title')\"\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tclass=\"min-w-40 lg:min-w-0 lg:w-32 xl:w-40\"\n\t\t\t\t\t\t@input=\"updateBatches()\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div class=\"min-w-40 lg:min-w-0 lg:w-32 xl:w-40\">\n\t\t\t\t\t\t<Select\n\t\t\t\t\t\t\tv-if=\"categories.length\"\n\t\t\t\t\t\t\tv-model=\"currentCategory\"\n\t\t\t\t\t\t\t:options=\"categories\"\n\t\t\t\t\t\t\t:placeholder=\"__('Category')\"\n\t\t\t\t\t\t\t@change=\"updateBatches()\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div\n\t\t\tv-if=\"batches.data?.length\"\n\t\t\tclass=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5\"\n\t\t>\n\t\t\t<router-link\n\t\t\t\tv-for=\"batch in batches.data\"\n\t\t\t\t:to=\"{ name: 'BatchDetail', params: { batchName: batch.name } }\"\n\t\t\t>\n\t\t\t\t<BatchCard :batch=\"batch\" />\n\t\t\t</router-link>\n\t\t</div>\n\t\t<EmptyState v-else-if=\"!batches.list.loading\" type=\"Batches\" />\n\n\t\t<div\n\t\t\tv-if=\"!batches.list.loading && batches.hasNextPage\"\n\t\t\tclass=\"flex justify-center mt-5\"\n\t\t>\n\t\t\t<Button @click=\"batches.next()\">\n\t\t\t\t{{ __('Load More') }}\n\t\t\t</Button>\n\t\t</div>\n\t</div>\n</template>\n<script setup>\nimport {\n\tBreadcrumbs,\n\tButton,\n\tcall,\n\tcreateListResource,\n\tFormControl,\n\tSelect,\n\tTabButtons,\n\tusePageMeta,\n} from 'frappe-ui'\nimport { computed, inject, onMounted, ref, watch } from 'vue'\nimport { Plus } from 'lucide-vue-next'\nimport { sessionStore } from '@/stores/session'\nimport BatchCard from '@/components/BatchCard.vue'\nimport EmptyState from '@/components/EmptyState.vue'\n\nconst user = inject('$user')\nconst dayjs = inject('$dayjs')\nconst { brand } = sessionStore()\nconst start = ref(0)\nconst pageLength = ref(20)\nconst categories = ref([])\nconst currentCategory = ref(null)\nconst title = ref('')\nconst certification = ref(false)\nconst filters = ref({})\nconst is_student = computed(() => user.data?.is_student)\nconst currentTab = ref(is_student.value ? 'All' : 'Upcoming')\nconst orderBy = ref('start_date')\nconst readOnlyMode = window.read_only_mode\n\nonMounted(() => {\n\tsetFiltersFromQuery()\n\tupdateBatches()\n\tcategories.value = [\n\t\t{\n\t\t\tlabel: '',\n\t\t\tvalue: null,\n\t\t},\n\t]\n})\n\nconst setFiltersFromQuery = () => {\n\tlet queries = new URLSearchParams(location.search)\n\ttitle.value = queries.get('title') || ''\n\tcurrentCategory.value = queries.get('category') || null\n\tcertification.value = queries.get('certification') || false\n}\n\nconst batches = createListResource({\n\tdoctype: 'LMS Batch',\n\turl: 'lms.lms.utils.get_batches',\n\tcache: ['batches', user.data?.name],\n\tpageLength: pageLength.value,\n\tstart: start.value,\n\tonSuccess(data) {\n\t\tlet allCategories = data.map((batch) => batch.category)\n\t\tallCategories = allCategories.filter(\n\t\t\t(category, index) => allCategories.indexOf(category) === index && category\n\t\t)\n\t\tif (categories.value.length <= allCategories.length) {\n\t\t\tupdateCategories(data)\n\t\t}\n\t},\n})\n\nconst updateBatches = () => {\n\tupdateFilters()\n\tbatches.update({\n\t\tfilters: filters.value,\n\t\torderBy: orderBy.value,\n\t})\n\tbatches.reload()\n}\n\nconst updateFilters = () => {\n\tupdateCategoryFilter()\n\tupdateTitleFilter()\n\tupdateCertificationFilter()\n\tupdateTabFilter()\n\tupdateStudentFilter()\n\tsetQueryParams()\n}\n\nconst updateCategoryFilter = () => {\n\tif (currentCategory.value) {\n\t\tfilters.value['category'] = currentCategory.value\n\t} else {\n\t\tdelete filters.value['category']\n\t}\n}\n\nconst updateTitleFilter = () => {\n\tif (title.value) {\n\t\tfilters.value['title'] = ['like', `%${title.value}%`]\n\t} else {\n\t\tdelete filters.value['title']\n\t}\n}\n\nconst updateCertificationFilter = () => {\n\tif (certification.value) {\n\t\tfilters.value['certification'] = 1\n\t} else {\n\t\tdelete filters.value['certification']\n\t}\n}\n\nconst updateTabFilter = () => {\n\torderBy.value = 'start_date'\n\tif (!user.data) {\n\t\treturn\n\t}\n\tif (currentTab.value == 'Enrolled' && is_student.value) {\n\t\tfilters.value['enrolled'] = 1\n\t\tdelete filters.value['start_date']\n\t\tdelete filters.value['published']\n\t\torderBy.value = 'start_date desc'\n\t} else if (is_student.value) {\n\t\tdelete filters.value['enrolled']\n\t} else {\n\t\tdelete filters.value['start_date']\n\t\tdelete filters.value['published']\n\t\torderBy.value = 'start_date desc'\n\t\tif (currentTab.value == 'Upcoming') {\n\t\t\tfilters.value['start_date'] = ['>=', dayjs().format('YYYY-MM-DD')]\n\t\t\tfilters.value['published'] = 1\n\t\t\torderBy.value = 'start_date'\n\t\t} else if (currentTab.value == 'Archived') {\n\t\t\tfilters.value['start_date'] = ['<=', dayjs().format('YYYY-MM-DD')]\n\t\t} else if (currentTab.value == 'Unpublished') {\n\t\t\tfilters.value['published'] = 0\n\t\t}\n\t}\n}\n\nconst updateStudentFilter = () => {\n\tif (!user.data || (is_student.value && currentTab.value != 'Enrolled')) {\n\t\tfilters.value['start_date'] = ['>=', dayjs().format('YYYY-MM-DD')]\n\t\tfilters.value['published'] = 1\n\t}\n}\n\nconst setQueryParams = () => {\n\tlet queries = new URLSearchParams(location.search)\n\tlet filterKeys = {\n\t\ttitle: title.value,\n\t\tcategory: currentCategory.value,\n\t\tcertification: certification.value,\n\t}\n\n\tObject.keys(filterKeys).forEach((key) => {\n\t\tif (filterKeys[key]) {\n\t\t\tqueries.set(key, filterKeys[key])\n\t\t} else {\n\t\t\tqueries.delete(key)\n\t\t}\n\t})\n\n\tlet queryString = ''\n\tif (queries.toString()) {\n\t\tqueryString = `?${queries.toString()}`\n\t}\n\n\thistory.replaceState({}, '', `${location.pathname}${queryString}`)\n}\n\nconst updateCategories = (data) => {\n\tdata.forEach((batch) => {\n\t\tif (\n\t\t\tbatch.category &&\n\t\t\t!categories.value.find((category) => category.value === batch.category)\n\t\t)\n\t\t\tcategories.value.push({\n\t\t\t\tlabel: batch.category,\n\t\t\t\tvalue: batch.category,\n\t\t\t})\n\t})\n}\n\nwatch(currentTab, () => {\n\tupdateBatches()\n})\n\nconst batchTabs = computed(() => {\n\tlet tabs = [\n\t\t{\n\t\t\tlabel: __('All'),\n\t\t},\n\t]\n\n\tif (\n\t\tuser.data?.is_moderator ||\n\t\tuser.data?.is_instructor ||\n\t\tuser.data?.is_evaluator\n\t) {\n\t\ttabs.push({ label: __('Upcoming') })\n\t\ttabs.push({ label: __('Archived') })\n\t\ttabs.push({ label: __('Unpublished') })\n\t} else if (user.data) {\n\t\ttabs.push({ label: __('Enrolled') })\n\t}\n\treturn tabs\n})\n\nconst canCreateBatch = () => {\n\tif (readOnlyMode) return false\n\tif (user.data?.is_moderator || user.data?.is_instructor) return true\n\treturn false\n}\n\nconst breadcrumbs = computed(() => [\n\t{\n\t\tlabel: __('Batches'),\n\t\troute: { name: 'Batches' },\n\t},\n])\n\nusePageMeta(() => {\n\treturn {\n\t\ttitle: __('Batches'),\n\t\ticon: brand.favicon,\n\t}\n})\n</script>\n"],"names":["user","inject","dayjs","brand","sessionStore","start","ref","pageLength","categories","currentCategory","title","certification","filters","is_student","computed","_a","currentTab","orderBy","readOnlyMode","onMounted","setFiltersFromQuery","updateBatches","queries","batches","createListResource","data","allCategories","batch","category","index","updateCategories","updateFilters","updateCategoryFilter","updateTitleFilter","updateCertificationFilter","updateTabFilter","updateStudentFilter","setQueryParams","filterKeys","key","queryString","watch","batchTabs","tabs","_b","_c","canCreateBatch","breadcrumbs","usePageMeta"],"mappings":"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"}